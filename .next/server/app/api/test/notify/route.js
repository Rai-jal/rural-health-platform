/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/test/notify/route";
exports.ids = ["app/api/test/notify/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/@supabase/realtime-js/dist/main sync recursive":
/*!************************************************************!*\
  !*** ./node_modules/@supabase/realtime-js/dist/main/ sync ***!
  \************************************************************/
/***/ ((module) => {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = () => ([]);
webpackEmptyContext.resolve = webpackEmptyContext;
webpackEmptyContext.id = "(rsc)/./node_modules/@supabase/realtime-js/dist/main sync recursive";
module.exports = webpackEmptyContext;

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:os");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:path");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("process");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftest%2Fnotify%2Froute&page=%2Fapi%2Ftest%2Fnotify%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftest%2Fnotify%2Froute.ts&appDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftest%2Fnotify%2Froute&page=%2Fapi%2Ftest%2Fnotify%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftest%2Fnotify%2Froute.ts&appDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_swift_Rural_health_health_connect_app_api_test_notify_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/test/notify/route.ts */ \"(rsc)/./app/api/test/notify/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/test/notify/route\",\n        pathname: \"/api/test/notify\",\n        filename: \"route\",\n        bundlePath: \"app/api/test/notify/route\"\n    },\n    resolvedPagePath: \"/Users/swift/Rural-health/health-connect/app/api/test/notify/route.ts\",\n    nextConfigOutput,\n    userland: _Users_swift_Rural_health_health_connect_app_api_test_notify_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/test/notify/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ0ZXN0JTJGbm90aWZ5JTJGcm91dGUmcGFnZT0lMkZhcGklMkZ0ZXN0JTJGbm90aWZ5JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGdGVzdCUyRm5vdGlmeSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnN3aWZ0JTJGUnVyYWwtaGVhbHRoJTJGaGVhbHRoLWNvbm5lY3QlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGc3dpZnQlMkZSdXJhbC1oZWFsdGglMkZoZWFsdGgtY29ubmVjdCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNxQjtBQUNsRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL3J1cmFsLWhlYWx0aC1wbGF0Zm9ybS8/NDA3YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvc3dpZnQvUnVyYWwtaGVhbHRoL2hlYWx0aC1jb25uZWN0L2FwcC9hcGkvdGVzdC9ub3RpZnkvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Rlc3Qvbm90aWZ5L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdGVzdC9ub3RpZnlcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Rlc3Qvbm90aWZ5L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3N3aWZ0L1J1cmFsLWhlYWx0aC9oZWFsdGgtY29ubmVjdC9hcHAvYXBpL3Rlc3Qvbm90aWZ5L3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3Rlc3Qvbm90aWZ5L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCwgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftest%2Fnotify%2Froute&page=%2Fapi%2Ftest%2Fnotify%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftest%2Fnotify%2Froute.ts&appDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/test/notify/route.ts":
/*!**************************************!*\
  !*** ./app/api/test/notify/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_notifications__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/notifications */ \"(rsc)/./lib/notifications/index.ts\");\n/* harmony import */ var _lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase/admin */ \"(rsc)/./lib/supabase/admin.ts\");\n/**\n * Test Notification Endpoint\n * \n * Manually test sending notifications to diagnose issues\n * \n * Usage:\n *   GET /api/test/notify?userId=USER_ID&consultationId=CONSULTATION_ID&amount=10000\n */ \n\n\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const userId = searchParams.get(\"userId\");\n        const consultationId = searchParams.get(\"consultationId\");\n        const amount = parseInt(searchParams.get(\"amount\") || \"10000\");\n        if (!userId || !consultationId) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Missing required parameters\",\n                required: [\n                    \"userId\",\n                    \"consultationId\"\n                ],\n                optional: [\n                    \"amount\"\n                ],\n                example: \"/api/test/notify?userId=xxx&consultationId=yyy&amount=10000\"\n            }, {\n                status: 400\n            });\n        }\n        // Get user data for diagnostics\n        const adminClient = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__.getAdminClient)();\n        const { data: user } = await adminClient.from(\"users\").select(\"id, full_name, phone_number, email, notification_preferences\").eq(\"id\", userId).single();\n        if (!user) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: `User ${userId} not found`\n            }, {\n                status: 404\n            });\n        }\n        // Diagnostic info\n        const diagnostics = {\n            user: {\n                id: user.id,\n                name: user.full_name,\n                phoneNumber: user.phone_number || \"❌ Not set\",\n                email: user.email || \"❌ Not set\",\n                notificationPreferences: user.notification_preferences || \"null (defaults to SMS)\"\n            },\n            phoneNumberValid: user.phone_number ? /^\\+[1-9]\\d{10,14}$/.test(user.phone_number) : false,\n            canSendSMS: !!(user.phone_number && /^\\+[1-9]\\d{10,14}$/.test(user.phone_number) && (user.notification_preferences === \"sms\" || user.notification_preferences === \"both\" || !user.notification_preferences)),\n            canSendEmail: !!(user.email && (user.notification_preferences === \"email\" || user.notification_preferences === \"both\" || !user.notification_preferences))\n        };\n        // Send notification\n        try {\n            await (0,_lib_notifications__WEBPACK_IMPORTED_MODULE_1__.notifyPaymentConfirmation)(consultationId, userId, amount);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: true,\n                message: \"Notification sent\",\n                diagnostics,\n                note: \"Check server logs for detailed SMS/Email delivery status\"\n            });\n        } catch (notifError) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                success: false,\n                error: \"Failed to send notification\",\n                details: notifError instanceof Error ? notifError.message : \"Unknown error\",\n                diagnostics\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dXJjZXMiOlsid2VicGFjazovL3J1cmFsLWhlYWx0aC1wbGF0Zm9ybS8uL2FwcC9hcGkvdGVzdC9ub3RpZnkvcm91dGUudHM/OGU0NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3QgTm90aWZpY2F0aW9uIEVuZHBvaW50XG4gKiBcbiAqIE1hbnVhbGx5IHRlc3Qgc2VuZGluZyBub3RpZmljYXRpb25zIHRvIGRpYWdub3NlIGlzc3Vlc1xuICogXG4gKiBVc2FnZTpcbiAqICAgR0VUIC9hcGkvdGVzdC9ub3RpZnk/dXNlcklkPVVTRVJfSUQmY29uc3VsdGF0aW9uSWQ9Q09OU1VMVEFUSU9OX0lEJmFtb3VudD0xMDAwMFxuICovXG5cbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgbm90aWZ5UGF5bWVudENvbmZpcm1hdGlvbiB9IGZyb20gXCJAL2xpYi9ub3RpZmljYXRpb25zXCI7XG5pbXBvcnQgeyBnZXRBZG1pbkNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9hZG1pblwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgdXNlcklkID0gc2VhcmNoUGFyYW1zLmdldChcInVzZXJJZFwiKTtcbiAgICBjb25zdCBjb25zdWx0YXRpb25JZCA9IHNlYXJjaFBhcmFtcy5nZXQoXCJjb25zdWx0YXRpb25JZFwiKTtcbiAgICBjb25zdCBhbW91bnQgPSBwYXJzZUludChzZWFyY2hQYXJhbXMuZ2V0KFwiYW1vdW50XCIpIHx8IFwiMTAwMDBcIik7XG5cbiAgICBpZiAoIXVzZXJJZCB8fCAhY29uc3VsdGF0aW9uSWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiBcIk1pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVyc1wiLFxuICAgICAgICAgIHJlcXVpcmVkOiBbXCJ1c2VySWRcIiwgXCJjb25zdWx0YXRpb25JZFwiXSxcbiAgICAgICAgICBvcHRpb25hbDogW1wiYW1vdW50XCJdLFxuICAgICAgICAgIGV4YW1wbGU6IFwiL2FwaS90ZXN0L25vdGlmeT91c2VySWQ9eHh4JmNvbnN1bHRhdGlvbklkPXl5eSZhbW91bnQ9MTAwMDBcIixcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEdldCB1c2VyIGRhdGEgZm9yIGRpYWdub3N0aWNzXG4gICAgY29uc3QgYWRtaW5DbGllbnQgPSBnZXRBZG1pbkNsaWVudCgpO1xuICAgIGNvbnN0IHsgZGF0YTogdXNlciB9ID0gYXdhaXQgYWRtaW5DbGllbnRcbiAgICAgIC5mcm9tKFwidXNlcnNcIilcbiAgICAgIC5zZWxlY3QoXCJpZCwgZnVsbF9uYW1lLCBwaG9uZV9udW1iZXIsIGVtYWlsLCBub3RpZmljYXRpb25fcHJlZmVyZW5jZXNcIilcbiAgICAgIC5lcShcImlkXCIsIHVzZXJJZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBgVXNlciAke3VzZXJJZH0gbm90IGZvdW5kYCB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRGlhZ25vc3RpYyBpbmZvXG4gICAgY29uc3QgZGlhZ25vc3RpY3MgPSB7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICBuYW1lOiB1c2VyLmZ1bGxfbmFtZSxcbiAgICAgICAgcGhvbmVOdW1iZXI6IHVzZXIucGhvbmVfbnVtYmVyIHx8IFwi4p2MIE5vdCBzZXRcIixcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwgfHwgXCLinYwgTm90IHNldFwiLFxuICAgICAgICBub3RpZmljYXRpb25QcmVmZXJlbmNlczogdXNlci5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMgfHwgXCJudWxsIChkZWZhdWx0cyB0byBTTVMpXCIsXG4gICAgICB9LFxuICAgICAgcGhvbmVOdW1iZXJWYWxpZDogdXNlci5waG9uZV9udW1iZXJcbiAgICAgICAgPyAvXlxcK1sxLTldXFxkezEwLDE0fSQvLnRlc3QodXNlci5waG9uZV9udW1iZXIpXG4gICAgICAgIDogZmFsc2UsXG4gICAgICBjYW5TZW5kU01TOiAhIShcbiAgICAgICAgdXNlci5waG9uZV9udW1iZXIgJiZcbiAgICAgICAgL15cXCtbMS05XVxcZHsxMCwxNH0kLy50ZXN0KHVzZXIucGhvbmVfbnVtYmVyKSAmJlxuICAgICAgICAodXNlci5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMgPT09IFwic21zXCIgfHxcbiAgICAgICAgICB1c2VyLm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcyA9PT0gXCJib3RoXCIgfHxcbiAgICAgICAgICAhdXNlci5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMpXG4gICAgICApLFxuICAgICAgY2FuU2VuZEVtYWlsOiAhIShcbiAgICAgICAgdXNlci5lbWFpbCAmJlxuICAgICAgICAodXNlci5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMgPT09IFwiZW1haWxcIiB8fFxuICAgICAgICAgIHVzZXIubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzID09PSBcImJvdGhcIiB8fFxuICAgICAgICAgICF1c2VyLm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcylcbiAgICAgICksXG4gICAgfTtcblxuICAgIC8vIFNlbmQgbm90aWZpY2F0aW9uXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG5vdGlmeVBheW1lbnRDb25maXJtYXRpb24oY29uc3VsdGF0aW9uSWQsIHVzZXJJZCwgYW1vdW50KTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJOb3RpZmljYXRpb24gc2VudFwiLFxuICAgICAgICBkaWFnbm9zdGljcyxcbiAgICAgICAgbm90ZTogXCJDaGVjayBzZXJ2ZXIgbG9ncyBmb3IgZGV0YWlsZWQgU01TL0VtYWlsIGRlbGl2ZXJ5IHN0YXR1c1wiLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAobm90aWZFcnJvcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IFwiRmFpbGVkIHRvIHNlbmQgbm90aWZpY2F0aW9uXCIsXG4gICAgICAgICAgZGV0YWlsczogbm90aWZFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gbm90aWZFcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCIsXG4gICAgICAgICAgZGlhZ25vc3RpY3MsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIixcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIlVua25vd24gZXJyb3JcIixcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwibm90aWZ5UGF5bWVudENvbmZpcm1hdGlvbiIsImdldEFkbWluQ2xpZW50IiwiR0VUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInVzZXJJZCIsImdldCIsImNvbnN1bHRhdGlvbklkIiwiYW1vdW50IiwicGFyc2VJbnQiLCJqc29uIiwiZXJyb3IiLCJyZXF1aXJlZCIsIm9wdGlvbmFsIiwiZXhhbXBsZSIsInN0YXR1cyIsImFkbWluQ2xpZW50IiwiZGF0YSIsInVzZXIiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJkaWFnbm9zdGljcyIsImlkIiwibmFtZSIsImZ1bGxfbmFtZSIsInBob25lTnVtYmVyIiwicGhvbmVfbnVtYmVyIiwiZW1haWwiLCJub3RpZmljYXRpb25QcmVmZXJlbmNlcyIsIm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcyIsInBob25lTnVtYmVyVmFsaWQiLCJ0ZXN0IiwiY2FuU2VuZFNNUyIsImNhblNlbmRFbWFpbCIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwibm90ZSIsIm5vdGlmRXJyb3IiLCJkZXRhaWxzIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/test/notify/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/env.ts":
/*!********************!*\
  !*** ./lib/env.ts ***!
  \********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   env: () => (/* binding */ env)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v4/classic/external.js\");\n\nconst envSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    NEXT_PUBLIC_SUPABASE_URL: zod__WEBPACK_IMPORTED_MODULE_0__.string().url(\"Invalid Supabase URL\"),\n    NEXT_PUBLIC_SUPABASE_ANON_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1, \"Supabase anon key is required\"),\n    SUPABASE_SERVICE_ROLE_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1, \"Supabase service role key is required\").optional(),\n    NEXT_PUBLIC_APP_URL: zod__WEBPACK_IMPORTED_MODULE_0__.string().url(\"Invalid app URL\").optional(),\n    // Twilio SMS Configuration (optional)\n    TWILIO_ACCOUNT_SID: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    TWILIO_AUTH_TOKEN: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    TWILIO_PHONE_NUMBER: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    // Twilio Video/Voice Configuration (optional)\n    TWILIO_API_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    TWILIO_API_SECRET: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    // Email Configuration (optional - SendGrid or AWS SES)\n    // SendGrid\n    SENDGRID_API_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    SENDGRID_FROM_EMAIL: zod__WEBPACK_IMPORTED_MODULE_0__.string().email(\"Invalid SendGrid from email\").optional(),\n    SENDGRID_FROM_NAME: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    // AWS SES\n    AWS_SES_REGION: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    AWS_SES_ACCESS_KEY_ID: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    AWS_SES_SECRET_ACCESS_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    AWS_SES_FROM_EMAIL: zod__WEBPACK_IMPORTED_MODULE_0__.string().email(\"Invalid AWS SES from email\").optional(),\n    // Default email configuration\n    EMAIL_FROM: zod__WEBPACK_IMPORTED_MODULE_0__.string().email(\"Invalid default email\").optional(),\n    EMAIL_FROM_NAME: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    // Flutterwave Payment Gateway Configuration (optional)\n    FLUTTERWAVE_PUBLIC_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    FLUTTERWAVE_SECRET_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    FLUTTERWAVE_ENCRYPTION_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    FLUTTERWAVE_WEBHOOK_SECRET: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    FLUTTERWAVE_SECRET_HASH: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    FLUTTERWAVE_MODE: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        \"sandbox\",\n        \"live\"\n    ]).optional(),\n    ENABLE_MOCK_PAYMENTS: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    // Cron job security (optional but recommended)\n    CRON_SECRET: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional(),\n    // Sentry Error Monitoring Configuration (optional)\n    NEXT_PUBLIC_SENTRY_DSN: zod__WEBPACK_IMPORTED_MODULE_0__.string().url(\"Invalid Sentry DSN\").optional(),\n    NEXT_PUBLIC_APP_VERSION: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional()\n});\n// Parse and validate environment variables\nfunction getEnv() {\n    try {\n        return envSchema.parse({\n            NEXT_PUBLIC_SUPABASE_URL: \"https://mkrrzggetqnsxnenkvht.supabase.co\",\n            NEXT_PUBLIC_SUPABASE_ANON_KEY: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1rcnJ6Z2dldHFuc3huZW5rdmh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5MDM0NDksImV4cCI6MjA3OTQ3OTQ0OX0.ThB6nRcv_-PgM_cZzmF_17nCeCgRetzyVxzKub80_JQ\",\n            SUPABASE_SERVICE_ROLE_KEY: process.env.SUPABASE_SERVICE_ROLE_KEY,\n            NEXT_PUBLIC_APP_URL: \"http://localhost:3000\" || 0,\n            TWILIO_ACCOUNT_SID: process.env.TWILIO_ACCOUNT_SID,\n            TWILIO_AUTH_TOKEN: process.env.TWILIO_AUTH_TOKEN,\n            TWILIO_PHONE_NUMBER: process.env.TWILIO_PHONE_NUMBER,\n            TWILIO_API_KEY: process.env.TWILIO_API_KEY,\n            TWILIO_API_SECRET: process.env.TWILIO_API_SECRET,\n            // Email configuration\n            SENDGRID_API_KEY: process.env.SENDGRID_API_KEY,\n            SENDGRID_FROM_EMAIL: process.env.SENDGRID_FROM_EMAIL,\n            SENDGRID_FROM_NAME: process.env.SENDGRID_FROM_NAME,\n            AWS_SES_REGION: process.env.AWS_SES_REGION,\n            AWS_SES_ACCESS_KEY_ID: process.env.AWS_SES_ACCESS_KEY_ID,\n            AWS_SES_SECRET_ACCESS_KEY: process.env.AWS_SES_SECRET_ACCESS_KEY,\n            AWS_SES_FROM_EMAIL: process.env.AWS_SES_FROM_EMAIL,\n            EMAIL_FROM: process.env.EMAIL_FROM,\n            EMAIL_FROM_NAME: process.env.EMAIL_FROM_NAME,\n            // Flutterwave Payment Gateway Configuration (optional)\n            FLUTTERWAVE_PUBLIC_KEY: process.env.FLUTTERWAVE_PUBLIC_KEY,\n            FLUTTERWAVE_SECRET_KEY: process.env.FLUTTERWAVE_SECRET_KEY,\n            FLUTTERWAVE_ENCRYPTION_KEY: process.env.FLUTTERWAVE_ENCRYPTION_KEY,\n            FLUTTERWAVE_WEBHOOK_SECRET: process.env.FLUTTERWAVE_WEBHOOK_SECRET || process.env.FLUTTERWAVE_SECRET_HASH,\n            FLUTTERWAVE_SECRET_HASH: process.env.FLUTTERWAVE_SECRET_HASH || process.env.FLUTTERWAVE_WEBHOOK_SECRET,\n            FLUTTERWAVE_MODE: process.env.FLUTTERWAVE_MODE,\n            ENABLE_MOCK_PAYMENTS: process.env.ENABLE_MOCK_PAYMENTS,\n            // Cron job security\n            CRON_SECRET: process.env.CRON_SECRET,\n            // Sentry configuration\n            NEXT_PUBLIC_SENTRY_DSN: process.env.NEXT_PUBLIC_SENTRY_DSN,\n            NEXT_PUBLIC_APP_VERSION: process.env.NEXT_PUBLIC_APP_VERSION\n        });\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.ZodError) {\n            const missingVars = error.issues.map((e)=>e.path.join(\".\")).join(\", \");\n            throw new Error(`Missing or invalid environment variables: ${missingVars}\\n` + \"Please check your .env.local file and ensure all required variables are set.\");\n        }\n        throw error;\n    }\n}\nconst env = getEnv();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZW52LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXVCO0FBRXZCLE1BQU1DLFlBQVlELHVDQUFRLENBQUM7SUFDekJHLDBCQUEwQkgsdUNBQVEsR0FBR0ssR0FBRyxDQUFDO0lBQ3pDQywrQkFBK0JOLHVDQUFRLEdBQUdPLEdBQUcsQ0FBQyxHQUFHO0lBQ2pEQywyQkFBMkJSLHVDQUFRLEdBQUdPLEdBQUcsQ0FBQyxHQUFHLHlDQUF5Q0UsUUFBUTtJQUM5RkMscUJBQXFCVix1Q0FBUSxHQUFHSyxHQUFHLENBQUMsbUJBQW1CSSxRQUFRO0lBQy9ELHNDQUFzQztJQUN0Q0Usb0JBQW9CWCx1Q0FBUSxHQUFHUyxRQUFRO0lBQ3ZDRyxtQkFBbUJaLHVDQUFRLEdBQUdTLFFBQVE7SUFDdENJLHFCQUFxQmIsdUNBQVEsR0FBR1MsUUFBUTtJQUN4Qyw4Q0FBOEM7SUFDOUNLLGdCQUFnQmQsdUNBQVEsR0FBR1MsUUFBUTtJQUNuQ00sbUJBQW1CZix1Q0FBUSxHQUFHUyxRQUFRO0lBQ3RDLHVEQUF1RDtJQUN2RCxXQUFXO0lBQ1hPLGtCQUFrQmhCLHVDQUFRLEdBQUdTLFFBQVE7SUFDckNRLHFCQUFxQmpCLHVDQUFRLEdBQUdrQixLQUFLLENBQUMsK0JBQStCVCxRQUFRO0lBQzdFVSxvQkFBb0JuQix1Q0FBUSxHQUFHUyxRQUFRO0lBQ3ZDLFVBQVU7SUFDVlcsZ0JBQWdCcEIsdUNBQVEsR0FBR1MsUUFBUTtJQUNuQ1ksdUJBQXVCckIsdUNBQVEsR0FBR1MsUUFBUTtJQUMxQ2EsMkJBQTJCdEIsdUNBQVEsR0FBR1MsUUFBUTtJQUM5Q2Msb0JBQW9CdkIsdUNBQVEsR0FBR2tCLEtBQUssQ0FBQyw4QkFBOEJULFFBQVE7SUFDM0UsOEJBQThCO0lBQzlCZSxZQUFZeEIsdUNBQVEsR0FBR2tCLEtBQUssQ0FBQyx5QkFBeUJULFFBQVE7SUFDOURnQixpQkFBaUJ6Qix1Q0FBUSxHQUFHUyxRQUFRO0lBQ3BDLHVEQUF1RDtJQUN2RGlCLHdCQUF3QjFCLHVDQUFRLEdBQUdTLFFBQVE7SUFDM0NrQix3QkFBd0IzQix1Q0FBUSxHQUFHUyxRQUFRO0lBQzNDbUIsNEJBQTRCNUIsdUNBQVEsR0FBR1MsUUFBUTtJQUMvQ29CLDRCQUE0QjdCLHVDQUFRLEdBQUdTLFFBQVE7SUFDL0NxQix5QkFBeUI5Qix1Q0FBUSxHQUFHUyxRQUFRO0lBQzVDc0Isa0JBQWtCL0Isd0NBQU0sQ0FBQztRQUFDO1FBQVc7S0FBTyxFQUFFUyxRQUFRO0lBQ3REd0Isc0JBQXNCakMsdUNBQVEsR0FBR1MsUUFBUTtJQUN6QywrQ0FBK0M7SUFDL0N5QixhQUFhbEMsdUNBQVEsR0FBR1MsUUFBUTtJQUNoQyxtREFBbUQ7SUFDbkQwQix3QkFBd0JuQyx1Q0FBUSxHQUFHSyxHQUFHLENBQUMsc0JBQXNCSSxRQUFRO0lBQ3JFMkIseUJBQXlCcEMsdUNBQVEsR0FBR1MsUUFBUTtBQUM5QztBQUVBLDJDQUEyQztBQUMzQyxTQUFTNEI7SUFDUCxJQUFJO1FBQ0YsT0FBT3BDLFVBQVVxQyxLQUFLLENBQUM7WUFDckJuQywwQkFBMEJvQywwQ0FBb0M7WUFDOURqQywrQkFBK0JpQyxrTkFBeUM7WUFDeEUvQiwyQkFBMkIrQixRQUFRQyxHQUFHLENBQUNoQyx5QkFBeUI7WUFDaEVFLHFCQUFxQjZCLHVCQUErQixJQUFJO1lBQ3hENUIsb0JBQW9CNEIsUUFBUUMsR0FBRyxDQUFDN0Isa0JBQWtCO1lBQ2xEQyxtQkFBbUIyQixRQUFRQyxHQUFHLENBQUM1QixpQkFBaUI7WUFDaERDLHFCQUFxQjBCLFFBQVFDLEdBQUcsQ0FBQzNCLG1CQUFtQjtZQUNwREMsZ0JBQWdCeUIsUUFBUUMsR0FBRyxDQUFDMUIsY0FBYztZQUMxQ0MsbUJBQW1Cd0IsUUFBUUMsR0FBRyxDQUFDekIsaUJBQWlCO1lBQ2hELHNCQUFzQjtZQUN0QkMsa0JBQWtCdUIsUUFBUUMsR0FBRyxDQUFDeEIsZ0JBQWdCO1lBQzlDQyxxQkFBcUJzQixRQUFRQyxHQUFHLENBQUN2QixtQkFBbUI7WUFDcERFLG9CQUFvQm9CLFFBQVFDLEdBQUcsQ0FBQ3JCLGtCQUFrQjtZQUNsREMsZ0JBQWdCbUIsUUFBUUMsR0FBRyxDQUFDcEIsY0FBYztZQUMxQ0MsdUJBQXVCa0IsUUFBUUMsR0FBRyxDQUFDbkIscUJBQXFCO1lBQ3hEQywyQkFBMkJpQixRQUFRQyxHQUFHLENBQUNsQix5QkFBeUI7WUFDaEVDLG9CQUFvQmdCLFFBQVFDLEdBQUcsQ0FBQ2pCLGtCQUFrQjtZQUNsREMsWUFBWWUsUUFBUUMsR0FBRyxDQUFDaEIsVUFBVTtZQUNsQ0MsaUJBQWlCYyxRQUFRQyxHQUFHLENBQUNmLGVBQWU7WUFDNUMsdURBQXVEO1lBQ3ZEQyx3QkFBd0JhLFFBQVFDLEdBQUcsQ0FBQ2Qsc0JBQXNCO1lBQzFEQyx3QkFBd0JZLFFBQVFDLEdBQUcsQ0FBQ2Isc0JBQXNCO1lBQzFEQyw0QkFBNEJXLFFBQVFDLEdBQUcsQ0FBQ1osMEJBQTBCO1lBQ2xFQyw0QkFBNEJVLFFBQVFDLEdBQUcsQ0FBQ1gsMEJBQTBCLElBQUlVLFFBQVFDLEdBQUcsQ0FBQ1YsdUJBQXVCO1lBQ3pHQSx5QkFBeUJTLFFBQVFDLEdBQUcsQ0FBQ1YsdUJBQXVCLElBQUlTLFFBQVFDLEdBQUcsQ0FBQ1gsMEJBQTBCO1lBQ3RHRSxrQkFBa0JRLFFBQVFDLEdBQUcsQ0FBQ1QsZ0JBQWdCO1lBQzlDRSxzQkFBc0JNLFFBQVFDLEdBQUcsQ0FBQ1Asb0JBQW9CO1lBQ3RELG9CQUFvQjtZQUNwQkMsYUFBYUssUUFBUUMsR0FBRyxDQUFDTixXQUFXO1lBQ3BDLHVCQUF1QjtZQUN2QkMsd0JBQXdCSSxRQUFRQyxHQUFHLENBQUNMLHNCQUFzQjtZQUMxREMseUJBQXlCRyxRQUFRQyxHQUFHLENBQUNKLHVCQUF1QjtRQUM5RDtJQUNGLEVBQUUsT0FBT0ssT0FBTztRQUNkLElBQUlBLGlCQUFpQnpDLHlDQUFVLEVBQUU7WUFDL0IsTUFBTTJDLGNBQWNGLE1BQU1HLE1BQU0sQ0FBQ0MsR0FBRyxDQUFDLENBQUNDLElBQU1BLEVBQUVDLElBQUksQ0FBQ0MsSUFBSSxDQUFDLE1BQU1BLElBQUksQ0FBQztZQUNuRSxNQUFNLElBQUlDLE1BQ1IsQ0FBQywwQ0FBMEMsRUFBRU4sWUFBWSxFQUFFLENBQUMsR0FDMUQ7UUFFTjtRQUNBLE1BQU1GO0lBQ1I7QUFDRjtBQUVPLE1BQU1ELE1BQU1ILFNBQVEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ydXJhbC1oZWFsdGgtcGxhdGZvcm0vLi9saWIvZW52LnRzPzkzZjIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCdcblxuY29uc3QgZW52U2NoZW1hID0gei5vYmplY3Qoe1xuICBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw6IHouc3RyaW5nKCkudXJsKCdJbnZhbGlkIFN1cGFiYXNlIFVSTCcpLFxuICBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTogei5zdHJpbmcoKS5taW4oMSwgJ1N1cGFiYXNlIGFub24ga2V5IGlzIHJlcXVpcmVkJyksXG4gIFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk6IHouc3RyaW5nKCkubWluKDEsICdTdXBhYmFzZSBzZXJ2aWNlIHJvbGUga2V5IGlzIHJlcXVpcmVkJykub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfQVBQX1VSTDogei5zdHJpbmcoKS51cmwoJ0ludmFsaWQgYXBwIFVSTCcpLm9wdGlvbmFsKCksXG4gIC8vIFR3aWxpbyBTTVMgQ29uZmlndXJhdGlvbiAob3B0aW9uYWwpXG4gIFRXSUxJT19BQ0NPVU5UX1NJRDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBUV0lMSU9fQVVUSF9UT0tFTjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBUV0lMSU9fUEhPTkVfTlVNQkVSOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIC8vIFR3aWxpbyBWaWRlby9Wb2ljZSBDb25maWd1cmF0aW9uIChvcHRpb25hbClcbiAgVFdJTElPX0FQSV9LRVk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgVFdJTElPX0FQSV9TRUNSRVQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgLy8gRW1haWwgQ29uZmlndXJhdGlvbiAob3B0aW9uYWwgLSBTZW5kR3JpZCBvciBBV1MgU0VTKVxuICAvLyBTZW5kR3JpZFxuICBTRU5ER1JJRF9BUElfS0VZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFNFTkRHUklEX0ZST01fRU1BSUw6IHouc3RyaW5nKCkuZW1haWwoJ0ludmFsaWQgU2VuZEdyaWQgZnJvbSBlbWFpbCcpLm9wdGlvbmFsKCksXG4gIFNFTkRHUklEX0ZST01fTkFNRTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAvLyBBV1MgU0VTXG4gIEFXU19TRVNfUkVHSU9OOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEFXU19TRVNfQUNDRVNTX0tFWV9JRDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBBV1NfU0VTX1NFQ1JFVF9BQ0NFU1NfS0VZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEFXU19TRVNfRlJPTV9FTUFJTDogei5zdHJpbmcoKS5lbWFpbCgnSW52YWxpZCBBV1MgU0VTIGZyb20gZW1haWwnKS5vcHRpb25hbCgpLFxuICAvLyBEZWZhdWx0IGVtYWlsIGNvbmZpZ3VyYXRpb25cbiAgRU1BSUxfRlJPTTogei5zdHJpbmcoKS5lbWFpbCgnSW52YWxpZCBkZWZhdWx0IGVtYWlsJykub3B0aW9uYWwoKSxcbiAgRU1BSUxfRlJPTV9OQU1FOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIC8vIEZsdXR0ZXJ3YXZlIFBheW1lbnQgR2F0ZXdheSBDb25maWd1cmF0aW9uIChvcHRpb25hbClcbiAgRkxVVFRFUldBVkVfUFVCTElDX0tFWTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBGTFVUVEVSV0FWRV9TRUNSRVRfS0VZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEZMVVRURVJXQVZFX0VOQ1JZUFRJT05fS0VZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEZMVVRURVJXQVZFX1dFQkhPT0tfU0VDUkVUOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEZMVVRURVJXQVZFX1NFQ1JFVF9IQVNIOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIEFsaWFzIGZvciBGTFVUVEVSV0FWRV9XRUJIT09LX1NFQ1JFVFxuICBGTFVUVEVSV0FWRV9NT0RFOiB6LmVudW0oWydzYW5kYm94JywgJ2xpdmUnXSkub3B0aW9uYWwoKSxcbiAgRU5BQkxFX01PQ0tfUEFZTUVOVFM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgLy8gQ3JvbiBqb2Igc2VjdXJpdHkgKG9wdGlvbmFsIGJ1dCByZWNvbW1lbmRlZClcbiAgQ1JPTl9TRUNSRVQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgLy8gU2VudHJ5IEVycm9yIE1vbml0b3JpbmcgQ29uZmlndXJhdGlvbiAob3B0aW9uYWwpXG4gIE5FWFRfUFVCTElDX1NFTlRSWV9EU046IHouc3RyaW5nKCkudXJsKCdJbnZhbGlkIFNlbnRyeSBEU04nKS5vcHRpb25hbCgpLFxuICBORVhUX1BVQkxJQ19BUFBfVkVSU0lPTjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSlcblxuLy8gUGFyc2UgYW5kIHZhbGlkYXRlIGVudmlyb25tZW50IHZhcmlhYmxlc1xuZnVuY3Rpb24gZ2V0RW52KCkge1xuICB0cnkge1xuICAgIHJldHVybiBlbnZTY2hlbWEucGFyc2Uoe1xuICAgICAgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXG4gICAgICBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVksXG4gICAgICBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZOiBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZLFxuICAgICAgTkVYVF9QVUJMSUNfQVBQX1VSTDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyxcbiAgICAgIFRXSUxJT19BQ0NPVU5UX1NJRDogcHJvY2Vzcy5lbnYuVFdJTElPX0FDQ09VTlRfU0lELFxuICAgICAgVFdJTElPX0FVVEhfVE9LRU46IHByb2Nlc3MuZW52LlRXSUxJT19BVVRIX1RPS0VOLFxuICAgICAgVFdJTElPX1BIT05FX05VTUJFUjogcHJvY2Vzcy5lbnYuVFdJTElPX1BIT05FX05VTUJFUixcbiAgICAgIFRXSUxJT19BUElfS0VZOiBwcm9jZXNzLmVudi5UV0lMSU9fQVBJX0tFWSxcbiAgICAgIFRXSUxJT19BUElfU0VDUkVUOiBwcm9jZXNzLmVudi5UV0lMSU9fQVBJX1NFQ1JFVCxcbiAgICAgIC8vIEVtYWlsIGNvbmZpZ3VyYXRpb25cbiAgICAgIFNFTkRHUklEX0FQSV9LRVk6IHByb2Nlc3MuZW52LlNFTkRHUklEX0FQSV9LRVksXG4gICAgICBTRU5ER1JJRF9GUk9NX0VNQUlMOiBwcm9jZXNzLmVudi5TRU5ER1JJRF9GUk9NX0VNQUlMLFxuICAgICAgU0VOREdSSURfRlJPTV9OQU1FOiBwcm9jZXNzLmVudi5TRU5ER1JJRF9GUk9NX05BTUUsXG4gICAgICBBV1NfU0VTX1JFR0lPTjogcHJvY2Vzcy5lbnYuQVdTX1NFU19SRUdJT04sXG4gICAgICBBV1NfU0VTX0FDQ0VTU19LRVlfSUQ6IHByb2Nlc3MuZW52LkFXU19TRVNfQUNDRVNTX0tFWV9JRCxcbiAgICAgIEFXU19TRVNfU0VDUkVUX0FDQ0VTU19LRVk6IHByb2Nlc3MuZW52LkFXU19TRVNfU0VDUkVUX0FDQ0VTU19LRVksXG4gICAgICBBV1NfU0VTX0ZST01fRU1BSUw6IHByb2Nlc3MuZW52LkFXU19TRVNfRlJPTV9FTUFJTCxcbiAgICAgIEVNQUlMX0ZST006IHByb2Nlc3MuZW52LkVNQUlMX0ZST00sXG4gICAgICBFTUFJTF9GUk9NX05BTUU6IHByb2Nlc3MuZW52LkVNQUlMX0ZST01fTkFNRSxcbiAgICAgIC8vIEZsdXR0ZXJ3YXZlIFBheW1lbnQgR2F0ZXdheSBDb25maWd1cmF0aW9uIChvcHRpb25hbClcbiAgICAgIEZMVVRURVJXQVZFX1BVQkxJQ19LRVk6IHByb2Nlc3MuZW52LkZMVVRURVJXQVZFX1BVQkxJQ19LRVksXG4gICAgICBGTFVUVEVSV0FWRV9TRUNSRVRfS0VZOiBwcm9jZXNzLmVudi5GTFVUVEVSV0FWRV9TRUNSRVRfS0VZLFxuICAgICAgRkxVVFRFUldBVkVfRU5DUllQVElPTl9LRVk6IHByb2Nlc3MuZW52LkZMVVRURVJXQVZFX0VOQ1JZUFRJT05fS0VZLFxuICAgICAgRkxVVFRFUldBVkVfV0VCSE9PS19TRUNSRVQ6IHByb2Nlc3MuZW52LkZMVVRURVJXQVZFX1dFQkhPT0tfU0VDUkVUIHx8IHByb2Nlc3MuZW52LkZMVVRURVJXQVZFX1NFQ1JFVF9IQVNILCAvLyBTdXBwb3J0IGJvdGggbmFtZXNcbiAgICAgIEZMVVRURVJXQVZFX1NFQ1JFVF9IQVNIOiBwcm9jZXNzLmVudi5GTFVUVEVSV0FWRV9TRUNSRVRfSEFTSCB8fCBwcm9jZXNzLmVudi5GTFVUVEVSV0FWRV9XRUJIT09LX1NFQ1JFVCwgLy8gQWxpYXNcbiAgICAgIEZMVVRURVJXQVZFX01PREU6IHByb2Nlc3MuZW52LkZMVVRURVJXQVZFX01PREUsXG4gICAgICBFTkFCTEVfTU9DS19QQVlNRU5UUzogcHJvY2Vzcy5lbnYuRU5BQkxFX01PQ0tfUEFZTUVOVFMsXG4gICAgICAvLyBDcm9uIGpvYiBzZWN1cml0eVxuICAgICAgQ1JPTl9TRUNSRVQ6IHByb2Nlc3MuZW52LkNST05fU0VDUkVULFxuICAgICAgLy8gU2VudHJ5IGNvbmZpZ3VyYXRpb25cbiAgICAgIE5FWFRfUFVCTElDX1NFTlRSWV9EU046IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NFTlRSWV9EU04sXG4gICAgICBORVhUX1BVQkxJQ19BUFBfVkVSU0lPTjogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1ZFUlNJT04sXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICBjb25zdCBtaXNzaW5nVmFycyA9IGVycm9yLmlzc3Vlcy5tYXAoKGUpID0+IGUucGF0aC5qb2luKCcuJykpLmpvaW4oJywgJylcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYE1pc3Npbmcgb3IgaW52YWxpZCBlbnZpcm9ubWVudCB2YXJpYWJsZXM6ICR7bWlzc2luZ1ZhcnN9XFxuYCArXG4gICAgICAgICAgJ1BsZWFzZSBjaGVjayB5b3VyIC5lbnYubG9jYWwgZmlsZSBhbmQgZW5zdXJlIGFsbCByZXF1aXJlZCB2YXJpYWJsZXMgYXJlIHNldC4nXG4gICAgICApXG4gICAgfVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGVudiA9IGdldEVudigpXG5cbiJdLCJuYW1lcyI6WyJ6IiwiZW52U2NoZW1hIiwib2JqZWN0IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3RyaW5nIiwidXJsIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJtaW4iLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwib3B0aW9uYWwiLCJORVhUX1BVQkxJQ19BUFBfVVJMIiwiVFdJTElPX0FDQ09VTlRfU0lEIiwiVFdJTElPX0FVVEhfVE9LRU4iLCJUV0lMSU9fUEhPTkVfTlVNQkVSIiwiVFdJTElPX0FQSV9LRVkiLCJUV0lMSU9fQVBJX1NFQ1JFVCIsIlNFTkRHUklEX0FQSV9LRVkiLCJTRU5ER1JJRF9GUk9NX0VNQUlMIiwiZW1haWwiLCJTRU5ER1JJRF9GUk9NX05BTUUiLCJBV1NfU0VTX1JFR0lPTiIsIkFXU19TRVNfQUNDRVNTX0tFWV9JRCIsIkFXU19TRVNfU0VDUkVUX0FDQ0VTU19LRVkiLCJBV1NfU0VTX0ZST01fRU1BSUwiLCJFTUFJTF9GUk9NIiwiRU1BSUxfRlJPTV9OQU1FIiwiRkxVVFRFUldBVkVfUFVCTElDX0tFWSIsIkZMVVRURVJXQVZFX1NFQ1JFVF9LRVkiLCJGTFVUVEVSV0FWRV9FTkNSWVBUSU9OX0tFWSIsIkZMVVRURVJXQVZFX1dFQkhPT0tfU0VDUkVUIiwiRkxVVFRFUldBVkVfU0VDUkVUX0hBU0giLCJGTFVUVEVSV0FWRV9NT0RFIiwiZW51bSIsIkVOQUJMRV9NT0NLX1BBWU1FTlRTIiwiQ1JPTl9TRUNSRVQiLCJORVhUX1BVQkxJQ19TRU5UUllfRFNOIiwiTkVYVF9QVUJMSUNfQVBQX1ZFUlNJT04iLCJnZXRFbnYiLCJwYXJzZSIsInByb2Nlc3MiLCJlbnYiLCJlcnJvciIsIlpvZEVycm9yIiwibWlzc2luZ1ZhcnMiLCJpc3N1ZXMiLCJtYXAiLCJlIiwicGF0aCIsImpvaW4iLCJFcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/env.ts\n");

/***/ }),

/***/ "(rsc)/./lib/notifications/email.ts":
/*!************************************!*\
  !*** ./lib/notifications/email.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EmailService: () => (/* binding */ EmailService),\n/* harmony export */   emailService: () => (/* binding */ emailService)\n/* harmony export */ });\n/**\n * Email Notification Service\n * Handles sending email notifications via SendGrid or AWS SES\n */ class EmailService {\n    constructor(){\n        // SendGrid configuration\n        this.sendGridApiKey = process.env.SENDGRID_API_KEY;\n        this.sendGridFromEmail = process.env.SENDGRID_FROM_EMAIL;\n        this.sendGridFromName = process.env.SENDGRID_FROM_NAME || \"HealthConnect\";\n        // AWS SES configuration\n        this.sesRegion = process.env.AWS_SES_REGION;\n        this.sesAccessKeyId = process.env.AWS_SES_ACCESS_KEY_ID;\n        this.sesSecretAccessKey = process.env.AWS_SES_SECRET_ACCESS_KEY;\n        this.sesFromEmail = process.env.AWS_SES_FROM_EMAIL;\n        // Default configuration\n        this.defaultFromEmail = process.env.EMAIL_FROM || \"noreply@healthconnect.app\";\n        this.defaultFromName = process.env.EMAIL_FROM_NAME || \"HealthConnect\";\n        // Determine provider and if enabled\n        if (this.sendGridApiKey) {\n            this.provider = \"sendgrid\";\n            this.enabled = true;\n        } else if (this.sesAccessKeyId && this.sesSecretAccessKey && this.sesRegion) {\n            this.provider = \"ses\";\n            this.enabled = true;\n        } else {\n            this.provider = \"none\";\n            this.enabled = false;\n        }\n    }\n    /**\n   * Send email via configured provider\n   */ async sendEmail(options) {\n        if (!this.enabled) {\n            console.warn(\"Email service not configured. Skipping email send.\");\n            console.log(\"Would send email:\", {\n                to: options.to,\n                subject: options.subject\n            });\n            return {\n                success: false,\n                error: \"Email service not configured\"\n            };\n        }\n        try {\n            if (this.provider === \"sendgrid\") {\n                return await this.sendViaSendGrid(options);\n            } else if (this.provider === \"ses\") {\n                return await this.sendViaSES(options);\n            } else {\n                return {\n                    success: false,\n                    error: \"No email provider configured\"\n                };\n            }\n        } catch (error) {\n            console.error(\"Error sending email:\", error);\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : \"Unknown error\"\n            };\n        }\n    }\n    /**\n   * Send email via SendGrid API\n   */ async sendViaSendGrid(options) {\n        if (!this.sendGridApiKey) {\n            return {\n                success: false,\n                error: \"SendGrid API key not configured\"\n            };\n        }\n        const fromEmail = options.from || this.sendGridFromEmail || this.defaultFromEmail;\n        const fromName = options.fromName || this.sendGridFromName || this.defaultFromName;\n        try {\n            const response = await fetch(\"https://api.sendgrid.com/v3/mail/send\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${this.sendGridApiKey}`\n                },\n                body: JSON.stringify({\n                    personalizations: [\n                        {\n                            to: [\n                                {\n                                    email: options.to\n                                }\n                            ],\n                            subject: options.subject\n                        }\n                    ],\n                    from: {\n                        email: fromEmail,\n                        name: fromName\n                    },\n                    content: [\n                        {\n                            type: \"text/html\",\n                            value: options.html\n                        },\n                        ...options.text ? [\n                            {\n                                type: \"text/plain\",\n                                value: options.text\n                            }\n                        ] : []\n                    ]\n                })\n            });\n            if (!response.ok) {\n                const errorText = await response.text();\n                console.error(\"SendGrid API error:\", errorText);\n                return {\n                    success: false,\n                    error: `SendGrid API error: ${response.status}`\n                };\n            }\n            // SendGrid returns empty body on success, but includes message-id in headers\n            const messageId = response.headers.get(\"x-message-id\") || undefined;\n            return {\n                success: true,\n                messageId\n            };\n        } catch (error) {\n            console.error(\"SendGrid error:\", error);\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : \"Unknown SendGrid error\"\n            };\n        }\n    }\n    /**\n   * Send email via AWS SES API\n   * \n   * IMPORTANT: This implementation requires @aws-sdk/client-ses to be installed\n   * for production use. AWS SES requires proper Signature v4 signing which cannot\n   * be implemented with simple fetch requests.\n   * \n   * To use AWS SES:\n   * 1. Install: npm install @aws-sdk/client-ses\n   * 2. Configure AWS credentials in .env.local\n   * 3. The SDK will be used automatically if installed\n   * \n   * For now, this returns an error directing users to install the SDK.\n   * Most users should use SendGrid instead (simpler setup).\n   */ async sendViaSES(options) {\n        if (!this.sesAccessKeyId || !this.sesSecretAccessKey || !this.sesRegion) {\n            return {\n                success: false,\n                error: \"AWS SES not fully configured\"\n            };\n        }\n        // Check if AWS SDK is installed at runtime\n        // Use a runtime require check to avoid Next.js build-time module analysis\n        let awsSDK = null;\n        try {\n            // Check if we're in Node.js environment and module exists\n            if (true) {\n                // Try to require the module - this won't be analyzed at build time\n                const requireFunc = undefined;\n                awsSDK = __webpack_require__(/*! @aws-sdk/client-ses */ \"(rsc)/./node_modules/@aws-sdk/client-ses/dist-es/index.js\");\n            } else {}\n        } catch (e) {\n            // AWS SDK not installed or not in Node.js environment\n            const errorMsg = e?.code === \"MODULE_NOT_FOUND\" || e?.message?.includes(\"require\") ? \"AWS SDK not installed. To use AWS SES, install @aws-sdk/client-ses: npm install @aws-sdk/client-ses. Alternatively, use SendGrid (simpler setup).\" : \"AWS SES requires Node.js environment. Use SendGrid for simpler setup.\";\n            return {\n                success: false,\n                error: errorMsg\n            };\n        }\n        // If we get here, AWS SDK is available\n        const fromEmail = options.from || this.sesFromEmail || this.defaultFromEmail;\n        try {\n            const { SESClient, SendEmailCommand } = awsSDK;\n            const sesClient = new SESClient({\n                region: this.sesRegion,\n                credentials: {\n                    accessKeyId: this.sesAccessKeyId,\n                    secretAccessKey: this.sesSecretAccessKey\n                }\n            });\n            const command = new SendEmailCommand({\n                Source: fromEmail,\n                Destination: {\n                    ToAddresses: [\n                        options.to\n                    ]\n                },\n                Message: {\n                    Subject: {\n                        Data: options.subject,\n                        Charset: \"UTF-8\"\n                    },\n                    Body: {\n                        Html: {\n                            Data: options.html,\n                            Charset: \"UTF-8\"\n                        },\n                        ...options.text ? {\n                            Text: {\n                                Data: options.text,\n                                Charset: \"UTF-8\"\n                            }\n                        } : {}\n                    }\n                }\n            });\n            const response = await sesClient.send(command);\n            return {\n                success: true,\n                messageId: response.MessageId\n            };\n        } catch (error) {\n            console.error(\"AWS SES error:\", error);\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : \"Unknown AWS SES error\"\n            };\n        }\n    }\n    /**\n   * Generate HTML email template wrapper\n   */ getEmailTemplate(content, title) {\n        return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>${title || \"HealthConnect Notification\"}</title>\n</head>\n<body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n  <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; border-radius: 8px 8px 0 0;\">\n    <h1 style=\"color: white; margin: 0; font-size: 24px;\">HealthConnect</h1>\n  </div>\n  <div style=\"background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 8px 8px;\">\n    ${content}\n  </div>\n  <div style=\"text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px;\">\n    <p>© ${new Date().getFullYear()} HealthConnect. All rights reserved.</p>\n    <p style=\"margin-top: 10px;\">This is an automated message. Please do not reply to this email.</p>\n  </div>\n</body>\n</html>\n    `.trim();\n    }\n    /**\n   * Provider booking notification email (new consultation request)\n   */ async sendProviderBookingEmail(to, patientName, consultationType, scheduledAt, consultationId) {\n        const appUrl = \"http://localhost:3000\" || 0;\n        const consultationUrl = `${appUrl}/doctor/consultations`;\n        const scheduledInfo = scheduledAt ? new Date(scheduledAt).toLocaleString(\"en-US\", {\n            dateStyle: \"long\",\n            timeStyle: \"short\"\n        }) : \"To be scheduled\";\n        const content = `\n      <h2 style=\"color: #1f2937; margin-top: 0;\">New Consultation Request</h2>\n      <p>You have received a new consultation request.</p>\n      \n      <div style=\"background: white; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #667eea;\">\n        <p style=\"margin: 5px 0;\"><strong>Patient:</strong> ${patientName}</p>\n        <p style=\"margin: 5px 0;\"><strong>Type:</strong> ${consultationType}</p>\n        <p style=\"margin: 5px 0;\"><strong>Scheduled:</strong> ${scheduledInfo}</p>\n      </div>\n\n      <p>Please log in to accept or decline this consultation request.</p>\n      \n      <div style=\"text-align: center; margin: 30px 0;\">\n        <a href=\"${consultationUrl}\" style=\"background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">View Consultation</a>\n      </div>\n    `;\n        return this.sendEmail({\n            to,\n            subject: \"New Consultation Request - HealthConnect\",\n            html: this.getEmailTemplate(content, \"New Consultation Request\"),\n            text: `New Consultation Request\\n\\nPatient: ${patientName}\\nType: ${consultationType}\\nScheduled: ${scheduledInfo}\\n\\nView: ${consultationUrl}`\n        });\n    }\n    /**\n   * Consultation assigned notification email\n   */ async sendConsultationAssignedEmail(to, providerName, consultationType, scheduledDate, consultationId) {\n        const appUrl = \"http://localhost:3000\" || 0;\n        const consultationUrl = `${appUrl}/consultation/${consultationId}`;\n        const content = `\n      <h2 style=\"color: #1f2937; margin-top: 0;\">Provider Assigned to Your Consultation</h2>\n      <p>Great news! A healthcare provider has been assigned to your consultation request.</p>\n      \n      <div style=\"background: white; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #667eea;\">\n        <p style=\"margin: 5px 0;\"><strong>Provider:</strong> ${providerName}</p>\n        <p style=\"margin: 5px 0;\"><strong>Type:</strong> ${consultationType}</p>\n        <p style=\"margin: 5px 0;\"><strong>Scheduled:</strong> ${scheduledDate}</p>\n      </div>\n\n      <p>Please log in to confirm this provider or choose another provider if needed.</p>\n      \n      <div style=\"text-align: center; margin: 30px 0;\">\n        <a href=\"${consultationUrl}\" style=\"background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">View Consultation</a>\n      </div>\n    `;\n        return this.sendEmail({\n            to,\n            subject: \"Provider Assigned - HealthConnect\",\n            html: this.getEmailTemplate(content, \"Provider Assigned\"),\n            text: `Provider Assigned to Your Consultation\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nView: ${consultationUrl}`\n        });\n    }\n    /**\n   * Consultation confirmed notification email\n   */ async sendConsultationConfirmedEmail(to, providerName, consultationType, scheduledAt, consultationId) {\n        const appUrl = \"http://localhost:3000\" || 0;\n        const consultationUrl = `${appUrl}/consultation/${consultationId}`;\n        const scheduledDate = new Date(scheduledAt).toLocaleString(\"en-US\", {\n            dateStyle: \"long\",\n            timeStyle: \"short\"\n        });\n        const content = `\n      <h2 style=\"color: #1f2937; margin-top: 0;\">Consultation Confirmed</h2>\n      <p>Your consultation has been confirmed and is scheduled.</p>\n      \n      <div style=\"background: white; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #10b981;\">\n        <p style=\"margin: 5px 0;\"><strong>Provider:</strong> ${providerName}</p>\n        <p style=\"margin: 5px 0;\"><strong>Type:</strong> ${consultationType}</p>\n        <p style=\"margin: 5px 0;\"><strong>Scheduled:</strong> ${scheduledDate}</p>\n      </div>\n\n      <p>You will receive a reminder 1 hour before your consultation.</p>\n      \n      <div style=\"text-align: center; margin: 30px 0;\">\n        <a href=\"${consultationUrl}\" style=\"background: #10b981; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">View Consultation</a>\n      </div>\n    `;\n        return this.sendEmail({\n            to,\n            subject: \"Consultation Confirmed - HealthConnect\",\n            html: this.getEmailTemplate(content, \"Consultation Confirmed\"),\n            text: `Consultation Confirmed\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nView: ${consultationUrl}`\n        });\n    }\n    /**\n   * Payment successful notification email\n   */ async sendPaymentConfirmationEmail(to, amount, consultationType, consultationId) {\n        const appUrl = \"http://localhost:3000\" || 0;\n        const consultationUrl = `${appUrl}/consultation/${consultationId}`;\n        const formattedAmount = new Intl.NumberFormat(\"en-US\", {\n            style: \"currency\",\n            currency: \"SLL\",\n            minimumFractionDigits: 0\n        }).format(amount);\n        const content = `\n      <h2 style=\"color: #1f2937; margin-top: 0;\">Payment Confirmed</h2>\n      <p>Your payment has been processed successfully.</p>\n      \n      <div style=\"background: white; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #10b981;\">\n        <p style=\"margin: 5px 0;\"><strong>Amount:</strong> ${formattedAmount}</p>\n        <p style=\"margin: 5px 0;\"><strong>Consultation Type:</strong> ${consultationType}</p>\n        <p style=\"margin: 5px 0;\"><strong>Status:</strong> Payment Confirmed</p>\n      </div>\n\n      <p>Your consultation is now confirmed. You will receive scheduling details soon.</p>\n      \n      <div style=\"text-align: center; margin: 30px 0;\">\n        <a href=\"${consultationUrl}\" style=\"background: #10b981; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">View Consultation</a>\n      </div>\n    `;\n        return this.sendEmail({\n            to,\n            subject: \"Payment Confirmed - HealthConnect\",\n            html: this.getEmailTemplate(content, \"Payment Confirmed\"),\n            text: `Payment Confirmed\\n\\nAmount: ${formattedAmount}\\nConsultation: ${consultationType}\\n\\nView: ${consultationUrl}`\n        });\n    }\n    /**\n   * Consultation reminder email\n   */ async sendConsultationReminderEmail(to, providerName, consultationType, scheduledAt, consultationId) {\n        const appUrl = \"http://localhost:3000\" || 0;\n        const consultationUrl = `${appUrl}/consultation/${consultationId}`;\n        const scheduledDate = new Date(scheduledAt).toLocaleString(\"en-US\", {\n            dateStyle: \"long\",\n            timeStyle: \"short\"\n        });\n        const content = `\n      <h2 style=\"color: #1f2937; margin-top: 0;\">Consultation Reminder</h2>\n      <p>This is a reminder that you have a consultation scheduled soon.</p>\n      \n      <div style=\"background: white; padding: 20px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #f59e0b;\">\n        <p style=\"margin: 5px 0;\"><strong>Provider:</strong> ${providerName}</p>\n        <p style=\"margin: 5px 0;\"><strong>Type:</strong> ${consultationType}</p>\n        <p style=\"margin: 5px 0;\"><strong>Scheduled:</strong> ${scheduledDate}</p>\n      </div>\n\n      <p>Please join the consultation on time. If you need to reschedule, please contact us as soon as possible.</p>\n      \n      <div style=\"text-align: center; margin: 30px 0;\">\n        <a href=\"${consultationUrl}\" style=\"background: #f59e0b; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">View Consultation</a>\n      </div>\n    `;\n        return this.sendEmail({\n            to,\n            subject: \"Consultation Reminder - HealthConnect\",\n            html: this.getEmailTemplate(content, \"Consultation Reminder\"),\n            text: `Consultation Reminder\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nView: ${consultationUrl}`\n        });\n    }\n}\nconst emailService = new EmailService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YnBhY2s6Ly9ydXJhbC1oZWFsdGgtcGxhdGZvcm0vLi9saWIvbm90aWZpY2F0aW9ucy9lbWFpbC50cz80OWU3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW1haWwgTm90aWZpY2F0aW9uIFNlcnZpY2VcbiAqIEhhbmRsZXMgc2VuZGluZyBlbWFpbCBub3RpZmljYXRpb25zIHZpYSBTZW5kR3JpZCBvciBBV1MgU0VTXG4gKi9cblxuaW50ZXJmYWNlIEVtYWlsT3B0aW9ucyB7XG4gIHRvOiBzdHJpbmc7XG4gIHN1YmplY3Q6IHN0cmluZztcbiAgaHRtbDogc3RyaW5nO1xuICB0ZXh0Pzogc3RyaW5nO1xuICBmcm9tPzogc3RyaW5nO1xuICBmcm9tTmFtZT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEVtYWlsUmVzcG9uc2Uge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBtZXNzYWdlSWQ/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xufVxuXG50eXBlIEVtYWlsUHJvdmlkZXIgPSBcInNlbmRncmlkXCIgfCBcInNlc1wiIHwgXCJub25lXCI7XG5cbmV4cG9ydCBjbGFzcyBFbWFpbFNlcnZpY2Uge1xuICBwcml2YXRlIHByb3ZpZGVyOiBFbWFpbFByb3ZpZGVyO1xuICBwcml2YXRlIHNlbmRHcmlkQXBpS2V5OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgc2VuZEdyaWRGcm9tRW1haWw6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBzZW5kR3JpZEZyb21OYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgc2VzUmVnaW9uOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgc2VzQWNjZXNzS2V5SWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBzZXNTZWNyZXRBY2Nlc3NLZXk6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBzZXNGcm9tRW1haWw6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBkZWZhdWx0RnJvbUVtYWlsOiBzdHJpbmc7XG4gIHByaXZhdGUgZGVmYXVsdEZyb21OYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgZW5hYmxlZDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBTZW5kR3JpZCBjb25maWd1cmF0aW9uXG4gICAgdGhpcy5zZW5kR3JpZEFwaUtleSA9IHByb2Nlc3MuZW52LlNFTkRHUklEX0FQSV9LRVk7XG4gICAgdGhpcy5zZW5kR3JpZEZyb21FbWFpbCA9IHByb2Nlc3MuZW52LlNFTkRHUklEX0ZST01fRU1BSUw7XG4gICAgdGhpcy5zZW5kR3JpZEZyb21OYW1lID0gcHJvY2Vzcy5lbnYuU0VOREdSSURfRlJPTV9OQU1FIHx8IFwiSGVhbHRoQ29ubmVjdFwiO1xuXG4gICAgLy8gQVdTIFNFUyBjb25maWd1cmF0aW9uXG4gICAgdGhpcy5zZXNSZWdpb24gPSBwcm9jZXNzLmVudi5BV1NfU0VTX1JFR0lPTjtcbiAgICB0aGlzLnNlc0FjY2Vzc0tleUlkID0gcHJvY2Vzcy5lbnYuQVdTX1NFU19BQ0NFU1NfS0VZX0lEO1xuICAgIHRoaXMuc2VzU2VjcmV0QWNjZXNzS2V5ID0gcHJvY2Vzcy5lbnYuQVdTX1NFU19TRUNSRVRfQUNDRVNTX0tFWTtcbiAgICB0aGlzLnNlc0Zyb21FbWFpbCA9IHByb2Nlc3MuZW52LkFXU19TRVNfRlJPTV9FTUFJTDtcblxuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvblxuICAgIHRoaXMuZGVmYXVsdEZyb21FbWFpbCA9IHByb2Nlc3MuZW52LkVNQUlMX0ZST00gfHwgXCJub3JlcGx5QGhlYWx0aGNvbm5lY3QuYXBwXCI7XG4gICAgdGhpcy5kZWZhdWx0RnJvbU5hbWUgPSBwcm9jZXNzLmVudi5FTUFJTF9GUk9NX05BTUUgfHwgXCJIZWFsdGhDb25uZWN0XCI7XG5cbiAgICAvLyBEZXRlcm1pbmUgcHJvdmlkZXIgYW5kIGlmIGVuYWJsZWRcbiAgICBpZiAodGhpcy5zZW5kR3JpZEFwaUtleSkge1xuICAgICAgdGhpcy5wcm92aWRlciA9IFwic2VuZGdyaWRcIjtcbiAgICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmICh0aGlzLnNlc0FjY2Vzc0tleUlkICYmIHRoaXMuc2VzU2VjcmV0QWNjZXNzS2V5ICYmIHRoaXMuc2VzUmVnaW9uKSB7XG4gICAgICB0aGlzLnByb3ZpZGVyID0gXCJzZXNcIjtcbiAgICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJvdmlkZXIgPSBcIm5vbmVcIjtcbiAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGVtYWlsIHZpYSBjb25maWd1cmVkIHByb3ZpZGVyXG4gICAqL1xuICBhc3luYyBzZW5kRW1haWwob3B0aW9uczogRW1haWxPcHRpb25zKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkVtYWlsIHNlcnZpY2Ugbm90IGNvbmZpZ3VyZWQuIFNraXBwaW5nIGVtYWlsIHNlbmQuXCIpO1xuICAgICAgY29uc29sZS5sb2coXCJXb3VsZCBzZW5kIGVtYWlsOlwiLCB7XG4gICAgICAgIHRvOiBvcHRpb25zLnRvLFxuICAgICAgICBzdWJqZWN0OiBvcHRpb25zLnN1YmplY3QsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogXCJFbWFpbCBzZXJ2aWNlIG5vdCBjb25maWd1cmVkXCIsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5wcm92aWRlciA9PT0gXCJzZW5kZ3JpZFwiKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRWaWFTZW5kR3JpZChvcHRpb25zKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm92aWRlciA9PT0gXCJzZXNcIikge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kVmlhU0VTKG9wdGlvbnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogXCJObyBlbWFpbCBwcm92aWRlciBjb25maWd1cmVkXCIsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIGVtYWlsOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGVtYWlsIHZpYSBTZW5kR3JpZCBBUElcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZFZpYVNlbmRHcmlkKG9wdGlvbnM6IEVtYWlsT3B0aW9ucyk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5zZW5kR3JpZEFwaUtleSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBcIlNlbmRHcmlkIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWRcIixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgZnJvbUVtYWlsID0gb3B0aW9ucy5mcm9tIHx8IHRoaXMuc2VuZEdyaWRGcm9tRW1haWwgfHwgdGhpcy5kZWZhdWx0RnJvbUVtYWlsO1xuICAgIGNvbnN0IGZyb21OYW1lID0gb3B0aW9ucy5mcm9tTmFtZSB8fCB0aGlzLnNlbmRHcmlkRnJvbU5hbWUgfHwgdGhpcy5kZWZhdWx0RnJvbU5hbWU7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vYXBpLnNlbmRncmlkLmNvbS92My9tYWlsL3NlbmRcIiwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuc2VuZEdyaWRBcGlLZXl9YCxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHBlcnNvbmFsaXphdGlvbnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdG86IFt7IGVtYWlsOiBvcHRpb25zLnRvIH1dLFxuICAgICAgICAgICAgICBzdWJqZWN0OiBvcHRpb25zLnN1YmplY3QsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgZnJvbToge1xuICAgICAgICAgICAgZW1haWw6IGZyb21FbWFpbCxcbiAgICAgICAgICAgIG5hbWU6IGZyb21OYW1lLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcInRleHQvaHRtbFwiLFxuICAgICAgICAgICAgICB2YWx1ZTogb3B0aW9ucy5odG1sLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC4uLihvcHRpb25zLnRleHRcbiAgICAgICAgICAgICAgPyBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dC9wbGFpblwiLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb3B0aW9ucy50ZXh0LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgIDogW10pLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiU2VuZEdyaWQgQVBJIGVycm9yOlwiLCBlcnJvclRleHQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiBgU2VuZEdyaWQgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBTZW5kR3JpZCByZXR1cm5zIGVtcHR5IGJvZHkgb24gc3VjY2VzcywgYnV0IGluY2x1ZGVzIG1lc3NhZ2UtaWQgaW4gaGVhZGVyc1xuICAgICAgY29uc3QgbWVzc2FnZUlkID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoXCJ4LW1lc3NhZ2UtaWRcIikgfHwgdW5kZWZpbmVkO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlSWQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU2VuZEdyaWQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIlVua25vd24gU2VuZEdyaWQgZXJyb3JcIixcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgZW1haWwgdmlhIEFXUyBTRVMgQVBJXG4gICAqIFxuICAgKiBJTVBPUlRBTlQ6IFRoaXMgaW1wbGVtZW50YXRpb24gcmVxdWlyZXMgQGF3cy1zZGsvY2xpZW50LXNlcyB0byBiZSBpbnN0YWxsZWRcbiAgICogZm9yIHByb2R1Y3Rpb24gdXNlLiBBV1MgU0VTIHJlcXVpcmVzIHByb3BlciBTaWduYXR1cmUgdjQgc2lnbmluZyB3aGljaCBjYW5ub3RcbiAgICogYmUgaW1wbGVtZW50ZWQgd2l0aCBzaW1wbGUgZmV0Y2ggcmVxdWVzdHMuXG4gICAqIFxuICAgKiBUbyB1c2UgQVdTIFNFUzpcbiAgICogMS4gSW5zdGFsbDogbnBtIGluc3RhbGwgQGF3cy1zZGsvY2xpZW50LXNlc1xuICAgKiAyLiBDb25maWd1cmUgQVdTIGNyZWRlbnRpYWxzIGluIC5lbnYubG9jYWxcbiAgICogMy4gVGhlIFNESyB3aWxsIGJlIHVzZWQgYXV0b21hdGljYWxseSBpZiBpbnN0YWxsZWRcbiAgICogXG4gICAqIEZvciBub3csIHRoaXMgcmV0dXJucyBhbiBlcnJvciBkaXJlY3RpbmcgdXNlcnMgdG8gaW5zdGFsbCB0aGUgU0RLLlxuICAgKiBNb3N0IHVzZXJzIHNob3VsZCB1c2UgU2VuZEdyaWQgaW5zdGVhZCAoc2ltcGxlciBzZXR1cCkuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRWaWFTRVMob3B0aW9uczogRW1haWxPcHRpb25zKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLnNlc0FjY2Vzc0tleUlkIHx8ICF0aGlzLnNlc1NlY3JldEFjY2Vzc0tleSB8fCAhdGhpcy5zZXNSZWdpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogXCJBV1MgU0VTIG5vdCBmdWxseSBjb25maWd1cmVkXCIsXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIEFXUyBTREsgaXMgaW5zdGFsbGVkIGF0IHJ1bnRpbWVcbiAgICAvLyBVc2UgYSBydW50aW1lIHJlcXVpcmUgY2hlY2sgdG8gYXZvaWQgTmV4dC5qcyBidWlsZC10aW1lIG1vZHVsZSBhbmFseXNpc1xuICAgIGxldCBhd3NTREs6IGFueSA9IG51bGw7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIGluIE5vZGUuanMgZW52aXJvbm1lbnQgYW5kIG1vZHVsZSBleGlzdHNcbiAgICAgIGlmICh0eXBlb2YgcmVxdWlyZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgLy8gVHJ5IHRvIHJlcXVpcmUgdGhlIG1vZHVsZSAtIHRoaXMgd29uJ3QgYmUgYW5hbHl6ZWQgYXQgYnVpbGQgdGltZVxuICAgICAgICBjb25zdCByZXF1aXJlRnVuYyA9IHJlcXVpcmU7XG4gICAgICAgIGF3c1NESyA9IHJlcXVpcmVGdW5jKCdAYXdzLXNkay9jbGllbnQtc2VzJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlcXVpcmUgbm90IGF2YWlsYWJsZScpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgLy8gQVdTIFNESyBub3QgaW5zdGFsbGVkIG9yIG5vdCBpbiBOb2RlLmpzIGVudmlyb25tZW50XG4gICAgICBjb25zdCBlcnJvck1zZyA9IGU/LmNvZGUgPT09ICdNT0RVTEVfTk9UX0ZPVU5EJyB8fCBlPy5tZXNzYWdlPy5pbmNsdWRlcygncmVxdWlyZScpXG4gICAgICAgID8gXCJBV1MgU0RLIG5vdCBpbnN0YWxsZWQuIFRvIHVzZSBBV1MgU0VTLCBpbnN0YWxsIEBhd3Mtc2RrL2NsaWVudC1zZXM6IG5wbSBpbnN0YWxsIEBhd3Mtc2RrL2NsaWVudC1zZXMuIEFsdGVybmF0aXZlbHksIHVzZSBTZW5kR3JpZCAoc2ltcGxlciBzZXR1cCkuXCJcbiAgICAgICAgOiBcIkFXUyBTRVMgcmVxdWlyZXMgTm9kZS5qcyBlbnZpcm9ubWVudC4gVXNlIFNlbmRHcmlkIGZvciBzaW1wbGVyIHNldHVwLlwiO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yTXNnLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBnZXQgaGVyZSwgQVdTIFNESyBpcyBhdmFpbGFibGVcbiAgICBjb25zdCBmcm9tRW1haWwgPSBvcHRpb25zLmZyb20gfHwgdGhpcy5zZXNGcm9tRW1haWwgfHwgdGhpcy5kZWZhdWx0RnJvbUVtYWlsO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgU0VTQ2xpZW50LCBTZW5kRW1haWxDb21tYW5kIH0gPSBhd3NTREs7XG4gICAgICBcbiAgICAgIGNvbnN0IHNlc0NsaWVudCA9IG5ldyBTRVNDbGllbnQoe1xuICAgICAgICByZWdpb246IHRoaXMuc2VzUmVnaW9uLFxuICAgICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICAgIGFjY2Vzc0tleUlkOiB0aGlzLnNlc0FjY2Vzc0tleUlkISxcbiAgICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6IHRoaXMuc2VzU2VjcmV0QWNjZXNzS2V5ISxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb21tYW5kID0gbmV3IFNlbmRFbWFpbENvbW1hbmQoe1xuICAgICAgICBTb3VyY2U6IGZyb21FbWFpbCxcbiAgICAgICAgRGVzdGluYXRpb246IHtcbiAgICAgICAgICBUb0FkZHJlc3NlczogW29wdGlvbnMudG9dLFxuICAgICAgICB9LFxuICAgICAgICBNZXNzYWdlOiB7XG4gICAgICAgICAgU3ViamVjdDoge1xuICAgICAgICAgICAgRGF0YTogb3B0aW9ucy5zdWJqZWN0LFxuICAgICAgICAgICAgQ2hhcnNldDogXCJVVEYtOFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgQm9keToge1xuICAgICAgICAgICAgSHRtbDoge1xuICAgICAgICAgICAgICBEYXRhOiBvcHRpb25zLmh0bWwsXG4gICAgICAgICAgICAgIENoYXJzZXQ6IFwiVVRGLThcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAuLi4ob3B0aW9ucy50ZXh0XG4gICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgVGV4dDoge1xuICAgICAgICAgICAgICAgICAgICBEYXRhOiBvcHRpb25zLnRleHQsXG4gICAgICAgICAgICAgICAgICAgIENoYXJzZXQ6IFwiVVRGLThcIixcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHt9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2VzQ2xpZW50LnNlbmQoY29tbWFuZCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlSWQ6IHJlc3BvbnNlLk1lc3NhZ2VJZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJBV1MgU0VTIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIEFXUyBTRVMgZXJyb3JcIixcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIEhUTUwgZW1haWwgdGVtcGxhdGUgd3JhcHBlclxuICAgKi9cbiAgcHJpdmF0ZSBnZXRFbWFpbFRlbXBsYXRlKGNvbnRlbnQ6IHN0cmluZywgdGl0bGU/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgXG48IURPQ1RZUEUgaHRtbD5cbjxodG1sIGxhbmc9XCJlblwiPlxuPGhlYWQ+XG4gIDxtZXRhIGNoYXJzZXQ9XCJVVEYtOFwiPlxuICA8bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwid2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMFwiPlxuICA8dGl0bGU+JHt0aXRsZSB8fCBcIkhlYWx0aENvbm5lY3QgTm90aWZpY2F0aW9uXCJ9PC90aXRsZT5cbjwvaGVhZD5cbjxib2R5IHN0eWxlPVwiZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ1NlZ29lIFVJJywgUm9ib3RvLCAnSGVsdmV0aWNhIE5ldWUnLCBBcmlhbCwgc2Fucy1zZXJpZjsgbGluZS1oZWlnaHQ6IDEuNjsgY29sb3I6ICMzMzM7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvOyBwYWRkaW5nOiAyMHB4O1wiPlxuICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsgcGFkZGluZzogMzBweDsgdGV4dC1hbGlnbjogY2VudGVyOyBib3JkZXItcmFkaXVzOiA4cHggOHB4IDAgMDtcIj5cbiAgICA8aDEgc3R5bGU9XCJjb2xvcjogd2hpdGU7IG1hcmdpbjogMDsgZm9udC1zaXplOiAyNHB4O1wiPkhlYWx0aENvbm5lY3Q8L2gxPlxuICA8L2Rpdj5cbiAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6ICNmOWZhZmI7IHBhZGRpbmc6IDMwcHg7IGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7IGJvcmRlci10b3A6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDAgMCA4cHggOHB4O1wiPlxuICAgICR7Y29udGVudH1cbiAgPC9kaXY+XG4gIDxkaXYgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbi10b3A6IDMwcHg7IHBhZGRpbmctdG9wOiAyMHB4OyBib3JkZXItdG9wOiAxcHggc29saWQgI2U1ZTdlYjsgY29sb3I6ICM2YjcyODA7IGZvbnQtc2l6ZTogMTRweDtcIj5cbiAgICA8cD7CqSAke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0gSGVhbHRoQ29ubmVjdC4gQWxsIHJpZ2h0cyByZXNlcnZlZC48L3A+XG4gICAgPHAgc3R5bGU9XCJtYXJnaW4tdG9wOiAxMHB4O1wiPlRoaXMgaXMgYW4gYXV0b21hdGVkIG1lc3NhZ2UuIFBsZWFzZSBkbyBub3QgcmVwbHkgdG8gdGhpcyBlbWFpbC48L3A+XG4gIDwvZGl2PlxuPC9ib2R5PlxuPC9odG1sPlxuICAgIGAudHJpbSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb3ZpZGVyIGJvb2tpbmcgbm90aWZpY2F0aW9uIGVtYWlsIChuZXcgY29uc3VsdGF0aW9uIHJlcXVlc3QpXG4gICAqL1xuICBhc3luYyBzZW5kUHJvdmlkZXJCb29raW5nRW1haWwoXG4gICAgdG86IHN0cmluZyxcbiAgICBwYXRpZW50TmFtZTogc3RyaW5nLFxuICAgIGNvbnN1bHRhdGlvblR5cGU6IHN0cmluZyxcbiAgICBzY2hlZHVsZWRBdDogc3RyaW5nIHwgbnVsbCxcbiAgICBjb25zdWx0YXRpb25JZDogc3RyaW5nXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGNvbnN0IGFwcFVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIjtcbiAgICBjb25zdCBjb25zdWx0YXRpb25VcmwgPSBgJHthcHBVcmx9L2RvY3Rvci9jb25zdWx0YXRpb25zYDtcblxuICAgIGNvbnN0IHNjaGVkdWxlZEluZm8gPSBzY2hlZHVsZWRBdFxuICAgICAgPyBuZXcgRGF0ZShzY2hlZHVsZWRBdCkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgICAgICAgZGF0ZVN0eWxlOiBcImxvbmdcIixcbiAgICAgICAgICB0aW1lU3R5bGU6IFwic2hvcnRcIixcbiAgICAgICAgfSlcbiAgICAgIDogXCJUbyBiZSBzY2hlZHVsZWRcIjtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBgXG4gICAgICA8aDIgc3R5bGU9XCJjb2xvcjogIzFmMjkzNzsgbWFyZ2luLXRvcDogMDtcIj5OZXcgQ29uc3VsdGF0aW9uIFJlcXVlc3Q8L2gyPlxuICAgICAgPHA+WW91IGhhdmUgcmVjZWl2ZWQgYSBuZXcgY29uc3VsdGF0aW9uIHJlcXVlc3QuPC9wPlxuICAgICAgXG4gICAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDIwcHg7IGJvcmRlci1yYWRpdXM6IDZweDsgbWFyZ2luOiAyMHB4IDA7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzY2N2VlYTtcIj5cbiAgICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+UGF0aWVudDo8L3N0cm9uZz4gJHtwYXRpZW50TmFtZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlR5cGU6PC9zdHJvbmc+ICR7Y29uc3VsdGF0aW9uVHlwZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNjaGVkdWxlZDo8L3N0cm9uZz4gJHtzY2hlZHVsZWRJbmZvfTwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8cD5QbGVhc2UgbG9nIGluIHRvIGFjY2VwdCBvciBkZWNsaW5lIHRoaXMgY29uc3VsdGF0aW9uIHJlcXVlc3QuPC9wPlxuICAgICAgXG4gICAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW46IDMwcHggMDtcIj5cbiAgICAgICAgPGEgaHJlZj1cIiR7Y29uc3VsdGF0aW9uVXJsfVwiIHN0eWxlPVwiYmFja2dyb3VuZDogIzY2N2VlYTsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxMnB4IDMwcHg7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyLXJhZGl1czogNnB4OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtd2VpZ2h0OiA2MDA7XCI+VmlldyBDb25zdWx0YXRpb248L2E+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgcmV0dXJuIHRoaXMuc2VuZEVtYWlsKHtcbiAgICAgIHRvLFxuICAgICAgc3ViamVjdDogXCJOZXcgQ29uc3VsdGF0aW9uIFJlcXVlc3QgLSBIZWFsdGhDb25uZWN0XCIsXG4gICAgICBodG1sOiB0aGlzLmdldEVtYWlsVGVtcGxhdGUoY29udGVudCwgXCJOZXcgQ29uc3VsdGF0aW9uIFJlcXVlc3RcIiksXG4gICAgICB0ZXh0OiBgTmV3IENvbnN1bHRhdGlvbiBSZXF1ZXN0XFxuXFxuUGF0aWVudDogJHtwYXRpZW50TmFtZX1cXG5UeXBlOiAke2NvbnN1bHRhdGlvblR5cGV9XFxuU2NoZWR1bGVkOiAke3NjaGVkdWxlZEluZm99XFxuXFxuVmlldzogJHtjb25zdWx0YXRpb25Vcmx9YCxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdWx0YXRpb24gYXNzaWduZWQgbm90aWZpY2F0aW9uIGVtYWlsXG4gICAqL1xuICBhc3luYyBzZW5kQ29uc3VsdGF0aW9uQXNzaWduZWRFbWFpbChcbiAgICB0bzogc3RyaW5nLFxuICAgIHByb3ZpZGVyTmFtZTogc3RyaW5nLFxuICAgIGNvbnN1bHRhdGlvblR5cGU6IHN0cmluZyxcbiAgICBzY2hlZHVsZWREYXRlOiBzdHJpbmcsXG4gICAgY29uc3VsdGF0aW9uSWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPEVtYWlsUmVzcG9uc2U+IHtcbiAgICBjb25zdCBhcHBVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUFBfVVJMIHx8IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwXCI7XG4gICAgY29uc3QgY29uc3VsdGF0aW9uVXJsID0gYCR7YXBwVXJsfS9jb25zdWx0YXRpb24vJHtjb25zdWx0YXRpb25JZH1gO1xuXG4gICAgY29uc3QgY29udGVudCA9IGBcbiAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjMWYyOTM3OyBtYXJnaW4tdG9wOiAwO1wiPlByb3ZpZGVyIEFzc2lnbmVkIHRvIFlvdXIgQ29uc3VsdGF0aW9uPC9oMj5cbiAgICAgIDxwPkdyZWF0IG5ld3MhIEEgaGVhbHRoY2FyZSBwcm92aWRlciBoYXMgYmVlbiBhc3NpZ25lZCB0byB5b3VyIGNvbnN1bHRhdGlvbiByZXF1ZXN0LjwvcD5cbiAgICAgIFxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICM2NjdlZWE7XCI+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlByb3ZpZGVyOjwvc3Ryb25nPiAke3Byb3ZpZGVyTmFtZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlR5cGU6PC9zdHJvbmc+ICR7Y29uc3VsdGF0aW9uVHlwZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNjaGVkdWxlZDo8L3N0cm9uZz4gJHtzY2hlZHVsZWREYXRlfTwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8cD5QbGVhc2UgbG9nIGluIHRvIGNvbmZpcm0gdGhpcyBwcm92aWRlciBvciBjaG9vc2UgYW5vdGhlciBwcm92aWRlciBpZiBuZWVkZWQuPC9wPlxuICAgICAgXG4gICAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW46IDMwcHggMDtcIj5cbiAgICAgICAgPGEgaHJlZj1cIiR7Y29uc3VsdGF0aW9uVXJsfVwiIHN0eWxlPVwiYmFja2dyb3VuZDogIzY2N2VlYTsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxMnB4IDMwcHg7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyLXJhZGl1czogNnB4OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtd2VpZ2h0OiA2MDA7XCI+VmlldyBDb25zdWx0YXRpb248L2E+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgcmV0dXJuIHRoaXMuc2VuZEVtYWlsKHtcbiAgICAgIHRvLFxuICAgICAgc3ViamVjdDogXCJQcm92aWRlciBBc3NpZ25lZCAtIEhlYWx0aENvbm5lY3RcIixcbiAgICAgIGh0bWw6IHRoaXMuZ2V0RW1haWxUZW1wbGF0ZShjb250ZW50LCBcIlByb3ZpZGVyIEFzc2lnbmVkXCIpLFxuICAgICAgdGV4dDogYFByb3ZpZGVyIEFzc2lnbmVkIHRvIFlvdXIgQ29uc3VsdGF0aW9uXFxuXFxuUHJvdmlkZXI6ICR7cHJvdmlkZXJOYW1lfVxcblR5cGU6ICR7Y29uc3VsdGF0aW9uVHlwZX1cXG5TY2hlZHVsZWQ6ICR7c2NoZWR1bGVkRGF0ZX1cXG5cXG5WaWV3OiAke2NvbnN1bHRhdGlvblVybH1gLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN1bHRhdGlvbiBjb25maXJtZWQgbm90aWZpY2F0aW9uIGVtYWlsXG4gICAqL1xuICBhc3luYyBzZW5kQ29uc3VsdGF0aW9uQ29uZmlybWVkRW1haWwoXG4gICAgdG86IHN0cmluZyxcbiAgICBwcm92aWRlck5hbWU6IHN0cmluZyxcbiAgICBjb25zdWx0YXRpb25UeXBlOiBzdHJpbmcsXG4gICAgc2NoZWR1bGVkQXQ6IHN0cmluZyxcbiAgICBjb25zdWx0YXRpb25JZDogc3RyaW5nXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGNvbnN0IGFwcFVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIjtcbiAgICBjb25zdCBjb25zdWx0YXRpb25VcmwgPSBgJHthcHBVcmx9L2NvbnN1bHRhdGlvbi8ke2NvbnN1bHRhdGlvbklkfWA7XG4gICAgY29uc3Qgc2NoZWR1bGVkRGF0ZSA9IG5ldyBEYXRlKHNjaGVkdWxlZEF0KS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHtcbiAgICAgIGRhdGVTdHlsZTogXCJsb25nXCIsXG4gICAgICB0aW1lU3R5bGU6IFwic2hvcnRcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBgXG4gICAgICA8aDIgc3R5bGU9XCJjb2xvcjogIzFmMjkzNzsgbWFyZ2luLXRvcDogMDtcIj5Db25zdWx0YXRpb24gQ29uZmlybWVkPC9oMj5cbiAgICAgIDxwPllvdXIgY29uc3VsdGF0aW9uIGhhcyBiZWVuIGNvbmZpcm1lZCBhbmQgaXMgc2NoZWR1bGVkLjwvcD5cbiAgICAgIFxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICMxMGI5ODE7XCI+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlByb3ZpZGVyOjwvc3Ryb25nPiAke3Byb3ZpZGVyTmFtZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlR5cGU6PC9zdHJvbmc+ICR7Y29uc3VsdGF0aW9uVHlwZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNjaGVkdWxlZDo8L3N0cm9uZz4gJHtzY2hlZHVsZWREYXRlfTwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8cD5Zb3Ugd2lsbCByZWNlaXZlIGEgcmVtaW5kZXIgMSBob3VyIGJlZm9yZSB5b3VyIGNvbnN1bHRhdGlvbi48L3A+XG4gICAgICBcbiAgICAgIDxkaXYgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbjogMzBweCAwO1wiPlxuICAgICAgICA8YSBocmVmPVwiJHtjb25zdWx0YXRpb25Vcmx9XCIgc3R5bGU9XCJiYWNrZ3JvdW5kOiAjMTBiOTgxOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMzBweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgZm9udC13ZWlnaHQ6IDYwMDtcIj5WaWV3IENvbnN1bHRhdGlvbjwvYT5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICByZXR1cm4gdGhpcy5zZW5kRW1haWwoe1xuICAgICAgdG8sXG4gICAgICBzdWJqZWN0OiBcIkNvbnN1bHRhdGlvbiBDb25maXJtZWQgLSBIZWFsdGhDb25uZWN0XCIsXG4gICAgICBodG1sOiB0aGlzLmdldEVtYWlsVGVtcGxhdGUoY29udGVudCwgXCJDb25zdWx0YXRpb24gQ29uZmlybWVkXCIpLFxuICAgICAgdGV4dDogYENvbnN1bHRhdGlvbiBDb25maXJtZWRcXG5cXG5Qcm92aWRlcjogJHtwcm92aWRlck5hbWV9XFxuVHlwZTogJHtjb25zdWx0YXRpb25UeXBlfVxcblNjaGVkdWxlZDogJHtzY2hlZHVsZWREYXRlfVxcblxcblZpZXc6ICR7Y29uc3VsdGF0aW9uVXJsfWAsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGF5bWVudCBzdWNjZXNzZnVsIG5vdGlmaWNhdGlvbiBlbWFpbFxuICAgKi9cbiAgYXN5bmMgc2VuZFBheW1lbnRDb25maXJtYXRpb25FbWFpbChcbiAgICB0bzogc3RyaW5nLFxuICAgIGFtb3VudDogbnVtYmVyLFxuICAgIGNvbnN1bHRhdGlvblR5cGU6IHN0cmluZyxcbiAgICBjb25zdWx0YXRpb25JZDogc3RyaW5nXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGNvbnN0IGFwcFVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIjtcbiAgICBjb25zdCBjb25zdWx0YXRpb25VcmwgPSBgJHthcHBVcmx9L2NvbnN1bHRhdGlvbi8ke2NvbnN1bHRhdGlvbklkfWA7XG4gICAgY29uc3QgZm9ybWF0dGVkQW1vdW50ID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KFwiZW4tVVNcIiwge1xuICAgICAgc3R5bGU6IFwiY3VycmVuY3lcIixcbiAgICAgIGN1cnJlbmN5OiBcIlNMTFwiLFxuICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAwLFxuICAgIH0pLmZvcm1hdChhbW91bnQpO1xuXG4gICAgY29uc3QgY29udGVudCA9IGBcbiAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjMWYyOTM3OyBtYXJnaW4tdG9wOiAwO1wiPlBheW1lbnQgQ29uZmlybWVkPC9oMj5cbiAgICAgIDxwPllvdXIgcGF5bWVudCBoYXMgYmVlbiBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5LjwvcD5cbiAgICAgIFxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICMxMGI5ODE7XCI+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPkFtb3VudDo8L3N0cm9uZz4gJHtmb3JtYXR0ZWRBbW91bnR9PC9wPlxuICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5Db25zdWx0YXRpb24gVHlwZTo8L3N0cm9uZz4gJHtjb25zdWx0YXRpb25UeXBlfTwvcD5cbiAgICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+U3RhdHVzOjwvc3Ryb25nPiBQYXltZW50IENvbmZpcm1lZDwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8cD5Zb3VyIGNvbnN1bHRhdGlvbiBpcyBub3cgY29uZmlybWVkLiBZb3Ugd2lsbCByZWNlaXZlIHNjaGVkdWxpbmcgZGV0YWlscyBzb29uLjwvcD5cbiAgICAgIFxuICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAzMHB4IDA7XCI+XG4gICAgICAgIDxhIGhyZWY9XCIke2NvbnN1bHRhdGlvblVybH1cIiBzdHlsZT1cImJhY2tncm91bmQ6ICMxMGI5ODE7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAzMHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXdlaWdodDogNjAwO1wiPlZpZXcgQ29uc3VsdGF0aW9uPC9hPlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIHJldHVybiB0aGlzLnNlbmRFbWFpbCh7XG4gICAgICB0byxcbiAgICAgIHN1YmplY3Q6IFwiUGF5bWVudCBDb25maXJtZWQgLSBIZWFsdGhDb25uZWN0XCIsXG4gICAgICBodG1sOiB0aGlzLmdldEVtYWlsVGVtcGxhdGUoY29udGVudCwgXCJQYXltZW50IENvbmZpcm1lZFwiKSxcbiAgICAgIHRleHQ6IGBQYXltZW50IENvbmZpcm1lZFxcblxcbkFtb3VudDogJHtmb3JtYXR0ZWRBbW91bnR9XFxuQ29uc3VsdGF0aW9uOiAke2NvbnN1bHRhdGlvblR5cGV9XFxuXFxuVmlldzogJHtjb25zdWx0YXRpb25Vcmx9YCxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdWx0YXRpb24gcmVtaW5kZXIgZW1haWxcbiAgICovXG4gIGFzeW5jIHNlbmRDb25zdWx0YXRpb25SZW1pbmRlckVtYWlsKFxuICAgIHRvOiBzdHJpbmcsXG4gICAgcHJvdmlkZXJOYW1lOiBzdHJpbmcsXG4gICAgY29uc3VsdGF0aW9uVHlwZTogc3RyaW5nLFxuICAgIHNjaGVkdWxlZEF0OiBzdHJpbmcsXG4gICAgY29uc3VsdGF0aW9uSWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPEVtYWlsUmVzcG9uc2U+IHtcbiAgICBjb25zdCBhcHBVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUFBfVVJMIHx8IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwXCI7XG4gICAgY29uc3QgY29uc3VsdGF0aW9uVXJsID0gYCR7YXBwVXJsfS9jb25zdWx0YXRpb24vJHtjb25zdWx0YXRpb25JZH1gO1xuICAgIGNvbnN0IHNjaGVkdWxlZERhdGUgPSBuZXcgRGF0ZShzY2hlZHVsZWRBdCkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgICBkYXRlU3R5bGU6IFwibG9uZ1wiLFxuICAgICAgdGltZVN0eWxlOiBcInNob3J0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjb250ZW50ID0gYFxuICAgICAgPGgyIHN0eWxlPVwiY29sb3I6ICMxZjI5Mzc7IG1hcmdpbi10b3A6IDA7XCI+Q29uc3VsdGF0aW9uIFJlbWluZGVyPC9oMj5cbiAgICAgIDxwPlRoaXMgaXMgYSByZW1pbmRlciB0aGF0IHlvdSBoYXZlIGEgY29uc3VsdGF0aW9uIHNjaGVkdWxlZCBzb29uLjwvcD5cbiAgICAgIFxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICNmNTllMGI7XCI+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlByb3ZpZGVyOjwvc3Ryb25nPiAke3Byb3ZpZGVyTmFtZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlR5cGU6PC9zdHJvbmc+ICR7Y29uc3VsdGF0aW9uVHlwZX08L3A+XG4gICAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNjaGVkdWxlZDo8L3N0cm9uZz4gJHtzY2hlZHVsZWREYXRlfTwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8cD5QbGVhc2Ugam9pbiB0aGUgY29uc3VsdGF0aW9uIG9uIHRpbWUuIElmIHlvdSBuZWVkIHRvIHJlc2NoZWR1bGUsIHBsZWFzZSBjb250YWN0IHVzIGFzIHNvb24gYXMgcG9zc2libGUuPC9wPlxuICAgICAgXG4gICAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW46IDMwcHggMDtcIj5cbiAgICAgICAgPGEgaHJlZj1cIiR7Y29uc3VsdGF0aW9uVXJsfVwiIHN0eWxlPVwiYmFja2dyb3VuZDogI2Y1OWUwYjsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxMnB4IDMwcHg7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyLXJhZGl1czogNnB4OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtd2VpZ2h0OiA2MDA7XCI+VmlldyBDb25zdWx0YXRpb248L2E+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgcmV0dXJuIHRoaXMuc2VuZEVtYWlsKHtcbiAgICAgIHRvLFxuICAgICAgc3ViamVjdDogXCJDb25zdWx0YXRpb24gUmVtaW5kZXIgLSBIZWFsdGhDb25uZWN0XCIsXG4gICAgICBodG1sOiB0aGlzLmdldEVtYWlsVGVtcGxhdGUoY29udGVudCwgXCJDb25zdWx0YXRpb24gUmVtaW5kZXJcIiksXG4gICAgICB0ZXh0OiBgQ29uc3VsdGF0aW9uIFJlbWluZGVyXFxuXFxuUHJvdmlkZXI6ICR7cHJvdmlkZXJOYW1lfVxcblR5cGU6ICR7Y29uc3VsdGF0aW9uVHlwZX1cXG5TY2hlZHVsZWQ6ICR7c2NoZWR1bGVkRGF0ZX1cXG5cXG5WaWV3OiAke2NvbnN1bHRhdGlvblVybH1gLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBlbWFpbFNlcnZpY2UgPSBuZXcgRW1haWxTZXJ2aWNlKCk7XG4iXSwibmFtZXMiOlsiRW1haWxTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJzZW5kR3JpZEFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJTRU5ER1JJRF9BUElfS0VZIiwic2VuZEdyaWRGcm9tRW1haWwiLCJTRU5ER1JJRF9GUk9NX0VNQUlMIiwic2VuZEdyaWRGcm9tTmFtZSIsIlNFTkRHUklEX0ZST01fTkFNRSIsInNlc1JlZ2lvbiIsIkFXU19TRVNfUkVHSU9OIiwic2VzQWNjZXNzS2V5SWQiLCJBV1NfU0VTX0FDQ0VTU19LRVlfSUQiLCJzZXNTZWNyZXRBY2Nlc3NLZXkiLCJBV1NfU0VTX1NFQ1JFVF9BQ0NFU1NfS0VZIiwic2VzRnJvbUVtYWlsIiwiQVdTX1NFU19GUk9NX0VNQUlMIiwiZGVmYXVsdEZyb21FbWFpbCIsIkVNQUlMX0ZST00iLCJkZWZhdWx0RnJvbU5hbWUiLCJFTUFJTF9GUk9NX05BTUUiLCJwcm92aWRlciIsImVuYWJsZWQiLCJzZW5kRW1haWwiLCJvcHRpb25zIiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJ0byIsInN1YmplY3QiLCJzdWNjZXNzIiwiZXJyb3IiLCJzZW5kVmlhU2VuZEdyaWQiLCJzZW5kVmlhU0VTIiwiRXJyb3IiLCJtZXNzYWdlIiwiZnJvbUVtYWlsIiwiZnJvbSIsImZyb21OYW1lIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwZXJzb25hbGl6YXRpb25zIiwiZW1haWwiLCJuYW1lIiwiY29udGVudCIsInR5cGUiLCJ2YWx1ZSIsImh0bWwiLCJ0ZXh0Iiwib2siLCJlcnJvclRleHQiLCJzdGF0dXMiLCJtZXNzYWdlSWQiLCJnZXQiLCJ1bmRlZmluZWQiLCJhd3NTREsiLCJyZXF1aXJlIiwicmVxdWlyZUZ1bmMiLCJlIiwiZXJyb3JNc2ciLCJjb2RlIiwiaW5jbHVkZXMiLCJTRVNDbGllbnQiLCJTZW5kRW1haWxDb21tYW5kIiwic2VzQ2xpZW50IiwicmVnaW9uIiwiY3JlZGVudGlhbHMiLCJhY2Nlc3NLZXlJZCIsInNlY3JldEFjY2Vzc0tleSIsImNvbW1hbmQiLCJTb3VyY2UiLCJEZXN0aW5hdGlvbiIsIlRvQWRkcmVzc2VzIiwiTWVzc2FnZSIsIlN1YmplY3QiLCJEYXRhIiwiQ2hhcnNldCIsIkJvZHkiLCJIdG1sIiwiVGV4dCIsInNlbmQiLCJNZXNzYWdlSWQiLCJnZXRFbWFpbFRlbXBsYXRlIiwidGl0bGUiLCJEYXRlIiwiZ2V0RnVsbFllYXIiLCJ0cmltIiwic2VuZFByb3ZpZGVyQm9va2luZ0VtYWlsIiwicGF0aWVudE5hbWUiLCJjb25zdWx0YXRpb25UeXBlIiwic2NoZWR1bGVkQXQiLCJjb25zdWx0YXRpb25JZCIsImFwcFVybCIsIk5FWFRfUFVCTElDX0FQUF9VUkwiLCJjb25zdWx0YXRpb25VcmwiLCJzY2hlZHVsZWRJbmZvIiwidG9Mb2NhbGVTdHJpbmciLCJkYXRlU3R5bGUiLCJ0aW1lU3R5bGUiLCJzZW5kQ29uc3VsdGF0aW9uQXNzaWduZWRFbWFpbCIsInByb3ZpZGVyTmFtZSIsInNjaGVkdWxlZERhdGUiLCJzZW5kQ29uc3VsdGF0aW9uQ29uZmlybWVkRW1haWwiLCJzZW5kUGF5bWVudENvbmZpcm1hdGlvbkVtYWlsIiwiYW1vdW50IiwiZm9ybWF0dGVkQW1vdW50IiwiSW50bCIsIk51bWJlckZvcm1hdCIsInN0eWxlIiwiY3VycmVuY3kiLCJtaW5pbXVtRnJhY3Rpb25EaWdpdHMiLCJmb3JtYXQiLCJzZW5kQ29uc3VsdGF0aW9uUmVtaW5kZXJFbWFpbCIsImVtYWlsU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/notifications/email.ts\n");

/***/ }),

/***/ "(rsc)/./lib/notifications/index.ts":
/*!************************************!*\
  !*** ./lib/notifications/index.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   notifyConsultationReminder: () => (/* binding */ notifyConsultationReminder),\n/* harmony export */   notifyPatientAcceptance: () => (/* binding */ notifyPatientAcceptance),\n/* harmony export */   notifyPatientAssignment: () => (/* binding */ notifyPatientAssignment),\n/* harmony export */   notifyPaymentConfirmation: () => (/* binding */ notifyPaymentConfirmation),\n/* harmony export */   notifyProviderBooking: () => (/* binding */ notifyProviderBooking)\n/* harmony export */ });\n/* harmony import */ var _sms__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sms */ \"(rsc)/./lib/notifications/sms.ts\");\n/* harmony import */ var _email__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./email */ \"(rsc)/./lib/notifications/email.ts\");\n/* harmony import */ var _lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase/admin */ \"(rsc)/./lib/supabase/admin.ts\");\n/* harmony import */ var _preferences__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./preferences */ \"(rsc)/./lib/notifications/preferences.ts\");\n/**\n * Notification Service\n * Centralized notification handling for the application\n */ \n\n\n\n/**\n * Send notification to provider when consultation is booked\n */ async function notifyProviderBooking(consultationId, providerId) {\n    try {\n        const adminClient = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__.getAdminClient)();\n        // Get provider details with notification preferences\n        const { data: provider } = await adminClient.from(\"healthcare_providers\").select(`\n        *,\n        users (\n          id,\n          full_name,\n          phone_number,\n          email,\n          notification_preferences\n        )\n      `).eq(\"id\", providerId).single();\n        if (!provider || !provider.users) {\n            console.error(\"Provider not found for notification\");\n            return;\n        }\n        // Get consultation details\n        const { data: consultation } = await adminClient.from(\"consultations\").select(`\n        *,\n        users (\n          id,\n          full_name,\n          phone_number\n        )\n      `).eq(\"id\", consultationId).single();\n        if (!consultation || !consultation.users) {\n            console.error(\"Consultation not found for notification\");\n            return;\n        }\n        const patientName = consultation.users.full_name || \"Patient\";\n        const consultationType = consultation.consultation_type === \"video\" ? \"Video Call\" : consultation.consultation_type === \"voice\" ? \"Voice Call\" : \"SMS Consultation\";\n        // Send SMS notification (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(provider.users.notification_preferences) && provider.users.phone_number && consultation.scheduled_at) {\n            const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendProviderBookingNotification(provider.users.phone_number, patientName, consultationType, consultation.scheduled_at);\n            if (!smsResult.success) {\n                console.error(\"SMS notification failed for provider booking:\", {\n                    consultationId,\n                    providerId,\n                    phoneNumber: provider.users.phone_number,\n                    error: smsResult.error,\n                    messageId: smsResult.messageId\n                });\n            } else {\n                console.log(\"SMS notification sent successfully:\", {\n                    consultationId,\n                    providerId,\n                    messageId: smsResult.messageId\n                });\n            }\n        } else if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(provider.users.notification_preferences) && provider.users.phone_number) {\n            // If no scheduled_at, send a notification without date\n            const message = `New Consultation Request\\n\\nPatient: ${patientName}\\nType: ${consultationType}\\n\\nPlease log in to view details.`;\n            const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendSMS({\n                to: provider.users.phone_number,\n                message\n            });\n            if (!smsResult.success) {\n                console.error(\"SMS notification failed (no scheduled_at):\", {\n                    consultationId,\n                    providerId,\n                    phoneNumber: provider.users.phone_number,\n                    error: smsResult.error\n                });\n            } else {\n                console.log(\"SMS notification sent successfully (no scheduled_at):\", {\n                    consultationId,\n                    messageId: smsResult.messageId\n                });\n            }\n        } else {\n            // Log why SMS was not sent\n            console.log(\"SMS not sent for provider booking:\", {\n                consultationId,\n                providerId,\n                reason: !(0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(provider.users.notification_preferences) ? \"User preference does not allow SMS\" : !provider.users.phone_number ? \"Provider has no phone number\" : \"Unknown reason\",\n                preference: provider.users.notification_preferences,\n                hasPhoneNumber: !!provider.users.phone_number\n            });\n        }\n        // Send email notification (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendEmail)(provider.users.notification_preferences) && provider.users.email) {\n            try {\n                await _email__WEBPACK_IMPORTED_MODULE_1__.emailService.sendProviderBookingEmail(provider.users.email, patientName, consultationType, consultation.scheduled_at, consultationId);\n            } catch (emailError) {\n                console.error(\"Error sending email notification:\", emailError);\n            // Don't throw - email failures are non-critical\n            }\n        }\n    // TODO: Add push notification here if needed\n    } catch (error) {\n        console.error(\"Error sending provider booking notification:\", error);\n    // Don't throw - notifications are non-critical\n    }\n}\n/**\n * Send confirmation to patient when provider accepts consultation\n */ async function notifyPatientAcceptance(consultationId, patientId) {\n    try {\n        const adminClient = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__.getAdminClient)();\n        // Get patient details\n        const { data: patient } = await adminClient.from(\"users\").select(\"id, full_name, phone_number, email\").eq(\"id\", patientId).single();\n        if (!patient) {\n            console.error(\"Patient not found for notification\");\n            return;\n        }\n        // Get consultation details\n        const { data: consultation } = await adminClient.from(\"consultations\").select(`\n        *,\n        healthcare_providers (\n          id,\n          full_name\n        )\n      `).eq(\"id\", consultationId).single();\n        if (!consultation || !consultation.healthcare_providers) {\n            console.error(\"Consultation not found for notification\");\n            return;\n        }\n        const providerName = consultation.healthcare_providers.full_name || \"Healthcare Provider\";\n        const consultationType = consultation.consultation_type === \"video\" ? \"Video Call\" : consultation.consultation_type === \"voice\" ? \"Voice Call\" : \"SMS Consultation\";\n        // Send SMS confirmation (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) && patient.phone_number && consultation.scheduled_at) {\n            const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendPatientConfirmation(patient.phone_number, providerName, consultationType, consultation.scheduled_at);\n            if (!smsResult.success) {\n                console.error(\"SMS notification failed for patient confirmation:\", {\n                    consultationId,\n                    patientId,\n                    phoneNumber: patient.phone_number,\n                    error: smsResult.error\n                });\n            } else {\n                console.log(\"SMS notification sent successfully (patient confirmation):\", {\n                    consultationId,\n                    messageId: smsResult.messageId\n                });\n            }\n        } else if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) && patient.phone_number) {\n            // If no scheduled_at, send a simplified confirmation\n            const message = `Consultation Confirmed\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\n\\nYour consultation has been confirmed. You will receive scheduling details soon.`;\n            const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendSMS({\n                to: patient.phone_number,\n                message\n            });\n            if (!smsResult.success) {\n                console.error(\"SMS notification failed (confirmation, no scheduled_at):\", {\n                    consultationId,\n                    patientId,\n                    phoneNumber: patient.phone_number,\n                    error: smsResult.error\n                });\n            } else {\n                console.log(\"SMS notification sent successfully (confirmation, no scheduled_at):\", {\n                    consultationId,\n                    messageId: smsResult.messageId\n                });\n            }\n        } else {\n            console.log(\"SMS not sent for patient confirmation:\", {\n                consultationId,\n                patientId,\n                reason: !(0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) ? \"User preference does not allow SMS\" : !patient.phone_number ? \"Patient has no phone number\" : \"No scheduled_at and preference check failed\",\n                preference: patient.notification_preferences,\n                hasPhoneNumber: !!patient.phone_number\n            });\n        }\n        // Send email notification (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendEmail)(patient.notification_preferences) && patient.email && consultation.scheduled_at) {\n            try {\n                await _email__WEBPACK_IMPORTED_MODULE_1__.emailService.sendConsultationConfirmedEmail(patient.email, providerName, consultationType, consultation.scheduled_at, consultationId);\n            } catch (emailError) {\n                console.error(\"Error sending email notification:\", emailError);\n            // Don't throw - email failures are non-critical\n            }\n        }\n    // TODO: Add push notification here if needed\n    } catch (error) {\n        console.error(\"Error sending patient acceptance notification:\", error);\n    // Don't throw - notifications are non-critical\n    }\n}\n/**\n * Send notification to patient when provider is assigned\n */ async function notifyPatientAssignment(consultationId, patientId) {\n    try {\n        const adminClient = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__.getAdminClient)();\n        // Get patient details with notification preferences\n        const { data: patient } = await adminClient.from(\"users\").select(\"id, full_name, phone_number, email, notification_preferences\").eq(\"id\", patientId).single();\n        if (!patient) {\n            console.error(\"Patient not found for assignment notification\");\n            return;\n        }\n        // Get consultation details\n        const { data: consultation } = await adminClient.from(\"consultations\").select(`\n        *,\n        healthcare_providers (\n          id,\n          full_name,\n          specialty\n        )\n      `).eq(\"id\", consultationId).single();\n        if (!consultation || !consultation.healthcare_providers) {\n            console.error(\"Consultation not found for assignment notification\");\n            return;\n        }\n        const providerName = consultation.healthcare_providers.full_name || \"Healthcare Provider\";\n        const consultationType = consultation.consultation_type === \"video\" ? \"Video Call\" : consultation.consultation_type === \"voice\" ? \"Voice Call\" : \"SMS Consultation\";\n        // Format scheduled date\n        let scheduledDate = \"TBD\";\n        if (consultation.scheduled_at) {\n            scheduledDate = new Date(consultation.scheduled_at).toLocaleDateString(\"en-US\", {\n                dateStyle: \"medium\",\n                timeStyle: \"short\"\n            });\n        } else if (consultation.preferred_date) {\n            scheduledDate = new Date(consultation.preferred_date).toLocaleDateString(\"en-US\", {\n                dateStyle: \"medium\"\n            });\n        }\n        // Send SMS notification (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) && patient.phone_number) {\n            const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendPatientAssignmentNotification(patient.phone_number, providerName, consultationType, scheduledDate);\n            if (!smsResult.success) {\n                console.error(\"SMS notification failed for patient assignment:\", {\n                    consultationId,\n                    patientId,\n                    phoneNumber: patient.phone_number,\n                    error: smsResult.error\n                });\n            } else {\n                console.log(\"SMS notification sent successfully (patient assignment):\", {\n                    consultationId,\n                    messageId: smsResult.messageId\n                });\n            }\n        } else {\n            console.log(\"SMS not sent for patient assignment:\", {\n                consultationId,\n                patientId,\n                reason: !(0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) ? \"User preference does not allow SMS\" : !patient.phone_number ? \"Patient has no phone number\" : \"Unknown reason\",\n                preference: patient.notification_preferences,\n                hasPhoneNumber: !!patient.phone_number\n            });\n        }\n        // Send email notification (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendEmail)(patient.notification_preferences) && patient.email) {\n            try {\n                await _email__WEBPACK_IMPORTED_MODULE_1__.emailService.sendConsultationAssignedEmail(patient.email, providerName, consultationType, scheduledDate, consultationId);\n            } catch (emailError) {\n                console.error(\"Error sending email notification:\", emailError);\n            // Don't throw - email failures are non-critical\n            }\n        }\n    // TODO: Add push notification here if needed\n    } catch (error) {\n        console.error(\"Error sending patient assignment notification:\", error);\n    // Don't throw - notifications are non-critical\n    }\n}\n/**\n * Send payment confirmation notification\n */ async function notifyPaymentConfirmation(consultationId, patientId, amount) {\n    try {\n        const adminClient = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__.getAdminClient)();\n        // Get patient details with notification preferences\n        const { data: patient } = await adminClient.from(\"users\").select(\"id, full_name, phone_number, email, notification_preferences\").eq(\"id\", patientId).single();\n        if (!patient) {\n            console.error(\"Patient not found for payment notification\");\n            return;\n        }\n        // Get consultation details\n        const { data: consultation } = await adminClient.from(\"consultations\").select(\"consultation_type\").eq(\"id\", consultationId).single();\n        if (!consultation) {\n            console.error(\"Consultation not found for payment notification\");\n            return;\n        }\n        const consultationType = consultation.consultation_type === \"video\" ? \"Video Call\" : consultation.consultation_type === \"voice\" ? \"Voice Call\" : \"SMS Consultation\";\n        // Send SMS confirmation (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) && patient.phone_number) {\n            const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendPaymentConfirmation(patient.phone_number, amount, consultationType);\n            if (!smsResult.success) {\n                console.error(\"SMS notification failed for payment confirmation:\", {\n                    consultationId,\n                    patientId,\n                    amount,\n                    phoneNumber: patient.phone_number,\n                    error: smsResult.error\n                });\n            } else {\n                console.log(\"SMS notification sent successfully (payment confirmation):\", {\n                    consultationId,\n                    amount,\n                    messageId: smsResult.messageId\n                });\n            }\n        } else {\n            console.log(\"SMS not sent for payment confirmation:\", {\n                consultationId,\n                patientId,\n                reason: !(0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(patient.notification_preferences) ? \"User preference does not allow SMS\" : !patient.phone_number ? \"Patient has no phone number\" : \"Unknown reason\",\n                preference: patient.notification_preferences,\n                hasPhoneNumber: !!patient.phone_number\n            });\n        }\n        // Send email notification (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendEmail)(patient.notification_preferences) && patient.email) {\n            try {\n                await _email__WEBPACK_IMPORTED_MODULE_1__.emailService.sendPaymentConfirmationEmail(patient.email, amount, consultationType, consultationId);\n            } catch (emailError) {\n                console.error(\"Error sending email notification:\", emailError);\n            // Don't throw - email failures are non-critical\n            }\n        }\n    } catch (error) {\n        console.error(\"Error sending payment confirmation notification:\", error);\n    // Don't throw - notifications are non-critical\n    }\n}\n/**\n * Send consultation reminder notification\n */ async function notifyConsultationReminder(consultationId, userId, recipientType) {\n    try {\n        const adminClient = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_2__.getAdminClient)();\n        // Get user details with notification preferences\n        const { data: user } = await adminClient.from(\"users\").select(\"id, full_name, phone_number, email, notification_preferences\").eq(\"id\", userId).single();\n        if (!user) {\n            console.error(\"User not found for reminder notification\");\n            return;\n        }\n        // Get consultation details\n        const { data: consultation } = await adminClient.from(\"consultations\").select(`\n        *,\n        healthcare_providers (\n          id,\n          full_name\n        ),\n        users (\n          id,\n          full_name\n        )\n      `).eq(\"id\", consultationId).single();\n        if (!consultation || !consultation.scheduled_at) {\n            console.error(\"Consultation not found or not scheduled for reminder\");\n            return;\n        }\n        const providerName = consultation.healthcare_providers?.full_name || \"Healthcare Provider\";\n        const patientName = consultation.users?.full_name || \"Patient\";\n        const consultationType = consultation.consultation_type === \"video\" ? \"Video Call\" : consultation.consultation_type === \"voice\" ? \"Voice Call\" : \"SMS Consultation\";\n        // Send email reminder (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendEmail)(user.notification_preferences) && user.email) {\n            try {\n                await _email__WEBPACK_IMPORTED_MODULE_1__.emailService.sendConsultationReminderEmail(user.email, recipientType === \"patient\" ? providerName : patientName, consultationType, consultation.scheduled_at, consultationId);\n            } catch (emailError) {\n                console.error(\"Error sending email reminder:\", emailError);\n            // Don't throw - email failures are non-critical\n            }\n        }\n        // Send SMS reminder (respect user preferences)\n        if ((0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(user.notification_preferences) && user.phone_number) {\n            try {\n                const scheduledDate = new Date(consultation.scheduled_at).toLocaleString(\"en-US\", {\n                    dateStyle: \"medium\",\n                    timeStyle: \"short\"\n                });\n                const message = `Consultation Reminder\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nPlease join on time.`;\n                const smsResult = await _sms__WEBPACK_IMPORTED_MODULE_0__.smsService.sendSMS({\n                    to: user.phone_number,\n                    message\n                });\n                if (!smsResult.success) {\n                    console.error(\"SMS reminder failed:\", {\n                        consultationId,\n                        userId,\n                        recipientType,\n                        phoneNumber: user.phone_number,\n                        error: smsResult.error\n                    });\n                } else {\n                    console.log(\"SMS reminder sent successfully:\", {\n                        consultationId,\n                        messageId: smsResult.messageId\n                    });\n                }\n            } catch (smsError) {\n                console.error(\"Error sending SMS reminder:\", smsError);\n            // Don't throw - SMS failures are non-critical\n            }\n        } else {\n            console.log(\"SMS reminder not sent:\", {\n                consultationId,\n                userId,\n                reason: !(0,_preferences__WEBPACK_IMPORTED_MODULE_3__.shouldSendSMS)(user.notification_preferences) ? \"User preference does not allow SMS\" : !user.phone_number ? \"User has no phone number\" : \"Unknown reason\",\n                preference: user.notification_preferences,\n                hasPhoneNumber: !!user.phone_number\n            });\n        }\n    } catch (error) {\n        console.error(\"Error sending consultation reminder:\", error);\n    // Don't throw - notifications are non-critical\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFhLFFBQVEsRUFBRXhCLGlCQUFpQixhQUFhLEVBQUU0QixjQUFjLHdCQUF3QixDQUFDO2dCQUNwSixNQUFNdkIsWUFBWSxNQUFNMUIsNENBQVVBLENBQUNpQyxPQUFPLENBQUM7b0JBQ3pDQyxJQUFJOEIsS0FBS3hDLFlBQVk7b0JBQ3JCUTtnQkFDRjtnQkFFQSxJQUFJLENBQUNOLFVBQVVFLE9BQU8sRUFBRTtvQkFDdEJaLFFBQVFDLEtBQUssQ0FBQyx3QkFBd0I7d0JBQ3BDWDt3QkFDQXdEO3dCQUNBQzt3QkFDQWxDLGFBQWFtQyxLQUFLeEMsWUFBWTt3QkFDOUJQLE9BQU9TLFVBQVVULEtBQUs7b0JBQ3hCO2dCQUNGLE9BQU87b0JBQ0xELFFBQVFlLEdBQUcsQ0FBQyxtQ0FBbUM7d0JBQzdDekI7d0JBQ0F3QixXQUFXSixVQUFVSSxTQUFTO29CQUNoQztnQkFDRjtZQUNGLEVBQUUsT0FBT3FDLFVBQVU7Z0JBQ2pCbkQsUUFBUUMsS0FBSyxDQUFDLCtCQUErQmtEO1lBQzdDLDhDQUE4QztZQUNoRDtRQUNGLE9BQU87WUFDTG5ELFFBQVFlLEdBQUcsQ0FBQywwQkFBMEI7Z0JBQ3BDekI7Z0JBQ0F3RDtnQkFDQTNCLFFBQVEsQ0FBQ2hDLDJEQUFhQSxDQUFDNkQsS0FBS3pDLHdCQUF3QixJQUNoRCx1Q0FDQSxDQUFDeUMsS0FBS3hDLFlBQVksR0FDbEIsNkJBQ0E7Z0JBQ0pZLFlBQVk0QixLQUFLekMsd0JBQXdCO2dCQUN6Q2MsZ0JBQWdCLENBQUMsQ0FBQzJCLEtBQUt4QyxZQUFZO1lBQ3JDO1FBQ0Y7SUFDRixFQUFFLE9BQU9QLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHdDQUF3Q0E7SUFDdEQsK0NBQStDO0lBQ2pEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ydXJhbC1oZWFsdGgtcGxhdGZvcm0vLi9saWIvbm90aWZpY2F0aW9ucy9pbmRleC50cz83MTNlIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTm90aWZpY2F0aW9uIFNlcnZpY2VcbiAqIENlbnRyYWxpemVkIG5vdGlmaWNhdGlvbiBoYW5kbGluZyBmb3IgdGhlIGFwcGxpY2F0aW9uXG4gKi9cblxuaW1wb3J0IHsgc21zU2VydmljZSB9IGZyb20gXCIuL3Ntc1wiO1xuaW1wb3J0IHsgZW1haWxTZXJ2aWNlIH0gZnJvbSBcIi4vZW1haWxcIjtcbmltcG9ydCB7IGdldEFkbWluQ2xpZW50IH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlL2FkbWluXCI7XG5pbXBvcnQgeyBzaG91bGRTZW5kU01TLCBzaG91bGRTZW5kRW1haWwgfSBmcm9tIFwiLi9wcmVmZXJlbmNlc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5vdGlmaWNhdGlvbkRhdGEge1xuICBjb25zdWx0YXRpb25JZDogc3RyaW5nO1xuICB0eXBlOiBcImJvb2tpbmdcIiB8IFwiYWNjZXB0YW5jZVwiIHwgXCJwYXltZW50XCIgfCBcInJlbWluZGVyXCI7XG4gIHJlY2lwaWVudFR5cGU6IFwicGF0aWVudFwiIHwgXCJwcm92aWRlclwiO1xuICByZWNpcGllbnRJZDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFNlbmQgbm90aWZpY2F0aW9uIHRvIHByb3ZpZGVyIHdoZW4gY29uc3VsdGF0aW9uIGlzIGJvb2tlZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm90aWZ5UHJvdmlkZXJCb29raW5nKFxuICBjb25zdWx0YXRpb25JZDogc3RyaW5nLFxuICBwcm92aWRlcklkOiBzdHJpbmdcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGFkbWluQ2xpZW50ID0gZ2V0QWRtaW5DbGllbnQoKTtcblxuICAgIC8vIEdldCBwcm92aWRlciBkZXRhaWxzIHdpdGggbm90aWZpY2F0aW9uIHByZWZlcmVuY2VzXG4gICAgY29uc3QgeyBkYXRhOiBwcm92aWRlciB9ID0gYXdhaXQgYWRtaW5DbGllbnRcbiAgICAgIC5mcm9tKFwiaGVhbHRoY2FyZV9wcm92aWRlcnNcIilcbiAgICAgIC5zZWxlY3QoXG4gICAgICAgIGBcbiAgICAgICAgKixcbiAgICAgICAgdXNlcnMgKFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIGZ1bGxfbmFtZSxcbiAgICAgICAgICBwaG9uZV9udW1iZXIsXG4gICAgICAgICAgZW1haWwsXG4gICAgICAgICAgbm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzXG4gICAgICAgIClcbiAgICAgIGBcbiAgICAgIClcbiAgICAgIC5lcShcImlkXCIsIHByb3ZpZGVySWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIXByb3ZpZGVyIHx8ICFwcm92aWRlci51c2Vycykge1xuICAgICAgY29uc29sZS5lcnJvcihcIlByb3ZpZGVyIG5vdCBmb3VuZCBmb3Igbm90aWZpY2F0aW9uXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEdldCBjb25zdWx0YXRpb24gZGV0YWlsc1xuICAgIGNvbnN0IHsgZGF0YTogY29uc3VsdGF0aW9uIH0gPSBhd2FpdCBhZG1pbkNsaWVudFxuICAgICAgLmZyb20oXCJjb25zdWx0YXRpb25zXCIpXG4gICAgICAuc2VsZWN0KFxuICAgICAgICBgXG4gICAgICAgICosXG4gICAgICAgIHVzZXJzIChcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBmdWxsX25hbWUsXG4gICAgICAgICAgcGhvbmVfbnVtYmVyXG4gICAgICAgIClcbiAgICAgIGBcbiAgICAgIClcbiAgICAgIC5lcShcImlkXCIsIGNvbnN1bHRhdGlvbklkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKCFjb25zdWx0YXRpb24gfHwgIWNvbnN1bHRhdGlvbi51c2Vycykge1xuICAgICAgY29uc29sZS5lcnJvcihcIkNvbnN1bHRhdGlvbiBub3QgZm91bmQgZm9yIG5vdGlmaWNhdGlvblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwYXRpZW50TmFtZSA9IGNvbnN1bHRhdGlvbi51c2Vycy5mdWxsX25hbWUgfHwgXCJQYXRpZW50XCI7XG4gICAgY29uc3QgY29uc3VsdGF0aW9uVHlwZSA9XG4gICAgICBjb25zdWx0YXRpb24uY29uc3VsdGF0aW9uX3R5cGUgPT09IFwidmlkZW9cIlxuICAgICAgICA/IFwiVmlkZW8gQ2FsbFwiXG4gICAgICAgIDogY29uc3VsdGF0aW9uLmNvbnN1bHRhdGlvbl90eXBlID09PSBcInZvaWNlXCJcbiAgICAgICAgPyBcIlZvaWNlIENhbGxcIlxuICAgICAgICA6IFwiU01TIENvbnN1bHRhdGlvblwiO1xuXG4gICAgLy8gU2VuZCBTTVMgbm90aWZpY2F0aW9uIChyZXNwZWN0IHVzZXIgcHJlZmVyZW5jZXMpXG4gICAgaWYgKFxuICAgICAgc2hvdWxkU2VuZFNNUyhwcm92aWRlci51c2Vycy5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMpICYmXG4gICAgICBwcm92aWRlci51c2Vycy5waG9uZV9udW1iZXIgJiZcbiAgICAgIGNvbnN1bHRhdGlvbi5zY2hlZHVsZWRfYXRcbiAgICApIHtcbiAgICAgIGNvbnN0IHNtc1Jlc3VsdCA9IGF3YWl0IHNtc1NlcnZpY2Uuc2VuZFByb3ZpZGVyQm9va2luZ05vdGlmaWNhdGlvbihcbiAgICAgICAgcHJvdmlkZXIudXNlcnMucGhvbmVfbnVtYmVyLFxuICAgICAgICBwYXRpZW50TmFtZSxcbiAgICAgICAgY29uc3VsdGF0aW9uVHlwZSxcbiAgICAgICAgY29uc3VsdGF0aW9uLnNjaGVkdWxlZF9hdFxuICAgICAgKTtcbiAgICAgIFxuICAgICAgaWYgKCFzbXNSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiU01TIG5vdGlmaWNhdGlvbiBmYWlsZWQgZm9yIHByb3ZpZGVyIGJvb2tpbmc6XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBwcm92aWRlcklkLFxuICAgICAgICAgIHBob25lTnVtYmVyOiBwcm92aWRlci51c2Vycy5waG9uZV9udW1iZXIsXG4gICAgICAgICAgZXJyb3I6IHNtc1Jlc3VsdC5lcnJvcixcbiAgICAgICAgICBtZXNzYWdlSWQ6IHNtc1Jlc3VsdC5tZXNzYWdlSWQsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90aWZpY2F0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5OlwiLCB7XG4gICAgICAgICAgY29uc3VsdGF0aW9uSWQsXG4gICAgICAgICAgcHJvdmlkZXJJZCxcbiAgICAgICAgICBtZXNzYWdlSWQ6IHNtc1Jlc3VsdC5tZXNzYWdlSWQsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICBzaG91bGRTZW5kU01TKHByb3ZpZGVyLnVzZXJzLm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcykgJiZcbiAgICAgIHByb3ZpZGVyLnVzZXJzLnBob25lX251bWJlclxuICAgICkge1xuICAgICAgLy8gSWYgbm8gc2NoZWR1bGVkX2F0LCBzZW5kIGEgbm90aWZpY2F0aW9uIHdpdGhvdXQgZGF0ZVxuICAgICAgY29uc3QgbWVzc2FnZSA9IGBOZXcgQ29uc3VsdGF0aW9uIFJlcXVlc3RcXG5cXG5QYXRpZW50OiAke3BhdGllbnROYW1lfVxcblR5cGU6ICR7Y29uc3VsdGF0aW9uVHlwZX1cXG5cXG5QbGVhc2UgbG9nIGluIHRvIHZpZXcgZGV0YWlscy5gO1xuICAgICAgY29uc3Qgc21zUmVzdWx0ID0gYXdhaXQgc21zU2VydmljZS5zZW5kU01TKHtcbiAgICAgICAgdG86IHByb3ZpZGVyLnVzZXJzLnBob25lX251bWJlcixcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBpZiAoIXNtc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTTVMgbm90aWZpY2F0aW9uIGZhaWxlZCAobm8gc2NoZWR1bGVkX2F0KTpcIiwge1xuICAgICAgICAgIGNvbnN1bHRhdGlvbklkLFxuICAgICAgICAgIHByb3ZpZGVySWQsXG4gICAgICAgICAgcGhvbmVOdW1iZXI6IHByb3ZpZGVyLnVzZXJzLnBob25lX251bWJlcixcbiAgICAgICAgICBlcnJvcjogc21zUmVzdWx0LmVycm9yLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiU01TIG5vdGlmaWNhdGlvbiBzZW50IHN1Y2Nlc3NmdWxseSAobm8gc2NoZWR1bGVkX2F0KTpcIiwge1xuICAgICAgICAgIGNvbnN1bHRhdGlvbklkLFxuICAgICAgICAgIG1lc3NhZ2VJZDogc21zUmVzdWx0Lm1lc3NhZ2VJZCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIExvZyB3aHkgU01TIHdhcyBub3Qgc2VudFxuICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90IHNlbnQgZm9yIHByb3ZpZGVyIGJvb2tpbmc6XCIsIHtcbiAgICAgICAgY29uc3VsdGF0aW9uSWQsXG4gICAgICAgIHByb3ZpZGVySWQsXG4gICAgICAgIHJlYXNvbjogIXNob3VsZFNlbmRTTVMocHJvdmlkZXIudXNlcnMubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzKVxuICAgICAgICAgID8gXCJVc2VyIHByZWZlcmVuY2UgZG9lcyBub3QgYWxsb3cgU01TXCJcbiAgICAgICAgICA6ICFwcm92aWRlci51c2Vycy5waG9uZV9udW1iZXJcbiAgICAgICAgICA/IFwiUHJvdmlkZXIgaGFzIG5vIHBob25lIG51bWJlclwiXG4gICAgICAgICAgOiBcIlVua25vd24gcmVhc29uXCIsXG4gICAgICAgIHByZWZlcmVuY2U6IHByb3ZpZGVyLnVzZXJzLm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcyxcbiAgICAgICAgaGFzUGhvbmVOdW1iZXI6ICEhcHJvdmlkZXIudXNlcnMucGhvbmVfbnVtYmVyLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU2VuZCBlbWFpbCBub3RpZmljYXRpb24gKHJlc3BlY3QgdXNlciBwcmVmZXJlbmNlcylcbiAgICBpZiAoXG4gICAgICBzaG91bGRTZW5kRW1haWwocHJvdmlkZXIudXNlcnMubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzKSAmJlxuICAgICAgcHJvdmlkZXIudXNlcnMuZW1haWxcbiAgICApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGVtYWlsU2VydmljZS5zZW5kUHJvdmlkZXJCb29raW5nRW1haWwoXG4gICAgICAgICAgcHJvdmlkZXIudXNlcnMuZW1haWwsXG4gICAgICAgICAgcGF0aWVudE5hbWUsXG4gICAgICAgICAgY29uc3VsdGF0aW9uVHlwZSxcbiAgICAgICAgICBjb25zdWx0YXRpb24uc2NoZWR1bGVkX2F0LFxuICAgICAgICAgIGNvbnN1bHRhdGlvbklkXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlbWFpbEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIGVtYWlsIG5vdGlmaWNhdGlvbjpcIiwgZW1haWxFcnJvcik7XG4gICAgICAgIC8vIERvbid0IHRocm93IC0gZW1haWwgZmFpbHVyZXMgYXJlIG5vbi1jcml0aWNhbFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRPRE86IEFkZCBwdXNoIG5vdGlmaWNhdGlvbiBoZXJlIGlmIG5lZWRlZFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIHByb3ZpZGVyIGJvb2tpbmcgbm90aWZpY2F0aW9uOlwiLCBlcnJvcik7XG4gICAgLy8gRG9uJ3QgdGhyb3cgLSBub3RpZmljYXRpb25zIGFyZSBub24tY3JpdGljYWxcbiAgfVxufVxuXG4vKipcbiAqIFNlbmQgY29uZmlybWF0aW9uIHRvIHBhdGllbnQgd2hlbiBwcm92aWRlciBhY2NlcHRzIGNvbnN1bHRhdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm90aWZ5UGF0aWVudEFjY2VwdGFuY2UoXG4gIGNvbnN1bHRhdGlvbklkOiBzdHJpbmcsXG4gIHBhdGllbnRJZDogc3RyaW5nXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhZG1pbkNsaWVudCA9IGdldEFkbWluQ2xpZW50KCk7XG5cbiAgICAvLyBHZXQgcGF0aWVudCBkZXRhaWxzXG4gICAgY29uc3QgeyBkYXRhOiBwYXRpZW50IH0gPSBhd2FpdCBhZG1pbkNsaWVudFxuICAgICAgLmZyb20oXCJ1c2Vyc1wiKVxuICAgICAgLnNlbGVjdChcImlkLCBmdWxsX25hbWUsIHBob25lX251bWJlciwgZW1haWxcIilcbiAgICAgIC5lcShcImlkXCIsIHBhdGllbnRJZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghcGF0aWVudCkge1xuICAgICAgY29uc29sZS5lcnJvcihcIlBhdGllbnQgbm90IGZvdW5kIGZvciBub3RpZmljYXRpb25cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IGNvbnN1bHRhdGlvbiBkZXRhaWxzXG4gICAgY29uc3QgeyBkYXRhOiBjb25zdWx0YXRpb24gfSA9IGF3YWl0IGFkbWluQ2xpZW50XG4gICAgICAuZnJvbShcImNvbnN1bHRhdGlvbnNcIilcbiAgICAgIC5zZWxlY3QoXG4gICAgICAgIGBcbiAgICAgICAgKixcbiAgICAgICAgaGVhbHRoY2FyZV9wcm92aWRlcnMgKFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIGZ1bGxfbmFtZVxuICAgICAgICApXG4gICAgICBgXG4gICAgICApXG4gICAgICAuZXEoXCJpZFwiLCBjb25zdWx0YXRpb25JZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghY29uc3VsdGF0aW9uIHx8ICFjb25zdWx0YXRpb24uaGVhbHRoY2FyZV9wcm92aWRlcnMpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb25zdWx0YXRpb24gbm90IGZvdW5kIGZvciBub3RpZmljYXRpb25cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcHJvdmlkZXJOYW1lID1cbiAgICAgIGNvbnN1bHRhdGlvbi5oZWFsdGhjYXJlX3Byb3ZpZGVycy5mdWxsX25hbWUgfHwgXCJIZWFsdGhjYXJlIFByb3ZpZGVyXCI7XG4gICAgY29uc3QgY29uc3VsdGF0aW9uVHlwZSA9XG4gICAgICBjb25zdWx0YXRpb24uY29uc3VsdGF0aW9uX3R5cGUgPT09IFwidmlkZW9cIlxuICAgICAgICA/IFwiVmlkZW8gQ2FsbFwiXG4gICAgICAgIDogY29uc3VsdGF0aW9uLmNvbnN1bHRhdGlvbl90eXBlID09PSBcInZvaWNlXCJcbiAgICAgICAgPyBcIlZvaWNlIENhbGxcIlxuICAgICAgICA6IFwiU01TIENvbnN1bHRhdGlvblwiO1xuXG4gICAgLy8gU2VuZCBTTVMgY29uZmlybWF0aW9uIChyZXNwZWN0IHVzZXIgcHJlZmVyZW5jZXMpXG4gICAgaWYgKFxuICAgICAgc2hvdWxkU2VuZFNNUyhwYXRpZW50Lm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcykgJiZcbiAgICAgIHBhdGllbnQucGhvbmVfbnVtYmVyICYmXG4gICAgICBjb25zdWx0YXRpb24uc2NoZWR1bGVkX2F0XG4gICAgKSB7XG4gICAgICBjb25zdCBzbXNSZXN1bHQgPSBhd2FpdCBzbXNTZXJ2aWNlLnNlbmRQYXRpZW50Q29uZmlybWF0aW9uKFxuICAgICAgICBwYXRpZW50LnBob25lX251bWJlcixcbiAgICAgICAgcHJvdmlkZXJOYW1lLFxuICAgICAgICBjb25zdWx0YXRpb25UeXBlLFxuICAgICAgICBjb25zdWx0YXRpb24uc2NoZWR1bGVkX2F0XG4gICAgICApO1xuICAgICAgXG4gICAgICBpZiAoIXNtc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTTVMgbm90aWZpY2F0aW9uIGZhaWxlZCBmb3IgcGF0aWVudCBjb25maXJtYXRpb246XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBwYXRpZW50SWQsXG4gICAgICAgICAgcGhvbmVOdW1iZXI6IHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICAgIGVycm9yOiBzbXNSZXN1bHQuZXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90aWZpY2F0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5IChwYXRpZW50IGNvbmZpcm1hdGlvbik6XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBtZXNzYWdlSWQ6IHNtc1Jlc3VsdC5tZXNzYWdlSWQsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICBzaG91bGRTZW5kU01TKHBhdGllbnQubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzKSAmJlxuICAgICAgcGF0aWVudC5waG9uZV9udW1iZXJcbiAgICApIHtcbiAgICAgIC8vIElmIG5vIHNjaGVkdWxlZF9hdCwgc2VuZCBhIHNpbXBsaWZpZWQgY29uZmlybWF0aW9uXG4gICAgICBjb25zdCBtZXNzYWdlID0gYENvbnN1bHRhdGlvbiBDb25maXJtZWRcXG5cXG5Qcm92aWRlcjogJHtwcm92aWRlck5hbWV9XFxuVHlwZTogJHtjb25zdWx0YXRpb25UeXBlfVxcblxcbllvdXIgY29uc3VsdGF0aW9uIGhhcyBiZWVuIGNvbmZpcm1lZC4gWW91IHdpbGwgcmVjZWl2ZSBzY2hlZHVsaW5nIGRldGFpbHMgc29vbi5gO1xuICAgICAgY29uc3Qgc21zUmVzdWx0ID0gYXdhaXQgc21zU2VydmljZS5zZW5kU01TKHtcbiAgICAgICAgdG86IHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmICghc21zUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlNNUyBub3RpZmljYXRpb24gZmFpbGVkIChjb25maXJtYXRpb24sIG5vIHNjaGVkdWxlZF9hdCk6XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBwYXRpZW50SWQsXG4gICAgICAgICAgcGhvbmVOdW1iZXI6IHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICAgIGVycm9yOiBzbXNSZXN1bHQuZXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90aWZpY2F0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5IChjb25maXJtYXRpb24sIG5vIHNjaGVkdWxlZF9hdCk6XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBtZXNzYWdlSWQ6IHNtc1Jlc3VsdC5tZXNzYWdlSWQsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlNNUyBub3Qgc2VudCBmb3IgcGF0aWVudCBjb25maXJtYXRpb246XCIsIHtcbiAgICAgICAgY29uc3VsdGF0aW9uSWQsXG4gICAgICAgIHBhdGllbnRJZCxcbiAgICAgICAgcmVhc29uOiAhc2hvdWxkU2VuZFNNUyhwYXRpZW50Lm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcylcbiAgICAgICAgICA/IFwiVXNlciBwcmVmZXJlbmNlIGRvZXMgbm90IGFsbG93IFNNU1wiXG4gICAgICAgICAgOiAhcGF0aWVudC5waG9uZV9udW1iZXJcbiAgICAgICAgICA/IFwiUGF0aWVudCBoYXMgbm8gcGhvbmUgbnVtYmVyXCJcbiAgICAgICAgICA6IFwiTm8gc2NoZWR1bGVkX2F0IGFuZCBwcmVmZXJlbmNlIGNoZWNrIGZhaWxlZFwiLFxuICAgICAgICBwcmVmZXJlbmNlOiBwYXRpZW50Lm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcyxcbiAgICAgICAgaGFzUGhvbmVOdW1iZXI6ICEhcGF0aWVudC5waG9uZV9udW1iZXIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTZW5kIGVtYWlsIG5vdGlmaWNhdGlvbiAocmVzcGVjdCB1c2VyIHByZWZlcmVuY2VzKVxuICAgIGlmIChcbiAgICAgIHNob3VsZFNlbmRFbWFpbChwYXRpZW50Lm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcykgJiZcbiAgICAgIHBhdGllbnQuZW1haWwgJiZcbiAgICAgIGNvbnN1bHRhdGlvbi5zY2hlZHVsZWRfYXRcbiAgICApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGVtYWlsU2VydmljZS5zZW5kQ29uc3VsdGF0aW9uQ29uZmlybWVkRW1haWwoXG4gICAgICAgICAgcGF0aWVudC5lbWFpbCxcbiAgICAgICAgICBwcm92aWRlck5hbWUsXG4gICAgICAgICAgY29uc3VsdGF0aW9uVHlwZSxcbiAgICAgICAgICBjb25zdWx0YXRpb24uc2NoZWR1bGVkX2F0LFxuICAgICAgICAgIGNvbnN1bHRhdGlvbklkXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlbWFpbEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIGVtYWlsIG5vdGlmaWNhdGlvbjpcIiwgZW1haWxFcnJvcik7XG4gICAgICAgIC8vIERvbid0IHRocm93IC0gZW1haWwgZmFpbHVyZXMgYXJlIG5vbi1jcml0aWNhbFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRPRE86IEFkZCBwdXNoIG5vdGlmaWNhdGlvbiBoZXJlIGlmIG5lZWRlZFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIHBhdGllbnQgYWNjZXB0YW5jZSBub3RpZmljYXRpb246XCIsIGVycm9yKTtcbiAgICAvLyBEb24ndCB0aHJvdyAtIG5vdGlmaWNhdGlvbnMgYXJlIG5vbi1jcml0aWNhbFxuICB9XG59XG5cbi8qKlxuICogU2VuZCBub3RpZmljYXRpb24gdG8gcGF0aWVudCB3aGVuIHByb3ZpZGVyIGlzIGFzc2lnbmVkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBub3RpZnlQYXRpZW50QXNzaWdubWVudChcbiAgY29uc3VsdGF0aW9uSWQ6IHN0cmluZyxcbiAgcGF0aWVudElkOiBzdHJpbmdcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGFkbWluQ2xpZW50ID0gZ2V0QWRtaW5DbGllbnQoKTtcblxuICAgIC8vIEdldCBwYXRpZW50IGRldGFpbHMgd2l0aCBub3RpZmljYXRpb24gcHJlZmVyZW5jZXNcbiAgICBjb25zdCB7IGRhdGE6IHBhdGllbnQgfSA9IGF3YWl0IGFkbWluQ2xpZW50XG4gICAgICAuZnJvbShcInVzZXJzXCIpXG4gICAgICAuc2VsZWN0KFwiaWQsIGZ1bGxfbmFtZSwgcGhvbmVfbnVtYmVyLCBlbWFpbCwgbm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzXCIpXG4gICAgICAuZXEoXCJpZFwiLCBwYXRpZW50SWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIXBhdGllbnQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJQYXRpZW50IG5vdCBmb3VuZCBmb3IgYXNzaWdubWVudCBub3RpZmljYXRpb25cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IGNvbnN1bHRhdGlvbiBkZXRhaWxzXG4gICAgY29uc3QgeyBkYXRhOiBjb25zdWx0YXRpb24gfSA9IGF3YWl0IGFkbWluQ2xpZW50XG4gICAgICAuZnJvbShcImNvbnN1bHRhdGlvbnNcIilcbiAgICAgIC5zZWxlY3QoXG4gICAgICAgIGBcbiAgICAgICAgKixcbiAgICAgICAgaGVhbHRoY2FyZV9wcm92aWRlcnMgKFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIGZ1bGxfbmFtZSxcbiAgICAgICAgICBzcGVjaWFsdHlcbiAgICAgICAgKVxuICAgICAgYFxuICAgICAgKVxuICAgICAgLmVxKFwiaWRcIiwgY29uc3VsdGF0aW9uSWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIWNvbnN1bHRhdGlvbiB8fCAhY29uc3VsdGF0aW9uLmhlYWx0aGNhcmVfcHJvdmlkZXJzKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQ29uc3VsdGF0aW9uIG5vdCBmb3VuZCBmb3IgYXNzaWdubWVudCBub3RpZmljYXRpb25cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcHJvdmlkZXJOYW1lID1cbiAgICAgIGNvbnN1bHRhdGlvbi5oZWFsdGhjYXJlX3Byb3ZpZGVycy5mdWxsX25hbWUgfHwgXCJIZWFsdGhjYXJlIFByb3ZpZGVyXCI7XG4gICAgY29uc3QgY29uc3VsdGF0aW9uVHlwZSA9XG4gICAgICBjb25zdWx0YXRpb24uY29uc3VsdGF0aW9uX3R5cGUgPT09IFwidmlkZW9cIlxuICAgICAgICA/IFwiVmlkZW8gQ2FsbFwiXG4gICAgICAgIDogY29uc3VsdGF0aW9uLmNvbnN1bHRhdGlvbl90eXBlID09PSBcInZvaWNlXCJcbiAgICAgICAgPyBcIlZvaWNlIENhbGxcIlxuICAgICAgICA6IFwiU01TIENvbnN1bHRhdGlvblwiO1xuICAgIFxuICAgIC8vIEZvcm1hdCBzY2hlZHVsZWQgZGF0ZVxuICAgIGxldCBzY2hlZHVsZWREYXRlID0gXCJUQkRcIjtcbiAgICBpZiAoY29uc3VsdGF0aW9uLnNjaGVkdWxlZF9hdCkge1xuICAgICAgc2NoZWR1bGVkRGF0ZSA9IG5ldyBEYXRlKGNvbnN1bHRhdGlvbi5zY2hlZHVsZWRfYXQpLnRvTG9jYWxlRGF0ZVN0cmluZyhcImVuLVVTXCIsIHtcbiAgICAgICAgZGF0ZVN0eWxlOiBcIm1lZGl1bVwiLFxuICAgICAgICB0aW1lU3R5bGU6IFwic2hvcnRcIixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoY29uc3VsdGF0aW9uLnByZWZlcnJlZF9kYXRlKSB7XG4gICAgICBzY2hlZHVsZWREYXRlID0gbmV3IERhdGUoY29uc3VsdGF0aW9uLnByZWZlcnJlZF9kYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgICAgIGRhdGVTdHlsZTogXCJtZWRpdW1cIixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNlbmQgU01TIG5vdGlmaWNhdGlvbiAocmVzcGVjdCB1c2VyIHByZWZlcmVuY2VzKVxuICAgIGlmIChcbiAgICAgIHNob3VsZFNlbmRTTVMocGF0aWVudC5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMpICYmXG4gICAgICBwYXRpZW50LnBob25lX251bWJlclxuICAgICkge1xuICAgICAgY29uc3Qgc21zUmVzdWx0ID0gYXdhaXQgc21zU2VydmljZS5zZW5kUGF0aWVudEFzc2lnbm1lbnROb3RpZmljYXRpb24oXG4gICAgICAgIHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICBwcm92aWRlck5hbWUsXG4gICAgICAgIGNvbnN1bHRhdGlvblR5cGUsXG4gICAgICAgIHNjaGVkdWxlZERhdGVcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghc21zUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlNNUyBub3RpZmljYXRpb24gZmFpbGVkIGZvciBwYXRpZW50IGFzc2lnbm1lbnQ6XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBwYXRpZW50SWQsXG4gICAgICAgICAgcGhvbmVOdW1iZXI6IHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICAgIGVycm9yOiBzbXNSZXN1bHQuZXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90aWZpY2F0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5IChwYXRpZW50IGFzc2lnbm1lbnQpOlwiLCB7XG4gICAgICAgICAgY29uc3VsdGF0aW9uSWQsXG4gICAgICAgICAgbWVzc2FnZUlkOiBzbXNSZXN1bHQubWVzc2FnZUlkLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90IHNlbnQgZm9yIHBhdGllbnQgYXNzaWdubWVudDpcIiwge1xuICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgcGF0aWVudElkLFxuICAgICAgICByZWFzb246ICFzaG91bGRTZW5kU01TKHBhdGllbnQubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzKVxuICAgICAgICAgID8gXCJVc2VyIHByZWZlcmVuY2UgZG9lcyBub3QgYWxsb3cgU01TXCJcbiAgICAgICAgICA6ICFwYXRpZW50LnBob25lX251bWJlclxuICAgICAgICAgID8gXCJQYXRpZW50IGhhcyBubyBwaG9uZSBudW1iZXJcIlxuICAgICAgICAgIDogXCJVbmtub3duIHJlYXNvblwiLFxuICAgICAgICBwcmVmZXJlbmNlOiBwYXRpZW50Lm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcyxcbiAgICAgICAgaGFzUGhvbmVOdW1iZXI6ICEhcGF0aWVudC5waG9uZV9udW1iZXIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTZW5kIGVtYWlsIG5vdGlmaWNhdGlvbiAocmVzcGVjdCB1c2VyIHByZWZlcmVuY2VzKVxuICAgIGlmIChzaG91bGRTZW5kRW1haWwocGF0aWVudC5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMpICYmIHBhdGllbnQuZW1haWwpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGVtYWlsU2VydmljZS5zZW5kQ29uc3VsdGF0aW9uQXNzaWduZWRFbWFpbChcbiAgICAgICAgICBwYXRpZW50LmVtYWlsLFxuICAgICAgICAgIHByb3ZpZGVyTmFtZSxcbiAgICAgICAgICBjb25zdWx0YXRpb25UeXBlLFxuICAgICAgICAgIHNjaGVkdWxlZERhdGUsXG4gICAgICAgICAgY29uc3VsdGF0aW9uSWRcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVtYWlsRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlbmRpbmcgZW1haWwgbm90aWZpY2F0aW9uOlwiLCBlbWFpbEVycm9yKTtcbiAgICAgICAgLy8gRG9uJ3QgdGhyb3cgLSBlbWFpbCBmYWlsdXJlcyBhcmUgbm9uLWNyaXRpY2FsXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVE9ETzogQWRkIHB1c2ggbm90aWZpY2F0aW9uIGhlcmUgaWYgbmVlZGVkXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlbmRpbmcgcGF0aWVudCBhc3NpZ25tZW50IG5vdGlmaWNhdGlvbjpcIiwgZXJyb3IpO1xuICAgIC8vIERvbid0IHRocm93IC0gbm90aWZpY2F0aW9ucyBhcmUgbm9uLWNyaXRpY2FsXG4gIH1cbn1cblxuLyoqXG4gKiBTZW5kIHBheW1lbnQgY29uZmlybWF0aW9uIG5vdGlmaWNhdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm90aWZ5UGF5bWVudENvbmZpcm1hdGlvbihcbiAgY29uc3VsdGF0aW9uSWQ6IHN0cmluZyxcbiAgcGF0aWVudElkOiBzdHJpbmcsXG4gIGFtb3VudDogbnVtYmVyXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhZG1pbkNsaWVudCA9IGdldEFkbWluQ2xpZW50KCk7XG5cbiAgICAvLyBHZXQgcGF0aWVudCBkZXRhaWxzIHdpdGggbm90aWZpY2F0aW9uIHByZWZlcmVuY2VzXG4gICAgY29uc3QgeyBkYXRhOiBwYXRpZW50IH0gPSBhd2FpdCBhZG1pbkNsaWVudFxuICAgICAgLmZyb20oXCJ1c2Vyc1wiKVxuICAgICAgLnNlbGVjdChcImlkLCBmdWxsX25hbWUsIHBob25lX251bWJlciwgZW1haWwsIG5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlc1wiKVxuICAgICAgLmVxKFwiaWRcIiwgcGF0aWVudElkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKCFwYXRpZW50KSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiUGF0aWVudCBub3QgZm91bmQgZm9yIHBheW1lbnQgbm90aWZpY2F0aW9uXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEdldCBjb25zdWx0YXRpb24gZGV0YWlsc1xuICAgIGNvbnN0IHsgZGF0YTogY29uc3VsdGF0aW9uIH0gPSBhd2FpdCBhZG1pbkNsaWVudFxuICAgICAgLmZyb20oXCJjb25zdWx0YXRpb25zXCIpXG4gICAgICAuc2VsZWN0KFwiY29uc3VsdGF0aW9uX3R5cGVcIilcbiAgICAgIC5lcShcImlkXCIsIGNvbnN1bHRhdGlvbklkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKCFjb25zdWx0YXRpb24pIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb25zdWx0YXRpb24gbm90IGZvdW5kIGZvciBwYXltZW50IG5vdGlmaWNhdGlvblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjb25zdWx0YXRpb25UeXBlID1cbiAgICAgIGNvbnN1bHRhdGlvbi5jb25zdWx0YXRpb25fdHlwZSA9PT0gXCJ2aWRlb1wiXG4gICAgICAgID8gXCJWaWRlbyBDYWxsXCJcbiAgICAgICAgOiBjb25zdWx0YXRpb24uY29uc3VsdGF0aW9uX3R5cGUgPT09IFwidm9pY2VcIlxuICAgICAgICA/IFwiVm9pY2UgQ2FsbFwiXG4gICAgICAgIDogXCJTTVMgQ29uc3VsdGF0aW9uXCI7XG5cbiAgICAvLyBTZW5kIFNNUyBjb25maXJtYXRpb24gKHJlc3BlY3QgdXNlciBwcmVmZXJlbmNlcylcbiAgICBpZiAoXG4gICAgICBzaG91bGRTZW5kU01TKHBhdGllbnQubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzKSAmJlxuICAgICAgcGF0aWVudC5waG9uZV9udW1iZXJcbiAgICApIHtcbiAgICAgIGNvbnN0IHNtc1Jlc3VsdCA9IGF3YWl0IHNtc1NlcnZpY2Uuc2VuZFBheW1lbnRDb25maXJtYXRpb24oXG4gICAgICAgIHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIGNvbnN1bHRhdGlvblR5cGVcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghc21zUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlNNUyBub3RpZmljYXRpb24gZmFpbGVkIGZvciBwYXltZW50IGNvbmZpcm1hdGlvbjpcIiwge1xuICAgICAgICAgIGNvbnN1bHRhdGlvbklkLFxuICAgICAgICAgIHBhdGllbnRJZCxcbiAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgcGhvbmVOdW1iZXI6IHBhdGllbnQucGhvbmVfbnVtYmVyLFxuICAgICAgICAgIGVycm9yOiBzbXNSZXN1bHQuZXJyb3IsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90aWZpY2F0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5IChwYXltZW50IGNvbmZpcm1hdGlvbik6XCIsIHtcbiAgICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgbWVzc2FnZUlkOiBzbXNSZXN1bHQubWVzc2FnZUlkLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJTTVMgbm90IHNlbnQgZm9yIHBheW1lbnQgY29uZmlybWF0aW9uOlwiLCB7XG4gICAgICAgIGNvbnN1bHRhdGlvbklkLFxuICAgICAgICBwYXRpZW50SWQsXG4gICAgICAgIHJlYXNvbjogIXNob3VsZFNlbmRTTVMocGF0aWVudC5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMpXG4gICAgICAgICAgPyBcIlVzZXIgcHJlZmVyZW5jZSBkb2VzIG5vdCBhbGxvdyBTTVNcIlxuICAgICAgICAgIDogIXBhdGllbnQucGhvbmVfbnVtYmVyXG4gICAgICAgICAgPyBcIlBhdGllbnQgaGFzIG5vIHBob25lIG51bWJlclwiXG4gICAgICAgICAgOiBcIlVua25vd24gcmVhc29uXCIsXG4gICAgICAgIHByZWZlcmVuY2U6IHBhdGllbnQubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzLFxuICAgICAgICBoYXNQaG9uZU51bWJlcjogISFwYXRpZW50LnBob25lX251bWJlcixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNlbmQgZW1haWwgbm90aWZpY2F0aW9uIChyZXNwZWN0IHVzZXIgcHJlZmVyZW5jZXMpXG4gICAgaWYgKHNob3VsZFNlbmRFbWFpbChwYXRpZW50Lm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcykgJiYgcGF0aWVudC5lbWFpbCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZW1haWxTZXJ2aWNlLnNlbmRQYXltZW50Q29uZmlybWF0aW9uRW1haWwoXG4gICAgICAgICAgcGF0aWVudC5lbWFpbCxcbiAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgY29uc3VsdGF0aW9uVHlwZSxcbiAgICAgICAgICBjb25zdWx0YXRpb25JZFxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZW1haWxFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2VuZGluZyBlbWFpbCBub3RpZmljYXRpb246XCIsIGVtYWlsRXJyb3IpO1xuICAgICAgICAvLyBEb24ndCB0aHJvdyAtIGVtYWlsIGZhaWx1cmVzIGFyZSBub24tY3JpdGljYWxcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlbmRpbmcgcGF5bWVudCBjb25maXJtYXRpb24gbm90aWZpY2F0aW9uOlwiLCBlcnJvcik7XG4gICAgLy8gRG9uJ3QgdGhyb3cgLSBub3RpZmljYXRpb25zIGFyZSBub24tY3JpdGljYWxcbiAgfVxufVxuXG4vKipcbiAqIFNlbmQgY29uc3VsdGF0aW9uIHJlbWluZGVyIG5vdGlmaWNhdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm90aWZ5Q29uc3VsdGF0aW9uUmVtaW5kZXIoXG4gIGNvbnN1bHRhdGlvbklkOiBzdHJpbmcsXG4gIHVzZXJJZDogc3RyaW5nLFxuICByZWNpcGllbnRUeXBlOiBcInBhdGllbnRcIiB8IFwicHJvdmlkZXJcIlxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYWRtaW5DbGllbnQgPSBnZXRBZG1pbkNsaWVudCgpO1xuXG4gICAgLy8gR2V0IHVzZXIgZGV0YWlscyB3aXRoIG5vdGlmaWNhdGlvbiBwcmVmZXJlbmNlc1xuICAgIGNvbnN0IHsgZGF0YTogdXNlciB9ID0gYXdhaXQgYWRtaW5DbGllbnRcbiAgICAgIC5mcm9tKFwidXNlcnNcIilcbiAgICAgIC5zZWxlY3QoXCJpZCwgZnVsbF9uYW1lLCBwaG9uZV9udW1iZXIsIGVtYWlsLCBub3RpZmljYXRpb25fcHJlZmVyZW5jZXNcIilcbiAgICAgIC5lcShcImlkXCIsIHVzZXJJZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghdXNlcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlVzZXIgbm90IGZvdW5kIGZvciByZW1pbmRlciBub3RpZmljYXRpb25cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gR2V0IGNvbnN1bHRhdGlvbiBkZXRhaWxzXG4gICAgY29uc3QgeyBkYXRhOiBjb25zdWx0YXRpb24gfSA9IGF3YWl0IGFkbWluQ2xpZW50XG4gICAgICAuZnJvbShcImNvbnN1bHRhdGlvbnNcIilcbiAgICAgIC5zZWxlY3QoXG4gICAgICAgIGBcbiAgICAgICAgKixcbiAgICAgICAgaGVhbHRoY2FyZV9wcm92aWRlcnMgKFxuICAgICAgICAgIGlkLFxuICAgICAgICAgIGZ1bGxfbmFtZVxuICAgICAgICApLFxuICAgICAgICB1c2VycyAoXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgZnVsbF9uYW1lXG4gICAgICAgIClcbiAgICAgIGBcbiAgICAgIClcbiAgICAgIC5lcShcImlkXCIsIGNvbnN1bHRhdGlvbklkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKCFjb25zdWx0YXRpb24gfHwgIWNvbnN1bHRhdGlvbi5zY2hlZHVsZWRfYXQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb25zdWx0YXRpb24gbm90IGZvdW5kIG9yIG5vdCBzY2hlZHVsZWQgZm9yIHJlbWluZGVyXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHByb3ZpZGVyTmFtZSA9XG4gICAgICBjb25zdWx0YXRpb24uaGVhbHRoY2FyZV9wcm92aWRlcnM/LmZ1bGxfbmFtZSB8fCBcIkhlYWx0aGNhcmUgUHJvdmlkZXJcIjtcbiAgICBjb25zdCBwYXRpZW50TmFtZSA9IGNvbnN1bHRhdGlvbi51c2Vycz8uZnVsbF9uYW1lIHx8IFwiUGF0aWVudFwiO1xuICAgIGNvbnN0IGNvbnN1bHRhdGlvblR5cGUgPVxuICAgICAgY29uc3VsdGF0aW9uLmNvbnN1bHRhdGlvbl90eXBlID09PSBcInZpZGVvXCJcbiAgICAgICAgPyBcIlZpZGVvIENhbGxcIlxuICAgICAgICA6IGNvbnN1bHRhdGlvbi5jb25zdWx0YXRpb25fdHlwZSA9PT0gXCJ2b2ljZVwiXG4gICAgICAgID8gXCJWb2ljZSBDYWxsXCJcbiAgICAgICAgOiBcIlNNUyBDb25zdWx0YXRpb25cIjtcblxuICAgIC8vIFNlbmQgZW1haWwgcmVtaW5kZXIgKHJlc3BlY3QgdXNlciBwcmVmZXJlbmNlcylcbiAgICBpZiAoXG4gICAgICBzaG91bGRTZW5kRW1haWwodXNlci5ub3RpZmljYXRpb25fcHJlZmVyZW5jZXMpICYmXG4gICAgICB1c2VyLmVtYWlsXG4gICAgKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZENvbnN1bHRhdGlvblJlbWluZGVyRW1haWwoXG4gICAgICAgICAgdXNlci5lbWFpbCxcbiAgICAgICAgICByZWNpcGllbnRUeXBlID09PSBcInBhdGllbnRcIiA/IHByb3ZpZGVyTmFtZSA6IHBhdGllbnROYW1lLFxuICAgICAgICAgIGNvbnN1bHRhdGlvblR5cGUsXG4gICAgICAgICAgY29uc3VsdGF0aW9uLnNjaGVkdWxlZF9hdCxcbiAgICAgICAgICBjb25zdWx0YXRpb25JZFxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZW1haWxFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2VuZGluZyBlbWFpbCByZW1pbmRlcjpcIiwgZW1haWxFcnJvcik7XG4gICAgICAgIC8vIERvbid0IHRocm93IC0gZW1haWwgZmFpbHVyZXMgYXJlIG5vbi1jcml0aWNhbFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNlbmQgU01TIHJlbWluZGVyIChyZXNwZWN0IHVzZXIgcHJlZmVyZW5jZXMpXG4gICAgaWYgKFxuICAgICAgc2hvdWxkU2VuZFNNUyh1c2VyLm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcykgJiZcbiAgICAgIHVzZXIucGhvbmVfbnVtYmVyXG4gICAgKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBzY2hlZHVsZWREYXRlID0gbmV3IERhdGUoY29uc3VsdGF0aW9uLnNjaGVkdWxlZF9hdCkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgICAgICAgZGF0ZVN0eWxlOiBcIm1lZGl1bVwiLFxuICAgICAgICAgIHRpbWVTdHlsZTogXCJzaG9ydFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGBDb25zdWx0YXRpb24gUmVtaW5kZXJcXG5cXG5Qcm92aWRlcjogJHtwcm92aWRlck5hbWV9XFxuVHlwZTogJHtjb25zdWx0YXRpb25UeXBlfVxcblNjaGVkdWxlZDogJHtzY2hlZHVsZWREYXRlfVxcblxcblBsZWFzZSBqb2luIG9uIHRpbWUuYDtcbiAgICAgICAgY29uc3Qgc21zUmVzdWx0ID0gYXdhaXQgc21zU2VydmljZS5zZW5kU01TKHtcbiAgICAgICAgICB0bzogdXNlci5waG9uZV9udW1iZXIsXG4gICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXNtc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlNNUyByZW1pbmRlciBmYWlsZWQ6XCIsIHtcbiAgICAgICAgICAgIGNvbnN1bHRhdGlvbklkLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgcmVjaXBpZW50VHlwZSxcbiAgICAgICAgICAgIHBob25lTnVtYmVyOiB1c2VyLnBob25lX251bWJlcixcbiAgICAgICAgICAgIGVycm9yOiBzbXNSZXN1bHQuZXJyb3IsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJTTVMgcmVtaW5kZXIgc2VudCBzdWNjZXNzZnVsbHk6XCIsIHtcbiAgICAgICAgICAgIGNvbnN1bHRhdGlvbklkLFxuICAgICAgICAgICAgbWVzc2FnZUlkOiBzbXNSZXN1bHQubWVzc2FnZUlkLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChzbXNFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2VuZGluZyBTTVMgcmVtaW5kZXI6XCIsIHNtc0Vycm9yKTtcbiAgICAgICAgLy8gRG9uJ3QgdGhyb3cgLSBTTVMgZmFpbHVyZXMgYXJlIG5vbi1jcml0aWNhbFxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlNNUyByZW1pbmRlciBub3Qgc2VudDpcIiwge1xuICAgICAgICBjb25zdWx0YXRpb25JZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICByZWFzb246ICFzaG91bGRTZW5kU01TKHVzZXIubm90aWZpY2F0aW9uX3ByZWZlcmVuY2VzKVxuICAgICAgICAgID8gXCJVc2VyIHByZWZlcmVuY2UgZG9lcyBub3QgYWxsb3cgU01TXCJcbiAgICAgICAgICA6ICF1c2VyLnBob25lX251bWJlclxuICAgICAgICAgID8gXCJVc2VyIGhhcyBubyBwaG9uZSBudW1iZXJcIlxuICAgICAgICAgIDogXCJVbmtub3duIHJlYXNvblwiLFxuICAgICAgICBwcmVmZXJlbmNlOiB1c2VyLm5vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcyxcbiAgICAgICAgaGFzUGhvbmVOdW1iZXI6ICEhdXNlci5waG9uZV9udW1iZXIsXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlbmRpbmcgY29uc3VsdGF0aW9uIHJlbWluZGVyOlwiLCBlcnJvcik7XG4gICAgLy8gRG9uJ3QgdGhyb3cgLSBub3RpZmljYXRpb25zIGFyZSBub24tY3JpdGljYWxcbiAgfVxufVxuIl0sIm5hbWVzIjpbInNtc1NlcnZpY2UiLCJlbWFpbFNlcnZpY2UiLCJnZXRBZG1pbkNsaWVudCIsInNob3VsZFNlbmRTTVMiLCJzaG91bGRTZW5kRW1haWwiLCJub3RpZnlQcm92aWRlckJvb2tpbmciLCJjb25zdWx0YXRpb25JZCIsInByb3ZpZGVySWQiLCJhZG1pbkNsaWVudCIsImRhdGEiLCJwcm92aWRlciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInVzZXJzIiwiY29uc29sZSIsImVycm9yIiwiY29uc3VsdGF0aW9uIiwicGF0aWVudE5hbWUiLCJmdWxsX25hbWUiLCJjb25zdWx0YXRpb25UeXBlIiwiY29uc3VsdGF0aW9uX3R5cGUiLCJub3RpZmljYXRpb25fcHJlZmVyZW5jZXMiLCJwaG9uZV9udW1iZXIiLCJzY2hlZHVsZWRfYXQiLCJzbXNSZXN1bHQiLCJzZW5kUHJvdmlkZXJCb29raW5nTm90aWZpY2F0aW9uIiwic3VjY2VzcyIsInBob25lTnVtYmVyIiwibWVzc2FnZUlkIiwibG9nIiwibWVzc2FnZSIsInNlbmRTTVMiLCJ0byIsInJlYXNvbiIsInByZWZlcmVuY2UiLCJoYXNQaG9uZU51bWJlciIsImVtYWlsIiwic2VuZFByb3ZpZGVyQm9va2luZ0VtYWlsIiwiZW1haWxFcnJvciIsIm5vdGlmeVBhdGllbnRBY2NlcHRhbmNlIiwicGF0aWVudElkIiwicGF0aWVudCIsImhlYWx0aGNhcmVfcHJvdmlkZXJzIiwicHJvdmlkZXJOYW1lIiwic2VuZFBhdGllbnRDb25maXJtYXRpb24iLCJzZW5kQ29uc3VsdGF0aW9uQ29uZmlybWVkRW1haWwiLCJub3RpZnlQYXRpZW50QXNzaWdubWVudCIsInNjaGVkdWxlZERhdGUiLCJEYXRlIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiZGF0ZVN0eWxlIiwidGltZVN0eWxlIiwicHJlZmVycmVkX2RhdGUiLCJzZW5kUGF0aWVudEFzc2lnbm1lbnROb3RpZmljYXRpb24iLCJzZW5kQ29uc3VsdGF0aW9uQXNzaWduZWRFbWFpbCIsIm5vdGlmeVBheW1lbnRDb25maXJtYXRpb24iLCJhbW91bnQiLCJzZW5kUGF5bWVudENvbmZpcm1hdGlvbiIsInNlbmRQYXltZW50Q29uZmlybWF0aW9uRW1haWwiLCJub3RpZnlDb25zdWx0YXRpb25SZW1pbmRlciIsInVzZXJJZCIsInJlY2lwaWVudFR5cGUiLCJ1c2VyIiwic2VuZENvbnN1bHRhdGlvblJlbWluZGVyRW1haWwiLCJ0b0xvY2FsZVN0cmluZyIsInNtc0Vycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/notifications/index.ts\n");

/***/ }),

/***/ "(rsc)/./lib/notifications/preferences.ts":
/*!******************************************!*\
  !*** ./lib/notifications/preferences.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getPreferenceDescription: () => (/* binding */ getPreferenceDescription),\n/* harmony export */   getPreferenceDisplayName: () => (/* binding */ getPreferenceDisplayName),\n/* harmony export */   getUserNotificationPreference: () => (/* binding */ getUserNotificationPreference),\n/* harmony export */   shouldSendEmail: () => (/* binding */ shouldSendEmail),\n/* harmony export */   shouldSendSMS: () => (/* binding */ shouldSendSMS)\n/* harmony export */ });\n/**\n * Notification Preferences Helper\n * \n * Utilities for checking and respecting user notification preferences\n */ /**\n * Get user's notification preference\n * Defaults to 'sms' for backward compatibility\n */ function getUserNotificationPreference(userPreference) {\n    return userPreference || \"sms\";\n}\n/**\n * Check if user wants SMS notifications\n */ function shouldSendSMS(userPreference) {\n    const preference = getUserNotificationPreference(userPreference);\n    return preference === \"sms\" || preference === \"both\";\n}\n/**\n * Check if user wants Email notifications\n */ function shouldSendEmail(userPreference) {\n    const preference = getUserNotificationPreference(userPreference);\n    return preference === \"email\" || preference === \"both\";\n}\n/**\n * Get notification preference display name\n */ function getPreferenceDisplayName(preference) {\n    const names = {\n        sms: \"SMS Only\",\n        email: \"Email Only\",\n        both: \"SMS & Email\"\n    };\n    return names[preference];\n}\n/**\n * Get notification preference description\n */ function getPreferenceDescription(preference) {\n    const descriptions = {\n        sms: \"Receive notifications via SMS only\",\n        email: \"Receive notifications via Email only\",\n        both: \"Receive notifications via both SMS and Email\"\n    };\n    return descriptions[preference];\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvbm90aWZpY2F0aW9ucy9wcmVmZXJlbmNlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7O0NBSUMsR0FJRDs7O0NBR0MsR0FDTSxTQUFTQSw4QkFDZEMsY0FBOEM7SUFFOUMsT0FBT0Esa0JBQWtCO0FBQzNCO0FBRUE7O0NBRUMsR0FDTSxTQUFTQyxjQUNkRCxjQUE4QztJQUU5QyxNQUFNRSxhQUFhSCw4QkFBOEJDO0lBQ2pELE9BQU9FLGVBQWUsU0FBU0EsZUFBZTtBQUNoRDtBQUVBOztDQUVDLEdBQ00sU0FBU0MsZ0JBQ2RILGNBQThDO0lBRTlDLE1BQU1FLGFBQWFILDhCQUE4QkM7SUFDakQsT0FBT0UsZUFBZSxXQUFXQSxlQUFlO0FBQ2xEO0FBRUE7O0NBRUMsR0FDTSxTQUFTRSx5QkFDZEYsVUFBa0M7SUFFbEMsTUFBTUcsUUFBZ0Q7UUFDcERDLEtBQUs7UUFDTEMsT0FBTztRQUNQQyxNQUFNO0lBQ1I7SUFDQSxPQUFPSCxLQUFLLENBQUNILFdBQVc7QUFDMUI7QUFFQTs7Q0FFQyxHQUNNLFNBQVNPLHlCQUNkUCxVQUFrQztJQUVsQyxNQUFNUSxlQUF1RDtRQUMzREosS0FBSztRQUNMQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtJQUNBLE9BQU9FLFlBQVksQ0FBQ1IsV0FBVztBQUNqQyIsInNvdXJjZXMiOlsid2VicGFjazovL3J1cmFsLWhlYWx0aC1wbGF0Zm9ybS8uL2xpYi9ub3RpZmljYXRpb25zL3ByZWZlcmVuY2VzLnRzP2ZhOTAiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBOb3RpZmljYXRpb24gUHJlZmVyZW5jZXMgSGVscGVyXG4gKiBcbiAqIFV0aWxpdGllcyBmb3IgY2hlY2tpbmcgYW5kIHJlc3BlY3RpbmcgdXNlciBub3RpZmljYXRpb24gcHJlZmVyZW5jZXNcbiAqL1xuXG5pbXBvcnQgdHlwZSB7IE5vdGlmaWNhdGlvblByZWZlcmVuY2UgfSBmcm9tICdAL2xpYi90eXBlcy9hdXRoJ1xuXG4vKipcbiAqIEdldCB1c2VyJ3Mgbm90aWZpY2F0aW9uIHByZWZlcmVuY2VcbiAqIERlZmF1bHRzIHRvICdzbXMnIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyTm90aWZpY2F0aW9uUHJlZmVyZW5jZShcbiAgdXNlclByZWZlcmVuY2U/OiBOb3RpZmljYXRpb25QcmVmZXJlbmNlIHwgbnVsbFxuKTogTm90aWZpY2F0aW9uUHJlZmVyZW5jZSB7XG4gIHJldHVybiB1c2VyUHJlZmVyZW5jZSB8fCAnc21zJ1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHVzZXIgd2FudHMgU01TIG5vdGlmaWNhdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3VsZFNlbmRTTVMoXG4gIHVzZXJQcmVmZXJlbmNlPzogTm90aWZpY2F0aW9uUHJlZmVyZW5jZSB8IG51bGxcbik6IGJvb2xlYW4ge1xuICBjb25zdCBwcmVmZXJlbmNlID0gZ2V0VXNlck5vdGlmaWNhdGlvblByZWZlcmVuY2UodXNlclByZWZlcmVuY2UpXG4gIHJldHVybiBwcmVmZXJlbmNlID09PSAnc21zJyB8fCBwcmVmZXJlbmNlID09PSAnYm90aCdcbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIHdhbnRzIEVtYWlsIG5vdGlmaWNhdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3VsZFNlbmRFbWFpbChcbiAgdXNlclByZWZlcmVuY2U/OiBOb3RpZmljYXRpb25QcmVmZXJlbmNlIHwgbnVsbFxuKTogYm9vbGVhbiB7XG4gIGNvbnN0IHByZWZlcmVuY2UgPSBnZXRVc2VyTm90aWZpY2F0aW9uUHJlZmVyZW5jZSh1c2VyUHJlZmVyZW5jZSlcbiAgcmV0dXJuIHByZWZlcmVuY2UgPT09ICdlbWFpbCcgfHwgcHJlZmVyZW5jZSA9PT0gJ2JvdGgnXG59XG5cbi8qKlxuICogR2V0IG5vdGlmaWNhdGlvbiBwcmVmZXJlbmNlIGRpc3BsYXkgbmFtZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJlZmVyZW5jZURpc3BsYXlOYW1lKFxuICBwcmVmZXJlbmNlOiBOb3RpZmljYXRpb25QcmVmZXJlbmNlXG4pOiBzdHJpbmcge1xuICBjb25zdCBuYW1lczogUmVjb3JkPE5vdGlmaWNhdGlvblByZWZlcmVuY2UsIHN0cmluZz4gPSB7XG4gICAgc21zOiAnU01TIE9ubHknLFxuICAgIGVtYWlsOiAnRW1haWwgT25seScsXG4gICAgYm90aDogJ1NNUyAmIEVtYWlsJyxcbiAgfVxuICByZXR1cm4gbmFtZXNbcHJlZmVyZW5jZV1cbn1cblxuLyoqXG4gKiBHZXQgbm90aWZpY2F0aW9uIHByZWZlcmVuY2UgZGVzY3JpcHRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFByZWZlcmVuY2VEZXNjcmlwdGlvbihcbiAgcHJlZmVyZW5jZTogTm90aWZpY2F0aW9uUHJlZmVyZW5jZVxuKTogc3RyaW5nIHtcbiAgY29uc3QgZGVzY3JpcHRpb25zOiBSZWNvcmQ8Tm90aWZpY2F0aW9uUHJlZmVyZW5jZSwgc3RyaW5nPiA9IHtcbiAgICBzbXM6ICdSZWNlaXZlIG5vdGlmaWNhdGlvbnMgdmlhIFNNUyBvbmx5JyxcbiAgICBlbWFpbDogJ1JlY2VpdmUgbm90aWZpY2F0aW9ucyB2aWEgRW1haWwgb25seScsXG4gICAgYm90aDogJ1JlY2VpdmUgbm90aWZpY2F0aW9ucyB2aWEgYm90aCBTTVMgYW5kIEVtYWlsJyxcbiAgfVxuICByZXR1cm4gZGVzY3JpcHRpb25zW3ByZWZlcmVuY2VdXG59XG4iXSwibmFtZXMiOlsiZ2V0VXNlck5vdGlmaWNhdGlvblByZWZlcmVuY2UiLCJ1c2VyUHJlZmVyZW5jZSIsInNob3VsZFNlbmRTTVMiLCJwcmVmZXJlbmNlIiwic2hvdWxkU2VuZEVtYWlsIiwiZ2V0UHJlZmVyZW5jZURpc3BsYXlOYW1lIiwibmFtZXMiLCJzbXMiLCJlbWFpbCIsImJvdGgiLCJnZXRQcmVmZXJlbmNlRGVzY3JpcHRpb24iLCJkZXNjcmlwdGlvbnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/notifications/preferences.ts\n");

/***/ }),

/***/ "(rsc)/./lib/notifications/sms.ts":
/*!**********************************!*\
  !*** ./lib/notifications/sms.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SMSService: () => (/* binding */ SMSService),\n/* harmony export */   smsService: () => (/* binding */ smsService)\n/* harmony export */ });\n/**\n * SMS Notification Service\n * Handles sending SMS notifications via Twilio or other SMS providers\n */ class SMSService {\n    constructor(){\n        this.twilioAccountSid = process.env.TWILIO_ACCOUNT_SID;\n        this.twilioAuthToken = process.env.TWILIO_AUTH_TOKEN;\n        this.twilioPhoneNumber = process.env.TWILIO_PHONE_NUMBER;\n        this.enabled = !!(this.twilioAccountSid && this.twilioAuthToken && this.twilioPhoneNumber);\n    }\n    /**\n   * Validate phone number format\n   * Must start with + and have country code (e.g., +232123456789)\n   */ validatePhoneNumber(phone) {\n        if (!phone) {\n            return {\n                valid: false,\n                error: \"Phone number is required\"\n            };\n        }\n        // Must start with + and have country code + number (10-15 digits total)\n        const phoneRegex = /^\\+[1-9]\\d{10,14}$/;\n        if (!phoneRegex.test(phone)) {\n            return {\n                valid: false,\n                error: `Invalid phone number format. Expected: +232XXXXXXXXX (with country code), got: ${phone}`\n            };\n        }\n        return {\n            valid: true\n        };\n    }\n    /**\n   * Send SMS via Twilio\n   */ async sendSMS(options) {\n        if (!this.enabled) {\n            console.warn(\"SMS service not configured. Skipping SMS send.\");\n            console.log(\"Would send SMS:\", {\n                to: options.to,\n                message: options.message.substring(0, 50) + \"...\"\n            });\n            return {\n                success: false,\n                error: \"SMS service not configured\"\n            };\n        }\n        // Validate phone number format\n        const phoneValidation = this.validatePhoneNumber(options.to);\n        if (!phoneValidation.valid) {\n            console.error(\"Invalid phone number:\", phoneValidation.error);\n            return {\n                success: false,\n                error: phoneValidation.error\n            };\n        }\n        try {\n            // Use Twilio SDK if available, otherwise use fetch\n            const response = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${this.twilioAccountSid}/Messages.json`, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/x-www-form-urlencoded\",\n                    Authorization: `Basic ${Buffer.from(`${this.twilioAccountSid}:${this.twilioAuthToken}`).toString(\"base64\")}`\n                },\n                body: new URLSearchParams({\n                    From: options.from || this.twilioPhoneNumber,\n                    To: options.to,\n                    Body: options.message\n                })\n            });\n            const data = await response.json();\n            if (!response.ok) {\n                console.error(\"Twilio SMS API error:\", {\n                    status: response.status,\n                    statusText: response.statusText,\n                    error: data,\n                    phoneNumber: options.to,\n                    message: options.message.substring(0, 50) + \"...\"\n                });\n                // Check for common Twilio errors\n                let errorMessage = data.message || \"Failed to send SMS\";\n                if (data.code === 21211) {\n                    errorMessage = \"Invalid phone number format\";\n                } else if (data.code === 21408) {\n                    errorMessage = \"Phone number not verified (trial account restriction)\";\n                } else if (data.code === 21608) {\n                    errorMessage = \"Unsubscribed recipient\";\n                }\n                return {\n                    success: false,\n                    error: errorMessage\n                };\n            }\n            console.log(\"SMS sent successfully via Twilio:\", {\n                messageId: data.sid,\n                phoneNumber: options.to,\n                status: data.status\n            });\n            return {\n                success: true,\n                messageId: data.sid\n            };\n        } catch (error) {\n            console.error(\"Error sending SMS:\", error);\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : \"Unknown error\"\n            };\n        }\n    }\n    /**\n   * Send consultation booking notification to provider\n   */ async sendProviderBookingNotification(providerPhone, patientName, consultationType, scheduledAt) {\n        const scheduledDate = new Date(scheduledAt).toLocaleString(\"en-US\", {\n            dateStyle: \"medium\",\n            timeStyle: \"short\"\n        });\n        const message = `New Consultation Request\\n\\nPatient: ${patientName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nPlease log in to accept or decline.`;\n        return this.sendSMS({\n            to: providerPhone,\n            message\n        });\n    }\n    /**\n   * Send notification to patient when provider is assigned\n   */ async sendPatientAssignmentNotification(patientPhone, providerName, consultationType, scheduledDate) {\n        const message = `Provider Assigned\\n\\nA healthcare provider has been assigned to your consultation request.\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nPlease log in to confirm or choose another provider.`;\n        return this.sendSMS({\n            to: patientPhone,\n            message\n        });\n    }\n    /**\n   * Send consultation confirmation to patient\n   */ async sendPatientConfirmation(patientPhone, providerName, consultationType, scheduledAt) {\n        const scheduledDate = new Date(scheduledAt).toLocaleString(\"en-US\", {\n            dateStyle: \"medium\",\n            timeStyle: \"short\"\n        });\n        const message = `Consultation Confirmed\\n\\nProvider: ${providerName}\\nType: ${consultationType}\\nScheduled: ${scheduledDate}\\n\\nYou will receive a reminder 1 hour before.`;\n        return this.sendSMS({\n            to: patientPhone,\n            message\n        });\n    }\n    /**\n   * Send payment confirmation\n   */ async sendPaymentConfirmation(phone, amount, consultationType) {\n        const message = `Payment Confirmed\\n\\nAmount: ${amount} SLL\\nConsultation: ${consultationType}\\n\\nYour consultation is now confirmed.`;\n        return this.sendSMS({\n            to: phone,\n            message\n        });\n    }\n}\nconst smsService = new SMSService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SkMsWUFBb0IsRUFDcEJDLFlBQW9CLEVBQ3BCVCxnQkFBd0IsRUFDeEJFLGFBQXFCLEVBQ0M7UUFDdEIsTUFBTWpDLFVBQVUsQ0FBQyx3R0FBd0csRUFBRXdDLGFBQWEsUUFBUSxFQUFFVCxpQkFBaUIsYUFBYSxFQUFFRSxjQUFjLHdEQUF3RCxDQUFDO1FBRXpQLE9BQU8sSUFBSSxDQUFDdkMsT0FBTyxDQUFDO1lBQ2xCSyxJQUFJd0M7WUFDSnZDO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTXlDLHdCQUNKRixZQUFvQixFQUNwQkMsWUFBb0IsRUFDcEJULGdCQUF3QixFQUN4QkMsV0FBbUIsRUFDRztRQUN0QixNQUFNQyxnQkFBZ0IsSUFBSUMsS0FBS0YsYUFBYUcsY0FBYyxDQUFDLFNBQVM7WUFDbEVDLFdBQVc7WUFDWEMsV0FBVztRQUNiO1FBRUEsTUFBTXJDLFVBQVUsQ0FBQyxvQ0FBb0MsRUFBRXdDLGFBQWEsUUFBUSxFQUFFVCxpQkFBaUIsYUFBYSxFQUFFRSxjQUFjLDhDQUE4QyxDQUFDO1FBRTNLLE9BQU8sSUFBSSxDQUFDdkMsT0FBTyxDQUFDO1lBQ2xCSyxJQUFJd0M7WUFDSnZDO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTTBDLHdCQUNKckQsS0FBYSxFQUNic0QsTUFBYyxFQUNkWixnQkFBd0IsRUFDRjtRQUN0QixNQUFNL0IsVUFBVSxDQUFDLDZCQUE2QixFQUFFMkMsT0FBTyxvQkFBb0IsRUFBRVosaUJBQWlCLHVDQUF1QyxDQUFDO1FBRXRJLE9BQU8sSUFBSSxDQUFDckMsT0FBTyxDQUFDO1lBQ2xCSyxJQUFJVjtZQUNKVztRQUNGO0lBQ0Y7QUFDRjtBQUVPLE1BQU00QyxhQUFhLElBQUluRSxhQUFhIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcnVyYWwtaGVhbHRoLXBsYXRmb3JtLy4vbGliL25vdGlmaWNhdGlvbnMvc21zLnRzP2ExN2MiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTTVMgTm90aWZpY2F0aW9uIFNlcnZpY2VcbiAqIEhhbmRsZXMgc2VuZGluZyBTTVMgbm90aWZpY2F0aW9ucyB2aWEgVHdpbGlvIG9yIG90aGVyIFNNUyBwcm92aWRlcnNcbiAqL1xuXG5pbnRlcmZhY2UgU01TT3B0aW9ucyB7XG4gIHRvOiBzdHJpbmc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgZnJvbT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFNNU1Jlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgbWVzc2FnZUlkPzogc3RyaW5nO1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFNNU1NlcnZpY2Uge1xuICBwcml2YXRlIHR3aWxpb0FjY291bnRTaWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSB0d2lsaW9BdXRoVG9rZW46IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSB0d2lsaW9QaG9uZU51bWJlcjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGVuYWJsZWQ6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50d2lsaW9BY2NvdW50U2lkID0gcHJvY2Vzcy5lbnYuVFdJTElPX0FDQ09VTlRfU0lEO1xuICAgIHRoaXMudHdpbGlvQXV0aFRva2VuID0gcHJvY2Vzcy5lbnYuVFdJTElPX0FVVEhfVE9LRU47XG4gICAgdGhpcy50d2lsaW9QaG9uZU51bWJlciA9IHByb2Nlc3MuZW52LlRXSUxJT19QSE9ORV9OVU1CRVI7XG4gICAgdGhpcy5lbmFibGVkID0gISEoXG4gICAgICB0aGlzLnR3aWxpb0FjY291bnRTaWQgJiZcbiAgICAgIHRoaXMudHdpbGlvQXV0aFRva2VuICYmXG4gICAgICB0aGlzLnR3aWxpb1Bob25lTnVtYmVyXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBwaG9uZSBudW1iZXIgZm9ybWF0XG4gICAqIE11c3Qgc3RhcnQgd2l0aCArIGFuZCBoYXZlIGNvdW50cnkgY29kZSAoZS5nLiwgKzIzMjEyMzQ1Njc4OSlcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVQaG9uZU51bWJlcihwaG9uZTogc3RyaW5nKTogeyB2YWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSB7XG4gICAgaWYgKCFwaG9uZSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJQaG9uZSBudW1iZXIgaXMgcmVxdWlyZWRcIiB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBNdXN0IHN0YXJ0IHdpdGggKyBhbmQgaGF2ZSBjb3VudHJ5IGNvZGUgKyBudW1iZXIgKDEwLTE1IGRpZ2l0cyB0b3RhbClcbiAgICBjb25zdCBwaG9uZVJlZ2V4ID0gL15cXCtbMS05XVxcZHsxMCwxNH0kLztcbiAgICBcbiAgICBpZiAoIXBob25lUmVnZXgudGVzdChwaG9uZSkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGBJbnZhbGlkIHBob25lIG51bWJlciBmb3JtYXQuIEV4cGVjdGVkOiArMjMyWFhYWFhYWFhYICh3aXRoIGNvdW50cnkgY29kZSksIGdvdDogJHtwaG9uZX1gLFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIFNNUyB2aWEgVHdpbGlvXG4gICAqL1xuICBhc3luYyBzZW5kU01TKG9wdGlvbnM6IFNNU09wdGlvbnMpOiBQcm9taXNlPFNNU1Jlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLmVuYWJsZWQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIlNNUyBzZXJ2aWNlIG5vdCBjb25maWd1cmVkLiBTa2lwcGluZyBTTVMgc2VuZC5cIik7XG4gICAgICBjb25zb2xlLmxvZyhcIldvdWxkIHNlbmQgU01TOlwiLCB7XG4gICAgICAgIHRvOiBvcHRpb25zLnRvLFxuICAgICAgICBtZXNzYWdlOiBvcHRpb25zLm1lc3NhZ2Uuc3Vic3RyaW5nKDAsIDUwKSArIFwiLi4uXCIsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogXCJTTVMgc2VydmljZSBub3QgY29uZmlndXJlZFwiLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBwaG9uZSBudW1iZXIgZm9ybWF0XG4gICAgY29uc3QgcGhvbmVWYWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZVBob25lTnVtYmVyKG9wdGlvbnMudG8pO1xuICAgIGlmICghcGhvbmVWYWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCBwaG9uZSBudW1iZXI6XCIsIHBob25lVmFsaWRhdGlvbi5lcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHBob25lVmFsaWRhdGlvbi5lcnJvcixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBUd2lsaW8gU0RLIGlmIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIHVzZSBmZXRjaFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYGh0dHBzOi8vYXBpLnR3aWxpby5jb20vMjAxMC0wNC0wMS9BY2NvdW50cy8ke3RoaXMudHdpbGlvQWNjb3VudFNpZH0vTWVzc2FnZXMuanNvbmAsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmFzaWMgJHtCdWZmZXIuZnJvbShcbiAgICAgICAgICAgICAgYCR7dGhpcy50d2lsaW9BY2NvdW50U2lkfToke3RoaXMudHdpbGlvQXV0aFRva2VufWBcbiAgICAgICAgICAgICkudG9TdHJpbmcoXCJiYXNlNjRcIil9YCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICAgICAgRnJvbTogb3B0aW9ucy5mcm9tIHx8IHRoaXMudHdpbGlvUGhvbmVOdW1iZXIhLFxuICAgICAgICAgICAgVG86IG9wdGlvbnMudG8sXG4gICAgICAgICAgICBCb2R5OiBvcHRpb25zLm1lc3NhZ2UsXG4gICAgICAgICAgfSksXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlR3aWxpbyBTTVMgQVBJIGVycm9yOlwiLCB7XG4gICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICBlcnJvcjogZGF0YSxcbiAgICAgICAgICBwaG9uZU51bWJlcjogb3B0aW9ucy50byxcbiAgICAgICAgICBtZXNzYWdlOiBvcHRpb25zLm1lc3NhZ2Uuc3Vic3RyaW5nKDAsIDUwKSArIFwiLi4uXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2hlY2sgZm9yIGNvbW1vbiBUd2lsaW8gZXJyb3JzXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gc2VuZCBTTVNcIjtcbiAgICAgICAgaWYgKGRhdGEuY29kZSA9PT0gMjEyMTEpIHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBcIkludmFsaWQgcGhvbmUgbnVtYmVyIGZvcm1hdFwiO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuY29kZSA9PT0gMjE0MDgpIHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBcIlBob25lIG51bWJlciBub3QgdmVyaWZpZWQgKHRyaWFsIGFjY291bnQgcmVzdHJpY3Rpb24pXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YS5jb2RlID09PSAyMTYwOCkge1xuICAgICAgICAgIGVycm9yTWVzc2FnZSA9IFwiVW5zdWJzY3JpYmVkIHJlY2lwaWVudFwiO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKFwiU01TIHNlbnQgc3VjY2Vzc2Z1bGx5IHZpYSBUd2lsaW86XCIsIHtcbiAgICAgICAgbWVzc2FnZUlkOiBkYXRhLnNpZCxcbiAgICAgICAgcGhvbmVOdW1iZXI6IG9wdGlvbnMudG8sXG4gICAgICAgIHN0YXR1czogZGF0YS5zdGF0dXMsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZUlkOiBkYXRhLnNpZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIFNNUzpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBjb25zdWx0YXRpb24gYm9va2luZyBub3RpZmljYXRpb24gdG8gcHJvdmlkZXJcbiAgICovXG4gIGFzeW5jIHNlbmRQcm92aWRlckJvb2tpbmdOb3RpZmljYXRpb24oXG4gICAgcHJvdmlkZXJQaG9uZTogc3RyaW5nLFxuICAgIHBhdGllbnROYW1lOiBzdHJpbmcsXG4gICAgY29uc3VsdGF0aW9uVHlwZTogc3RyaW5nLFxuICAgIHNjaGVkdWxlZEF0OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxTTVNSZXNwb25zZT4ge1xuICAgIGNvbnN0IHNjaGVkdWxlZERhdGUgPSBuZXcgRGF0ZShzY2hlZHVsZWRBdCkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgICBkYXRlU3R5bGU6IFwibWVkaXVtXCIsXG4gICAgICB0aW1lU3R5bGU6IFwic2hvcnRcIixcbiAgICB9KTtcblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBgTmV3IENvbnN1bHRhdGlvbiBSZXF1ZXN0XFxuXFxuUGF0aWVudDogJHtwYXRpZW50TmFtZX1cXG5UeXBlOiAke2NvbnN1bHRhdGlvblR5cGV9XFxuU2NoZWR1bGVkOiAke3NjaGVkdWxlZERhdGV9XFxuXFxuUGxlYXNlIGxvZyBpbiB0byBhY2NlcHQgb3IgZGVjbGluZS5gO1xuXG4gICAgcmV0dXJuIHRoaXMuc2VuZFNNUyh7XG4gICAgICB0bzogcHJvdmlkZXJQaG9uZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBub3RpZmljYXRpb24gdG8gcGF0aWVudCB3aGVuIHByb3ZpZGVyIGlzIGFzc2lnbmVkXG4gICAqL1xuICBhc3luYyBzZW5kUGF0aWVudEFzc2lnbm1lbnROb3RpZmljYXRpb24oXG4gICAgcGF0aWVudFBob25lOiBzdHJpbmcsXG4gICAgcHJvdmlkZXJOYW1lOiBzdHJpbmcsXG4gICAgY29uc3VsdGF0aW9uVHlwZTogc3RyaW5nLFxuICAgIHNjaGVkdWxlZERhdGU6IHN0cmluZ1xuICApOiBQcm9taXNlPFNNU1Jlc3BvbnNlPiB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGBQcm92aWRlciBBc3NpZ25lZFxcblxcbkEgaGVhbHRoY2FyZSBwcm92aWRlciBoYXMgYmVlbiBhc3NpZ25lZCB0byB5b3VyIGNvbnN1bHRhdGlvbiByZXF1ZXN0LlxcblxcblByb3ZpZGVyOiAke3Byb3ZpZGVyTmFtZX1cXG5UeXBlOiAke2NvbnN1bHRhdGlvblR5cGV9XFxuU2NoZWR1bGVkOiAke3NjaGVkdWxlZERhdGV9XFxuXFxuUGxlYXNlIGxvZyBpbiB0byBjb25maXJtIG9yIGNob29zZSBhbm90aGVyIHByb3ZpZGVyLmA7XG5cbiAgICByZXR1cm4gdGhpcy5zZW5kU01TKHtcbiAgICAgIHRvOiBwYXRpZW50UGhvbmUsXG4gICAgICBtZXNzYWdlLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgY29uc3VsdGF0aW9uIGNvbmZpcm1hdGlvbiB0byBwYXRpZW50XG4gICAqL1xuICBhc3luYyBzZW5kUGF0aWVudENvbmZpcm1hdGlvbihcbiAgICBwYXRpZW50UGhvbmU6IHN0cmluZyxcbiAgICBwcm92aWRlck5hbWU6IHN0cmluZyxcbiAgICBjb25zdWx0YXRpb25UeXBlOiBzdHJpbmcsXG4gICAgc2NoZWR1bGVkQXQ6IHN0cmluZ1xuICApOiBQcm9taXNlPFNNU1Jlc3BvbnNlPiB7XG4gICAgY29uc3Qgc2NoZWR1bGVkRGF0ZSA9IG5ldyBEYXRlKHNjaGVkdWxlZEF0KS50b0xvY2FsZVN0cmluZyhcImVuLVVTXCIsIHtcbiAgICAgIGRhdGVTdHlsZTogXCJtZWRpdW1cIixcbiAgICAgIHRpbWVTdHlsZTogXCJzaG9ydFwiLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbWVzc2FnZSA9IGBDb25zdWx0YXRpb24gQ29uZmlybWVkXFxuXFxuUHJvdmlkZXI6ICR7cHJvdmlkZXJOYW1lfVxcblR5cGU6ICR7Y29uc3VsdGF0aW9uVHlwZX1cXG5TY2hlZHVsZWQ6ICR7c2NoZWR1bGVkRGF0ZX1cXG5cXG5Zb3Ugd2lsbCByZWNlaXZlIGEgcmVtaW5kZXIgMSBob3VyIGJlZm9yZS5gO1xuXG4gICAgcmV0dXJuIHRoaXMuc2VuZFNNUyh7XG4gICAgICB0bzogcGF0aWVudFBob25lLFxuICAgICAgbWVzc2FnZSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHBheW1lbnQgY29uZmlybWF0aW9uXG4gICAqL1xuICBhc3luYyBzZW5kUGF5bWVudENvbmZpcm1hdGlvbihcbiAgICBwaG9uZTogc3RyaW5nLFxuICAgIGFtb3VudDogbnVtYmVyLFxuICAgIGNvbnN1bHRhdGlvblR5cGU6IHN0cmluZ1xuICApOiBQcm9taXNlPFNNU1Jlc3BvbnNlPiB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGBQYXltZW50IENvbmZpcm1lZFxcblxcbkFtb3VudDogJHthbW91bnR9IFNMTFxcbkNvbnN1bHRhdGlvbjogJHtjb25zdWx0YXRpb25UeXBlfVxcblxcbllvdXIgY29uc3VsdGF0aW9uIGlzIG5vdyBjb25maXJtZWQuYDtcblxuICAgIHJldHVybiB0aGlzLnNlbmRTTVMoe1xuICAgICAgdG86IHBob25lLFxuICAgICAgbWVzc2FnZSxcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3Qgc21zU2VydmljZSA9IG5ldyBTTVNTZXJ2aWNlKCk7XG5cbiJdLCJuYW1lcyI6WyJTTVNTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ0d2lsaW9BY2NvdW50U2lkIiwicHJvY2VzcyIsImVudiIsIlRXSUxJT19BQ0NPVU5UX1NJRCIsInR3aWxpb0F1dGhUb2tlbiIsIlRXSUxJT19BVVRIX1RPS0VOIiwidHdpbGlvUGhvbmVOdW1iZXIiLCJUV0lMSU9fUEhPTkVfTlVNQkVSIiwiZW5hYmxlZCIsInZhbGlkYXRlUGhvbmVOdW1iZXIiLCJwaG9uZSIsInZhbGlkIiwiZXJyb3IiLCJwaG9uZVJlZ2V4IiwidGVzdCIsInNlbmRTTVMiLCJvcHRpb25zIiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJ0byIsIm1lc3NhZ2UiLCJzdWJzdHJpbmciLCJzdWNjZXNzIiwicGhvbmVWYWxpZGF0aW9uIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiYm9keSIsIlVSTFNlYXJjaFBhcmFtcyIsIkZyb20iLCJUbyIsIkJvZHkiLCJkYXRhIiwianNvbiIsIm9rIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsInBob25lTnVtYmVyIiwiZXJyb3JNZXNzYWdlIiwiY29kZSIsIm1lc3NhZ2VJZCIsInNpZCIsIkVycm9yIiwic2VuZFByb3ZpZGVyQm9va2luZ05vdGlmaWNhdGlvbiIsInByb3ZpZGVyUGhvbmUiLCJwYXRpZW50TmFtZSIsImNvbnN1bHRhdGlvblR5cGUiLCJzY2hlZHVsZWRBdCIsInNjaGVkdWxlZERhdGUiLCJEYXRlIiwidG9Mb2NhbGVTdHJpbmciLCJkYXRlU3R5bGUiLCJ0aW1lU3R5bGUiLCJzZW5kUGF0aWVudEFzc2lnbm1lbnROb3RpZmljYXRpb24iLCJwYXRpZW50UGhvbmUiLCJwcm92aWRlck5hbWUiLCJzZW5kUGF0aWVudENvbmZpcm1hdGlvbiIsInNlbmRQYXltZW50Q29uZmlybWF0aW9uIiwiYW1vdW50Iiwic21zU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/notifications/sms.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/admin.ts":
/*!*******************************!*\
  !*** ./lib/supabase/admin.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAdminClient: () => (/* binding */ getAdminClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _lib_env__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/env */ \"(rsc)/./lib/env.ts\");\n/**\n * Supabase Admin Client\n * \n * This client uses the service role key to perform admin operations\n * like creating users, bypassing RLS, etc.\n * \n * ⚠️ SECURITY: Only use this server-side, never expose the service role key!\n */ \n\nlet adminClient = null;\nfunction getAdminClient() {\n    if (!_lib_env__WEBPACK_IMPORTED_MODULE_0__.env.SUPABASE_SERVICE_ROLE_KEY) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY is not configured. \" + \"Please add it to your .env.local file.\");\n    }\n    if (!adminClient) {\n        adminClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(_lib_env__WEBPACK_IMPORTED_MODULE_0__.env.NEXT_PUBLIC_SUPABASE_URL, _lib_env__WEBPACK_IMPORTED_MODULE_0__.env.SUPABASE_SERVICE_ROLE_KEY, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n    }\n    return adminClient;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UvYWRtaW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Q0FPQyxHQUVtRDtBQUNyQjtBQUUvQixJQUFJRSxjQUFzRDtBQUVuRCxTQUFTQztJQUNkLElBQUksQ0FBQ0YseUNBQUdBLENBQUNHLHlCQUF5QixFQUFFO1FBQ2xDLE1BQU0sSUFBSUMsTUFDUixrREFDQTtJQUVKO0lBRUEsSUFBSSxDQUFDSCxhQUFhO1FBQ2hCQSxjQUFjRixtRUFBWUEsQ0FDeEJDLHlDQUFHQSxDQUFDSyx3QkFBd0IsRUFDNUJMLHlDQUFHQSxDQUFDRyx5QkFBeUIsRUFDN0I7WUFDRUcsTUFBTTtnQkFDSkMsa0JBQWtCO2dCQUNsQkMsZ0JBQWdCO1lBQ2xCO1FBQ0Y7SUFFSjtJQUVBLE9BQU9QO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ydXJhbC1oZWFsdGgtcGxhdGZvcm0vLi9saWIvc3VwYWJhc2UvYWRtaW4udHM/ODE2YiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN1cGFiYXNlIEFkbWluIENsaWVudFxuICogXG4gKiBUaGlzIGNsaWVudCB1c2VzIHRoZSBzZXJ2aWNlIHJvbGUga2V5IHRvIHBlcmZvcm0gYWRtaW4gb3BlcmF0aW9uc1xuICogbGlrZSBjcmVhdGluZyB1c2VycywgYnlwYXNzaW5nIFJMUywgZXRjLlxuICogXG4gKiDimqDvuI8gU0VDVVJJVFk6IE9ubHkgdXNlIHRoaXMgc2VydmVyLXNpZGUsIG5ldmVyIGV4cG9zZSB0aGUgc2VydmljZSByb2xlIGtleSFcbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5pbXBvcnQgeyBlbnYgfSBmcm9tICdAL2xpYi9lbnYnXG5cbmxldCBhZG1pbkNsaWVudDogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlQ2xpZW50PiB8IG51bGwgPSBudWxsXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBZG1pbkNsaWVudCgpIHtcbiAgaWYgKCFlbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBjb25maWd1cmVkLiAnICtcbiAgICAgICdQbGVhc2UgYWRkIGl0IHRvIHlvdXIgLmVudi5sb2NhbCBmaWxlLidcbiAgICApXG4gIH1cblxuICBpZiAoIWFkbWluQ2xpZW50KSB7XG4gICAgYWRtaW5DbGllbnQgPSBjcmVhdGVDbGllbnQoXG4gICAgICBlbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMLFxuICAgICAgZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVksXG4gICAgICB7XG4gICAgICAgIGF1dGg6IHtcbiAgICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKVxuICB9XG5cbiAgcmV0dXJuIGFkbWluQ2xpZW50XG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJlbnYiLCJhZG1pbkNsaWVudCIsImdldEFkbWluQ2xpZW50IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/admin.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@smithy","vendor-chunks/@aws-sdk","vendor-chunks/zod","vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/ws","vendor-chunks/fast-xml-parser","vendor-chunks/whatwg-url","vendor-chunks/tr46","vendor-chunks/strnum","vendor-chunks/webidl-conversions","vendor-chunks/@aws"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftest%2Fnotify%2Froute&page=%2Fapi%2Ftest%2Fnotify%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftest%2Fnotify%2Froute.ts&appDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fswift%2FRural-health%2Fhealth-connect&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();